
@{
    Layout = "/Views/Shared/_Layout_isemri.cshtml";
}

@model NOVA.Models.MSIPAcik


<!DOCTYPE html>



<html>
<head>
    <meta name="viewport" content="width=device-width" />

    <!-- Page CSS -->
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->







    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <!-- PivotTable.js libs from ../dist -->
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="~/Content/table/bootstrap-table.min.css" rel="stylesheet" />
    <link href="~/Content/table/placeholder-loading.min.css" rel="stylesheet" />
    <style>


        .myInput {
            box-sizing: border-box;
            background-image: url('https://www.w3schools.com/howto/searchicon.png');
            background-position: 5px;
            background-repeat: no-repeat;
            font-size: 12px;
            padding: 8px 20px 7px 45px;
            border: none;
            z-index: 5;
        }

            .myInput:focus {
                outline: 3px solid #ddd;
            }

        .dropdown {
            position: fixed;
            display: inline-block;
        }

        .dropdown-content2 {
            position: fixed;
            background-color: #f6f6f6;
            margin-left: -100px;
            min-width: 100px;
            max-height: 300px;
            overflow: auto;
            border: 1px solid;
            display: none;
            z-index: 10;
        }

            .dropdown-content2 a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                width: auto;
                display: none;
                cursor: pointer;
                z-index: 5;
                border-bottom: 1px solid;
            }

        .dropdown-content {
            position: relative;
            background-color: #f6f6f6;
            min-width: 130px;
            overflow: auto;
            border: 1px solid #ddd;
            z-index: 10;
        }

            .dropdown-content a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                display: none;
                cursor: pointer;
                z-index: 5;
            }

        .dropdown a:hover {
            background-color: #ddd;
        }

        .show {
            display: flex;
        }

        .pvtAxisContainer {
            display: none;
        }

        .pvtRenderer {
            display: none;
        }

        .pvtVals {
            display: none;
        }

        #pivotoutput .pvtTotalLabel {
            display: none;
        }

        #pivotoutput .pvtTotal {
            display: none;
        }

        #pivotoutput .pvtGrandTotal {
            display: none;
        }
        @@media screen and (max-width: 800px) {
            #scanner{
                margin-top:0 !important;
            }
            #qr-reader {
                width:100% !important;
            }
        }
        .centercontent {
            position: absolute;
            max-width: 100%;
            height: auto;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
        }

        .heart {
            animation: heartbeat 1s infinite alternate;
        }

        @@keyframes heartbeat {
            from {
                opacity: 0.3;
                transform: scale(0.32);
            }

            to {
                opacity: 1;
                transform: scale(0.40);
            }
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        var sag = 0;
    </script>
    <style>
        .centercontent {
            position: absolute;
            max-width: 100%;
            height: auto;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
        }
    </style>
</head>
<body style="overflow:hidden">
    <div class="centercontent" id="content" style="display:unset">
        <div class="heart"><img id="progress" src="~/images/novasaydam.png" style="max-width:15vw" /></div>
    </div>
    <div class="container-fluid" style="min-height:88%">

        <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
            <input type="radio" class="btn-check" name="btnradio" id="btnradio1" onclick="change(1)" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnradio1">Üretime Al</label>
            <input type="radio" class="btn-check" name="btnradio" id="btnradio2" onclick="change(0)" checked="" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnradio2">Üretim Kaydı</label>
        </div>
        <div class="row" style="min-height:100%;overflow-y:auto;">
            <div class="col">
                <div class="row" style="min-height:11%">
                    <div class="col text-center">

                    </div>
                </div>
                <div class="row" style="min-height:11%">
                    <div class="col">
                        <div class="btn-group" role="group" aria-label="Basic radio toggle button group" id="makineler">
                           
                        </div>
                    </div>
                </div>
                <div class="row" style="min-height:33%;display:none" id="tablo">
                    <div class="col" id="stokadlari">

                    </div>
                </div>
                <div class="row" style="margin-top:-5%;min-height:33%;display:none" id="scanner">
                    <div id="element">
                        <audio id="giris">
                            <source src="~/Content/giris.mp3" type="audio/mpeg" />
                        </audio>
                        <audio id="cikis">
                            <source src="~/Content/cıkıs.mp3" type="audio/mpeg" />
                        </audio>
                        <audio id="hata">
                            <source src="~/Content/hata.mp3" type="audio/mpeg" />
                        </audio>
                        <button style="display:none" onclick="playAudio()" type="button">Play Audio</button>

                        <div class="container-fluid p-0">
                            <div id="qr-reader" style="width:30%;margin-right:auto;margin-left:auto;margin-top:1%;margin-bottom:auto"></div>
                            <div id="qr-reader-results"></div>
                        </div>
                    </div>
                </div>
            </div>



        </div>
    </div>
   
    <script>
        $(document).ready(function () {

            $.getJSON("http://192.168.2.13:83/api/makine/makineler", function (data) {

                for (let i = 0; i < data.length; i++) {
                    var input = document.createElement("input");
                    input.setAttribute("type", "radio");
                    input.className = "btn-check";
                    input.setAttribute("name", "btnradio");
                    input.id = "btnradio" + i+2 + "";
                    input.setAttribute("autocomplete", "off");
                    input.setAttribute("onclick", "c(this)");
                    input.value = data[i].HAT_KODU;
                    var label = document.createElement("label");
                    label.className = "btn btn-outline-primary";
                    label.setAttribute("for", input.id);
                    label.innerHTML = data[i].HAT_KODU;
                    document.getElementById("makineler").appendChild(input);
                    document.getElementById("makineler").appendChild(label);
                }

            }).done(function () {
                $("#progress").hide();
            })

        })
        if ($(window).width() < 600) {
            $("#divPartial2").show();
        }
        else {
            $("#divPartial").show();
        }
        $('.js-example-basic-single').select2({
            tags: true
        }
        );
        function change(value) {
            if (value == 0) {
                $("#label").html("Çıktı")
                $("#tablo").show();
                $("#scanner").hide();
                $("#makineler").show();
            } else {
                $("#label").html("Girdi")
                $("#tablo").hide();
                $("#makineler").hide();
                $(".mak").removeClass('btn-outline-secondary').addClass('btn-outline-primary');
                $("#scanner").show();
            docReady(function () {
            var resultContainer = document.getElementById('qr-reader-results');
            var lastResult, countResults = 0;
            function onScanSuccess(decodedText, decodedResult) {
                if (decodedText !== lastResult) {
                    ++countResults;
                    lastResult = decodedText;
                    var userid =@Request.Cookies["UserId"].Value;
                    var u = "";
                    var u2 = "http://192.168.2.13:83/api/ie/control/" + decodedText;
                    $.getJSON(u2, function (data) {
                        if (data.length>0) {
                            Swal.fire({
                                text: data[0].SERI_NO + " seri numaralı ürünü " + data[0].HATKODU +" kodlu makinede üretime almayı onaylıyor musunuz?",
                                showCancelButton: true,
                                confirmButtonColor: '#3085d6',
                                cancelButtonColor: '#d33',
                                confirmButtonText: 'Evet',
                                cancelButtonText: "Hayır"
                            }).then((result) => {
                                if (result.isConfirmed) {
                                    u="http://192.168.2.13:83/api/ie/hat/" + data[0].HATKODU + "/" + decodedText + "/" + userid;
                                    $.getJSON(u, function () {

                                    }).done(function () {
                                        Swal.fire(
                                            'Başarılı!',
                                            'Kayıt başarılı',
                                            'success'
                                        )
                                    })

                                }
                            })

                        } else {
                            Swal.fire(
                                'Uyarı!',
                                'YOK',
                                'error'
                            )
                        }
                    })


                }

            }

            var html5QrcodeScanner = new Html5QrcodeScanner(
                "qr-reader", { fps: 10, qrbox: 800 });
            html5QrcodeScanner.render(onScanSuccess);

        });
            }
        }
        var sabit = "";
        var btnid = "";
        function c(value) {
            $("#tablo").show();
            $("#progress").show();
            sabit = value.value;
            btnid = value.id;
            var url1 = "http://192.168.2.13:83/api/ie/TOP/" + value.value;
            document.getElementById("stokadlari").replaceChildren();

            $.getJSON(url1, function (data) {

                for (let i = 0; i < data.length; i++) {
                    var b = document.createElement("button");
                    b.className = "mak btn btn-outline-secondary me-4";
                    b.innerHTML = data[i].STOK_ADI;
                    b.setAttribute("onclick", "stokadichange(this)");

                    var progress = document.createElement("div");
                    progress.className = "progress";
                    progress.style = "width:100%";
                    var bar = document.createElement("div");
                    bar.className = "progress-bar progress-bar-striped bg-info progress-bar-animated";
                    bar.setAttribute("role", "progressbar");
                    bar.setAttribute("style", "width: " + data[i].ORAN +"%");
                    bar.setAttribute("aria-valuenow", data[i].ORAN);
                    bar.setAttribute("aria-valuemin", "0");
                    bar.setAttribute("aria-valuemax", "100");
                    bar.innerHTML = data[i].ORAN + " %";
                    progress.appendChild(bar);
                    b.appendChild(progress);
                    document.getElementById("stokadlari").appendChild(b);
                }

            }).done(function () {
                $("#progress").hide();
            })





        }
        function d(value) {

            sabit = value.innerHTML;


        }
        var m1 = 0;
        var m2 = 0;
        function keychange() {

            m1 = $("#miktar1").val();
            m2 = $("#miktar2").val();
        }
        function stokadichange(value) {
            Swal.fire({
                title: value.innerHTML.split("<div")[0],
                html: '<table id="tab1" class="table table-borderless inp"><tr><th>Miktar1</th><th>Miktar2</th></tr><tr><td><input onkeyup="keychange()" class="form-control text-center"  type="number"  id="miktar1" ></td>' +
                    '<td><input class="form-control text-center" onkeyup="keychange()" type="number" id="miktar2"></td></tr></table>',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Kaydet',
                cancelButtonText: 'İptal',
                showClass: {
                    popup: 'pop2 animate__animated animate__zoomIn'
                },
                hideClass: {
                    popup: 'pop2 animate__animated animate__zoomOut'
                }
            }).then((result) => {
                $("#progress").show();
                if (result.isConfirmed) {
                     var ISEMRINO = null;
                    var u = "http://192.168.2.13:83/api/IE/" + sabit;
                    $.getJSON(u, function (data) {
                        
                         ISEMRINO = data[0].ISEMRINO;
                
            }).done(function () {
            $.ajax({
                url: '@Url.Action("UretimSonuKaydı", "IsEmri")',
                type: 'POST',
                data: { "isemrino": ISEMRINO, "miktar1": parseFloat(m1), "miktar2": parseFloat(m2) },
                error: function (data) {
                    $("#progress").hide();
                    Swal.fire(
                        'Başarılı!',
                        'Kayıt başarılı',
                        'success'
                    )
                    document.getElementById(btnid).onclick();
                }
            })
            })


                }
            })
        }
    </script>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <script>
        function cb(o) {
            console.log(o.ip)
        }
    </script>

    <script src="http://freegeoip.net/json/?callback=cb" type="text/javascript"></script>
    <script>
        var x = document.getElementById("giris");
        var y = document.getElementById("cikis");
        var z = document.getElementById("hata");
        function playGiris() {
            x.play();
        }
        function playCikis() {
            y.play();
        }
        function playHata() {
            z.play();
        }

        function docReady(fn) {
            // see if DOM is already available
            if (document.readyState === "complete"
                || document.readyState === "interactive") {
                // call on next available tick
                setTimeout(fn, 1);
            } else {
                document.addEventListener("DOMContentLoaded", fn);
            }
        }


        /**/
    </script>


</body>

</html>






