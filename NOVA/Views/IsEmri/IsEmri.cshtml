
@{
    Layout = "/Views/Shared/_Layout_common.cshtml";
}



<!DOCTYPE html>


<head>
    <link rel="stylesheet" type="text/css" href="../dist/pivot.css">
    <script type="text/javascript" src="../dist/pivot.js"></script>
    <script src="~/lib/pivot/multifact-pivottable.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <style>
        body {
            padding: 0 0 0 3rem !important;
        }
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        /* Firefox */
        input[type=number] {
            -moz-appearance: textfield;
        }

        input {
            background-color: transparent !important;
        }

            input:focus {
                outline: none;
            }

        .centercontent {
            position: absolute;
            max-width: 100%;
            height: auto;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
        }

        .heart {
            animation: heartbeat 1s infinite alternate;
        }

        @@keyframes heartbeat {
            from {
                opacity: 0.3;
                transform: scale(0.32);
            }

            to {
                opacity: 1;
                transform: scale(0.40);
            }
        }

        .layout-container {
            min-height: 95vh;
        }

        body {
            font-size: 12px;
        }

        .pvtTotalLabel {
            display: none
        }

        .pvtTotal {
            display: none
        }

        .pvtGrandTotal {
            display: none
        }

        .foot {
            display: none;
        }

        .pvtTable thead tr:nth-child(1) {
            position: sticky;
            top: -2px;
        }

        .pvtRowLabel {
            text-align: center;
        }

        .pvtTable thead tr {
            background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%) !important;
        }

        table.pvtTable thead tr th, table.pvtTable tbody tr th {
            background-color: transparent;
            border: 1px solid #CDCDCD;
            font-size: 11pt;
            padding: 5px;
        }

        .table-bordered {
            border-top-right-radius: 15px;
            border-top-left-radius: 15px;
        }

        .form-check-input:checked {
            background-color: #4417FA !important;
            border-color: #4417FA;
            box-shadow: 0 2px 4px 0 rgba(105, 108, 255, 0.4);
        }
    </style>
</head>
<body style="overflow:hidden">
    <div class="container-fluid mt-3">
        <div class="centercontent" id="content" style="display:none">
            <div class="heart"><img id="progress" src="~/images/novasaydam.png" style="max-width:15vw" /></div>
        </div>

        <!-- #region Makineler -->

        <div class="row text-center">
            <div class="col">
                <div class="btn-group" role="group" aria-label="Basic radio toggle button group" id="makineler">
                    <input type="radio" class="btn-check" name="uretim-tip" id="btnradio02" autocomplete="off" onclick="c(this)" value="BK"><label class="btn btn-outline-primary" for="btnradio02">BK</label>
                    <input type="radio" class="btn-check" name="uretim-tip" id="btnradio12" autocomplete="off" onclick="c(this)" value="DL" checked="checked"><label class="btn btn-outline-primary" for="btnradio12">DL</label>
                    <input type="radio" class="btn-check" name="uretim-tip" id="btnradio32" autocomplete="off" onclick="c(this)" value="PB"><label class="btn btn-outline-primary" for="btnradio32">PB</label>
                    <input type="radio" class="btn-check" name="uretim-tip" id="btnradio52" autocomplete="off" onclick="c(this)" value="RF"><label class="btn btn-outline-primary" for="btnradio52">RF</label>
                    <input type="radio" class="btn-check" name="uretim-tip" id="btnradio112" autocomplete="off" onclick="c(this)" value="TP"><label class="btn btn-outline-primary" for="btnradio112">TP</label>
                </div>
            </div>
        </div>

        <!-- #endregion -->
        <!-- #region DLHammadde -->

        <div class="row">
            <div class="col">
                <div class="card mt-2" id="HammaddeCard">



                    <div class="card-body me-3">
                        <div class="table-responsive text-nowrap">
                            <table class="table table-bordered" style="border-color:black;">



                                <tbody>
                                    <tr style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">
                                        <th class="text-center" style="font-size:12px">FABRİKA</th>
                                        <th class="text-center" style="font-size: 12px">ORAN</th>
                                        <th class="text-center" style="font-size: 12px">ÜRÜN KODU</th>
                                        <th class="text-center" style="font-size: 12px">STOK ADI</th>
                                        <th class="text-center" style="font-size: 12px">KONUM</th>
                                        <th class="text-center" style="font-size: 12px">MARKA</th>
                                        <th class="text-center" style="font-size: 12px">ADET</th>
                                        <th class="text-center" style="font-size: 12px">KALINLIK</th>
                                        <th class="text-center" style="font-size: 12px">GENİŞLİK | ±</th>
                                        <th class="text-center" style="font-size: 12px">KAPLAMA</th>
                                        <th class="text-center" style="font-size: 12px">KALİTE</th>
                                        <th class="text-wrap" style="font-size: 11px">KULL. METRAJ/TAM METRAJ</th>
                                        <th class="text-wrap" style="font-size: 11px">KULL. AĞIRLIK/TAM AĞIRLIK</th>



                                    </tr>
                                    <tr>
                                        <td id="fabrika" class="text-center">
                                            <span>MANİSA</span>
                                        </td>
                                        <td class="text-center p-0" id="or">
                                            <input class="border-0 text-center" style="width:80px" id="hamoran" type="number" value="1.0000">
                                            <script>
                                                var ham = document.getElementById("hamoran");
                                                ham.oninput = function () {
                                                    if (this.value >= 1) {
                                                        this.value = "1.0000";
                                                    } else if (this.value < 0) {
                                                        this.value = 0;
                                                    }
                                                    rechange()
                                                };
                                            </script>
                                        </td>

                                        <td class="text-center p-0" id="urunkodu">
                                            <form onsubmit="return false">
                                                <input class="border-0 text-center" style="flex-grow:2;" id="seri" oninput="rechange()" autocomplete="off">
                                                <button type="button" id="rehberbutton" onclick="rehberAc()" class="btn btn-primary showmodal"><i class="bi bi-list-ul"></i></button>
                                                <i id="rehbermobil" style="cursor:pointer;display:none" onclick="rehberAc()" class="bi bi-list-ul"></i>
                                            </form>

                                        </td>
                                        <td class="text-center p-0">
                                            <textarea class="border-0 w-100 text-center text-wrap" id="stokadi" readonly=""></textarea>
                                        </td>
                                        <td class="text-center p-0">
                                            <input class="border-0  w-100 text-center" readonly="">
                                        </td>
                                        <td class="text-center p-0">
                                            <label class="border-0 text-center text-wrap" id="marka"></label>

                                        </td>
                                        <td class="text-center p-0">
                                            <input class="border-0 w-100 text-center" id="adet" readonly="">
                                        </td>
                                        <td class="text-center p-0">
                                            <input class="border-0 w-100 text-center" id="kalinlik" readonly="">
                                        </td>
                                        <td class="text-center p-0">
                                            <input class="border-0 w-px-50 text-center" id="genislik" readonly="">
                                            <input class="border-1 w-px-30 text-center" style="border-radius:5px" id="genislikalti" value="0" oninput="rechange()">
                                        </td>
                                        <td class="text-center p-0">
                                            <input class="border-0 w-100 text-center" id="kaplama" readonly="">
                                        </td>
                                        <td class="text-center p-0">
                                            <input class="border-0 w-100 text-center" id="kalite" readonly="">
                                        </td>
                                        <td class="text-center  p-0">
                                            <input class="border-0 w-100 text-center" id="metraj" readonly="">
                                        </td>

                                        <td class="text-center">
                                            <input class="border-0 w-100 text-center" id="agirlik" readonly="">
                                        </td>


                                    </tr>
                                    <tr style="display:none">
                                        <th style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%); position: unset">
                                            MAKİNE
                                        </th>
                                        <th style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">OPERATÖR</th>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>
                                        <td class="text-center"><input class="border-0 w-px-50"></td>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>
                                        <td class="text-center"><input class="border-0 w-px-50"></td>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>
                                        <td class="text-center"><input class="border-0 w-px-50"></td>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>
                                        <th class="text-center ms-1" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">ÇIKIŞ</th>
                                        <td class="text-center">
                                            <input class="border-0 w-px-50">
                                        </td>

                                    </tr>

                                </tbody>
                            </table>
                        </div>


                    </div>
                </div>
            </div>
        </div>

        <!-- #endregion -->
        <!-- #region Table -->

        <div class="row mt-2">
            <div class="col">
                <div class="card">
                    <div class="card-body">
                        <div class="table-responsive">

                            <table class="table table-bordered border-dark" id="DLTable">
                                <tbody>
                                    <tr id="th" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);">
                                        <th class=""></th>
                                        <th class="text-center" style="font-size: 11px;">ORAN</th>
                                        <th class="text-center" style="font-size: 11px;">MAKİNE</th>
                                        <th class="text-center" style="font-size: 11px;">STOK ÖLÇÜLERİ</th>
                                        <th class="text-center" style="font-size: 11px;">GENİŞLİK</th>
                                        <th class="text-center" style="font-size: 11px;">ADET</th>
                                        <th style="background-color:white;border-bottom:hidden;border-top:hidden;width:1px"></th>
                                        <th class="text-center" style="font-size: 11px">MAKİNE 1</th>
                                        <th class="text-center" style="font-size: 11px">STOK ÖLÇÜLERİ</th>
                                        <th class="text-center" style="font-size: 11px">ADET</th>
                                        <th style="background-color:white;border-bottom:hidden;border-top:hidden;width:1px"></th>
                                        <th class="text-center" style="font-size: 11px">AĞIRLIK</th>
                                        <th class="text-center" style="font-size: 11px">MÜŞTERİ</th>
                                    </tr>
                                    <tr>
                                        <td class="text-center p-1">1</td>
                                        <td class="p-1 text-center">
                                            <div>
                                                <input class="border-0 text-center" style="font-size:small" type="number" value="1.00" max="1.00" min="0.00" onblur="oran(this)">
                                                <div class="text-center">
                                                    <img onclick="addRow1(this)" style="width:18px;cursor:pointer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAAmlJREFUWEftmOFxFDEMhd9VQKiApAJIBUkHQAVABZAKQiogVABUAHRAKiCpINABVEDmu7FuhM5ey3s3zE4G/dm5W9l6lp7l511pYbZaGB7dG0BPJL2QxPOgPEn2taRf5fmpPIeKMJqht5JeFxCZQIC7lHSRccYnC+iZpHeSDrMTB78fks4kfemNzwAiK+dhop9l8m+SCEapMEoI6FNJLOJRGMdck9nqAfpYuGLzAoRJ+T9jL4u/B8bYV63BU4BiZr5KIgC8GDFID4inbhBZYv4tawEi3Z+dNzsGMLtYzPbzGqdagOCFpZnMALBl8OWkvLySBK9aBqktU8Q4io41QL5UcAaiTpXJ+zdLUQJTPoA8KL+3/GuACG4DIF+PwCOAwEHpPxRAxHrosxQBkY3vxYHsZPrOKCCm95Q49h09AqKr0omx95LeJFg8B1AzTgQEIY2g1V1QATgHkN/FbAQ2xtoiIDru4/Lur1SWQQbW42Iym5AF1XZZ3H2eGsQkVhXQHxcpgq0dIYmKrl1qu68aKwZdHKBeyTa1dqnJNMZYSl+yG6entji0OFIvbtv7VFbPmj1t+3RjJN6/PDp+RzncO1xZCT1in4frrQOROlzjWYNkoGu3LNMYbayXH9WzMivQJmVnsjvuJNCIETszq0OOzJGwyA0v8oYlrC06rgpOARRJmzG0D9cnhJnZpBzu3TpqmTKOkTEaKVzw1yCkr12Dop7qKcqhiyJNM96zMlnCB9Boq71cFH1QysXEJnF7gOgzLKR65akNzpSsNo6ODj/sY4NpKA5K+9gA/6yUPeCb93MBpQOMOv4H1MvYHYPjoiWLe0qnAAAAAElFTkSuQmCC">
                                                </div>

                                            </div>



                                        </td>
                                        <td class="border-0 text-center p-1 w-auto">

                                            <select class="js-select" style="width:100px" onchange="MachineChange(this, 'DLTable')">

                                                <option selected disabled>SEÇİNİZ</option>


                                                <option value="DL01">DL01</option>


                                            </select>






                                            <input class="border-0 text-center" id="1input" readonly style="display:none" />



                                        </td>

                                        <td class="p-0 text-center">
                                            <select class="js-select" style="width:350px" disabled onchange="StokChange(this)">
                                                <option selected disabled>SEÇİNİZ</option>
                                                @foreach (var item in ViewBag.Stok_Adlari)
                                                {
                                                    <option value="@item.STOK_ADI">@item.STOK_ADI</option>
                                                }
                                            </select>


                                        </td>
                                        <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" oninput="DlInputChange(this)" /></td>
                                        <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" oninput="DlInputChange(this)" /></td>
                                        <td style="background-color:white;border-bottom:hidden;border-top:hidden;width:1px"></td>
                                        <td class="text-center p-1">
                                            <i onclick="ReferansSecimiTemizle(this, 'DL')" data-bs-toggle="tooltip" data-popup="tooltip-custom" data-bs-placement="top" data-bs-html="true" data-bs-original-title="<span>Seçimi Temizle</span>" class="bi bi-x-lg me-2" style="color: #203289; font-size: larger; display: none; cursor: pointer; float: left"></i>
                                            <select class="js-select selectmakina2" style="width:100px;float:left" onchange="RefMachineChange(this)">
                                                <option selected disabled>SEÇİNİZ</option>
                                            </select>
                                        </td>
                                        <td class="text-center p-0">
                                            <select class="js-select" style="width:350px" disabled onchange="RefStokChange(this)">
                                                <option selected disabled>SEÇİNİZ</option>
                                                @foreach (var item in ViewBag.Stok_Adlari)
                                                {
                                                    <option value="@item.STOK_ADI">@item.STOK_ADI</option>
                                                }
                                            </select>
                                        </td>
                                        <td class="text-center p-1">
                                        </td>
                                        <td style="background-color:white;border-bottom:hidden;border-top:hidden;width:1px"></td>
                                        <td class="text-center p-1">
                                            <input class="border-0 text-center" style="width:80px;display:none" readonly />
                                            <input class="border-0 text-center" style="width:80px" readonly="">
                                        </td>
                                        <td class="text-center p-1">
                                            <select class="js-select" style="width:150px">
                                                <option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>
                                            </select>
                                        </td>

                                    </tr>

                                </tbody>
                            </table>

                            @Html.Partial("IsEmriPartials/IsEmri_TP")


                            <table class="table table-bordered border-dark" id="BKTable" style="display:none">



                                <tbody>
                                    <tr id="th" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);">
                                        <th class=""></th>
                                        <th class="text-center" style="font-size: 11px;">ORAN</th>
                                        <th class="text-center" style="font-size: 11px;">MAKİNE</th>
                                        <th class="text-center" style="font-size: 11px;">STOK ÖLÇÜLERİ</th>
                                        <th class="text-center" style="font-size: 11px">ADET</th>
                                        <th class="text-center" style="font-size: 11px">AĞIRLIK</th>
                                        <th class="text-center" style="font-size: 11px">MÜŞTERİ</th>
                                    </tr>
                                    <tr>
                                        <td class="text-center p-1">1</td>
                                        <td class="p-1 text-center">
                                            <div>
                                                <input class="border-0 text-center" style="font-size:small;width:100px" type="number" value="1.00" max="1.00" min="0.00" onblur="oranBK(this)">
                                                <div class="text-center">
                                                    <img onclick="addRow1(this)" style="width:18px;cursor:pointer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAAmlJREFUWEftmOFxFDEMhd9VQKiApAJIBUkHQAVABZAKQiogVABUAHRAKiCpINABVEDmu7FuhM5ey3s3zE4G/dm5W9l6lp7l511pYbZaGB7dG0BPJL2QxPOgPEn2taRf5fmpPIeKMJqht5JeFxCZQIC7lHSRccYnC+iZpHeSDrMTB78fks4kfemNzwAiK+dhop9l8m+SCEapMEoI6FNJLOJRGMdck9nqAfpYuGLzAoRJ+T9jL4u/B8bYV63BU4BiZr5KIgC8GDFID4inbhBZYv4tawEi3Z+dNzsGMLtYzPbzGqdagOCFpZnMALBl8OWkvLySBK9aBqktU8Q4io41QL5UcAaiTpXJ+zdLUQJTPoA8KL+3/GuACG4DIF+PwCOAwEHpPxRAxHrosxQBkY3vxYHsZPrOKCCm95Q49h09AqKr0omx95LeJFg8B1AzTgQEIY2g1V1QATgHkN/FbAQ2xtoiIDru4/Lur1SWQQbW42Iym5AF1XZZ3H2eGsQkVhXQHxcpgq0dIYmKrl1qu68aKwZdHKBeyTa1dqnJNMZYSl+yG6entji0OFIvbtv7VFbPmj1t+3RjJN6/PDp+RzncO1xZCT1in4frrQOROlzjWYNkoGu3LNMYbayXH9WzMivQJmVnsjvuJNCIETszq0OOzJGwyA0v8oYlrC06rgpOARRJmzG0D9cnhJnZpBzu3TpqmTKOkTEaKVzw1yCkr12Dop7qKcqhiyJNM96zMlnCB9Boq71cFH1QysXEJnF7gOgzLKR65akNzpSsNo6ODj/sY4NpKA5K+9gA/6yUPeCb93MBpQOMOv4H1MvYHYPjoiWLe0qnAAAAAElFTkSuQmCC">
                                                </div>
                                            </div>



                                        </td>
                                        <td class="border-0 text-center p-1 w-auto">
                                            <select class="js-select" style="width:100px" onchange="MachineChange(this, 'BKTable')">
                                                <option selected disabled>SEÇİNİZ</option>
                                                <option value="BK01">BK01</option>
                                            </select>
                                        </td>

                                        <td class="p-0 text-center">
                                            <select class="js-select" style="width:350px" disabled onchange="StokChangeBK(this)">
                                                <option selected disabled>SEÇİNİZ</option>
                                                @foreach (var item in ViewBag.Stok_Adlari)
                                                {
                                                    <option value="@item.STOK_ADI">@item.STOK_ADI</option>
                                                }
                                            </select>
                                        </td>

                                        <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" readonly /></td>

                                        <td class="text-center p-1">
                                            <input class="border-0 text-center" style="width:80px;display:none" readonly />
                                            <input class="border-0 text-center" style="width:80px" readonly="">
                                        </td>

                                        <td class="text-center p-1">
                                            <select class="js-select" style="width:150px">
                                                <option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>
                                            </select>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>

                            <table class="table table-bordered border-dark" id="PBTable" style="display:none">
                                <tbody>
                                    <tr id="th" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);">
                                        <th class=""></th>
                                        <th class="text-center" style="font-size: 11px;">ORAN</th>
                                        <th class="text-center" style="font-size: 11px;">MAKİNE</th>
                                        <th class="text-center" style="font-size: 11px;">STOK ÖLÇÜLERİ</th>
                                        <th class="text-center" style="font-size: 11px">ADET</th>
                                        <th class="text-center" style="font-size: 11px">AĞIRLIK</th>
                                        <th class="text-center" style="font-size: 11px">MÜŞTERİ</th>
                                    </tr>
                                    <tr>
                                        <td class="text-center p-1">1</td>
                                        <td class="p-1 text-center">
                                            <div>
                                                <input class="border-0 text-center" style="font-size:small" type="number" value="1.00" max="1.00" min="0.00" onblur="oranPB(this)">
                                            </div>
                                        </td>
                                        <td class="border-0 text-center p-1 w-auto">
                                            <select class="js-select" style="width:100px" onchange="MachineChange(this, 'PBTable')">
                                                <option selected disabled>SEÇİNİZ</option>
                                                <option value="PB01">PB01</option>
                                                <option value="PB02">PB02</option>
                                            </select>
                                        </td>

                                        <td class="p-0 text-center">
                                            <select class="js-select" style="width:350px" disabled onchange="StokChangePB(this)">
                                                <option selected disabled>SEÇİNİZ</option>
                                                @foreach (var item in ViewBag.Stok_Adlari)
                                                {
                                                    <option value="@item.STOK_ADI">@item.STOK_ADI</option>
                                                }
                                            </select>
                                        </td>

                                        <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" readonly /></td>

                                        <td class="text-center p-1">
                                            <input class="border-0 text-center" style="width:80px;display:none" readonly />
                                            <input class="border-0 text-center" style="width:80px" readonly="">
                                        </td>

                                        <td class="text-center p-1">
                                            <select class="js-select" style="width:150px">
                                                <option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>
                                            </select>
                                        </td>

                                    </tr>
                                </tbody>
                            </table>


                            <table class="table table-bordered border-dark" id="RFTable" style="display:none">
                                <tbody>
                                    <tr id="th" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);">
                                        <th class=""></th>
                                        <th class="text-center" style="font-size: 11px;">ORAN</th>
                                        <th class="text-center" style="font-size: 11px;">MAKİNE</th>
                                        <th class="text-center" style="font-size: 11px;">STOK ÖLÇÜLERİ</th>
                                        <th class="text-center" style="font-size: 11px">ADET</th>
                                        <th class="text-center" style="font-size: 11px">AĞIRLIK</th>
                                        <th class="text-center" style="font-size: 11px">MÜŞTERİ</th>
                                    </tr>
                                    <tr>
                                        <td class="text-center p-1">1</td>
                                        <td class="p-1 text-center">
                                            <div>
                                                <input class="border-0 text-center" style="font-size:small" type="number" value="1.00" max="1.00" min="0.00" onblur="oranRF(this)">
                                            </div>
                                        </td>
                                        <td class="border-0 text-center p-1 w-auto">
                                            <select class="js-select" style="width:100px" onchange="MachineChange(this, 'RFTable')">
                                                <option selected disabled>SEÇİNİZ</option>
                                                <option value="RF01">RF01</option>
                                                <option value="RF02">RF02</option>
                                                <option value="RF03">RF03</option>
                                            </select>
                                        </td>

                                        <td class="p-0 text-center">
                                            <select class="js-select" style="width:350px" disabled onchange="StokChangeRF(this)">
                                                <option selected disabled>SEÇİNİZ</option>
                                                @foreach (var item in ViewBag.Stok_Adlari)
                                                {
                                                    <option value="@item.STOK_ADI">@item.STOK_ADI</option>
                                                }
                                            </select>
                                        </td>

                                        <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" readonly /></td>

                                        <td class="text-center p-1">
                                            <input class="border-0 text-center" style="width:80px;display:none" readonly />
                                            <input class="border-0 text-center" style="width:80px" readonly="">
                                        </td>

                                        <td class="text-center p-1">
                                            <select class="js-select" style="width:150px">
                                                <option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>
                                            </select>
                                        </td>

                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="row mt-3">
                            <div class="col">
                                <div class="table-responsive text-nowrap">
                                    <table class="table table-bordered" id="fireTable" style="border-color:black;">
                                        <tbody>

                                            <tr style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);">
                                                <th class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">

                                                </th>
                                                <td class="text-center p-1" style="font-size: 11px;font-weight:bold;width:20px">
                                                    FİRE YÜZDESİ
                                                </td>
                                                <td class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                    FİRE GENİŞLİĞİ (mm)
                                                </td>
                                                <td class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                    FİRE AĞIRLIĞI (kg)
                                                </td>

                                            </tr>
                                            <tr style="background-color: #edf0f5 ">
                                                <th class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                    FİRE
                                                </th>
                                                <td class="text-center p-1">
                                                    <input class="border-0 text-center" style="width:80px;background-color:transparent" id="fireyuzde" keyup="updateinput(this.value)" readonly="">
                                                </td>
                                                <td class="text-center p-1">
                                                    <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagir" readonly="">
                                                </td>
                                                <td class="text-center p-1">
                                                    <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagirligi" readonly="">
                                                </td>

                                            </tr>
                                            <tr style="background-color: #e8ebeb ">

                                                <th class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                    GENEL FİRE
                                                </th>
                                                <td class="text-center p-1">
                                                    <input class="border-0 text-center" style="width:80px;background-color:transparent" id="fireyuzde1" readonly="">
                                                </td>
                                                <td class="text-center p-1">
                                                    <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagir1" readonly="">
                                                </td>
                                                <td class="text-center p-1">
                                                    <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagirligi1" readonly="">
                                                </td>

                                            </tr>
                                        </tbody>
                                    </table>

                                </div>
                            </div>

                            <div class="col-6">
                                <div class="row me-1">
                                    <div class="col">
                                        <button class="float-end" onclick="addRow()" id="addRw" style="cursor: pointer; background-color: transparent; background-repeat: no-repeat; border: none;"><img style="width:20px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAAmlJREFUWEftmOFxFDEMhd9VQKiApAJIBUkHQAVABZAKQiogVABUAHRAKiCpINABVEDmu7FuhM5ey3s3zE4G/dm5W9l6lp7l511pYbZaGB7dG0BPJL2QxPOgPEn2taRf5fmpPIeKMJqht5JeFxCZQIC7lHSRccYnC+iZpHeSDrMTB78fks4kfemNzwAiK+dhop9l8m+SCEapMEoI6FNJLOJRGMdck9nqAfpYuGLzAoRJ+T9jL4u/B8bYV63BU4BiZr5KIgC8GDFID4inbhBZYv4tawEi3Z+dNzsGMLtYzPbzGqdagOCFpZnMALBl8OWkvLySBK9aBqktU8Q4io41QL5UcAaiTpXJ+zdLUQJTPoA8KL+3/GuACG4DIF+PwCOAwEHpPxRAxHrosxQBkY3vxYHsZPrOKCCm95Q49h09AqKr0omx95LeJFg8B1AzTgQEIY2g1V1QATgHkN/FbAQ2xtoiIDru4/Lur1SWQQbW42Iym5AF1XZZ3H2eGsQkVhXQHxcpgq0dIYmKrl1qu68aKwZdHKBeyTa1dqnJNMZYSl+yG6entji0OFIvbtv7VFbPmj1t+3RjJN6/PDp+RzncO1xZCT1in4frrQOROlzjWYNkoGu3LNMYbayXH9WzMivQJmVnsjvuJNCIETszq0OOzJGwyA0v8oYlrC06rgpOARRJmzG0D9cnhJnZpBzu3TpqmTKOkTEaKVzw1yCkr12Dop7qKcqhiyJNM96zMlnCB9Boq71cFH1QysXEJnF7gOgzLKR65akNzpSsNo6ODj/sY4NpKA5K+9gA/6yUPeCb93MBpQOMOv4H1MvYHYPjoiWLe0qnAAAAAElFTkSuQmCC"></button>
                                        <button class="float-end" onclick="removeRow()" id="removeRw" style="cursor: pointer; background-color: transparent; background-repeat: no-repeat; border: none;"><img style="width:20px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAVJJREFUSEu9leFRwzAMhb9OAkwAnQBGgAlgA+gkwATABMAGMAGwQZkE7uOsnuMmscOl1Z1/xFb09GTpecGObbHj+LQAXAGnwEla5vSZ1gvwOpbkGMA5cAscVliugRUg2JYNAdwB18n7G/D7LWXttmzOgBvgIPnpI1DH+gDy4P7g95gJIlPtPoFu/EsAy/KcTpdZxrVekNFHcrrIy1UCWE8pt2ReggYTYxzFYQ5gtzwA1rx2sUOMIsENixzgEbj8Z/YBGCyeABPuzIG9fQxMqX3JJO7CWMbpAPwk75xV7NUuue+fv73BgxRxVoA5S/QVsrLXS44h6/RxrfjF+Wib6jvHoHXmaO9SIYtc7BwcBWw2sYtAOYhl8/u9kGsfIRMIWdlS0nIOyiy9dAOH3g+xsOYCTXpw8mACuZQBpUSzz50bg/YG7lPTiR3Z5t7y6LdFGvD6BU/pUBk06brSAAAAAElFTkSuQmCC"></button>
                                    </div>
                                </div>
                                <div class="row mt-3 me-1">
                                    <div class="col">
                                        <button disabled class="btn btn-info float-start" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);color:black;font-size:11px" onclick="kaydet()" id="kaydet">KAYDET</button>
                                        <button class="btn btn-info float-start ms-1" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);color:black;font-size:11px" onclick="tablosil()" id="tablosilButton">SİL</button>
                                        <div class="form-check form-switch mt-3" id="tamamidiv" style="display:none;float:right">
                                            <input id="tamami" checked="checked" onchange="chcked()" class="form-check-input" type="checkbox">
                                            <label class="form-check-label" for="tamami">Tamamı Kullanılsın</label>
                                        </div>
                                    </div>

                                </div>



                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- #endregion -->
        <div class="row mt-2">
            <div class="col text-end">
                <button class="btn btn-info" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);color:black;font-size:11px" onclick="sil()" id="sil"><i class='bx bx-trash'> SİL</i></button>
                <button class="btn btn-info text-nowrap" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);color:black;font-size:11px" onclick="netsisaktar()"><i class='bx bx-transfer'></i> NETSİSE AKTAR</button>
            </div>
        </div>
        <div class="mt-3" style="overflow:auto !important;max-height:40vh">

            <div class="row me-0">
                <div class="col">

                    <div style="overflow:auto !important">
                        
                        <div class="text-center mb-2" id="DLPivotTop"></div>
                        <div class="text-center" id="TPPivotTop" style="display:none"></div>
                        <div class="text-center" id="BKPivotTop" style="display:none"></div>
                        <div class="text-center" id="PBPivotTop" style="display:none"></div>
                        <div class="text-center" id="RFPivotTop" style="display:none"></div>
                    </div>
                    




                </div>
            </div>


            <div class="row mb-2 me-0">


                <div class="col">
                    <div class="text-center mt-3" id="DLPivot"></div>
                    <div class="text-center mt-3" id="TPPivot" style="display:none"></div>
                    <div class="text-center mt-3" id="BKPivot" style="display:none"></div>
                    <div class="text-center mt-3" id="PBPivot" style="display:none"></div>
                    <div class="text-center mt-3" id="RFPivot" style="display:none"></div>

                </div>



            </div>
        </div>
    </div>
    @Html.Partial("IsEmriPartials/RehberPartial")
<script>

        if ($(window).width() < 600) {
            $("#divPartial2").show();
        }
        else {
            $("#divPartial").show();

        }
        function rehberAc() {

            $("#rehberSec").modal("show");
            $('#urunler').bootstrapTable("destroy").bootstrapTable()

        }
    function rehberAktar(seri) {
        $("#seri").val(seri).trigger("input");
        $("#rehberSec").modal("hide");
    }
        function ModalKapat() {
            $("#rehberSec").modal("hide");
        }
        const seri = document.getElementById('seri');
        const genislik = document.getElementById('genislik');
        const genislikarti = document.getElementById('genislikalti');
        const kalinlik = document.getElementById('kalinlik');
        const agirlik = document.getElementById('agirlik');
        const marka = document.getElementById('marka');
        const adet = document.getElementById('adet');
        const kaplama = document.getElementById('kaplama');
        const stokAdi = document.getElementById('stokadi');
        const kalite = document.getElementById('kalite');
        const hamoran = document.getElementById('hamoran');

         function rechange() {
            $.getJSON("http://192.168.2.13:83/api/seri/serirehber", function (data) {
                jsonObj = data;
            }).done(function () {
                var b = jsonObj.find(x => x.SERI_NO === seri.value);
                var top = 0;
                hamkod = b.STOK_KODU;
                if (localStorage.DLlist != "null" && localStorage.DLlist != null) {
                    var j = JSON.parse(localStorage.DLlist);
                    var son = j.filter(x => x.GIRDI1 == seri.value);
                    if (son.length > 0) {
                        var s = [];
                        for (let i = 0; i < son.length; i++) {
                            if (!s.includes(son[i].HAMORAN)) {
                                s.push(son[i].HAMORAN)
                            }
                        }
                        if (s.length > 1) {
                            top = eval(s.join('+'));
                        } else {
                            top = s[0];
                        }


                    }

                }

                if (localStorage.BKPivotVeri != "null" && localStorage.BKPivotVeri != null) {
                    var j = JSON.parse(localStorage.BKPivotVeri);
                    var son = j.filter(x => x.GIRDI1 == seri.value);
                    if (son.length > 0) {
                        var s = [];
                        for (let i = 0; i < son.length; i++) {
                            if (!s.includes(son[i].HAMORAN)) {
                                s.push(son[i].HAMORAN)
                            }
                        }
                        if (s.length > 1) {
                            top = eval(s.join('+'));
                        } else {
                            top = s[0];
                        }


                    }


                }
                if (localStorage.PBPivotVeri != "null" && localStorage.PBPivotVeri != null) {
                    var j = JSON.parse(localStorage.PBPivotVeri);
                    var son = j.filter(x => x.GIRDI1 == seri.value);
                    if (son.length > 0) {
                        var s = [];
                        for (let i = 0; i < son.length; i++) {
                            if (!s.includes(son[i].HAMORAN)) {
                                s.push(son[i].HAMORAN)
                            }
                        }
                        if (s.length > 1) {
                            top = eval(s.join('+'));
                        } else {
                            top = s[0];
                        }


                    }


                }
                if (localStorage.RFPivotVeri != "null" && localStorage.RFPivotVeri != null) {
                    var j = JSON.parse(localStorage.RFPivotVeri);
                    var son = j.filter(x => x.GIRDI1 == seri.value);
                    if (son.length > 0) {
                        var s = [];
                        for (let i = 0; i < son.length; i++) {
                            if (!s.includes(son[i].HAMORAN)) {
                                s.push(son[i].HAMORAN)
                            }
                        }
                        if (s.length > 1) {
                            top = eval(s.join('+'));
                        } else {
                            top = s[0];
                        }


                    }


                }
                hamoran.value = (1 - top).toFixed(4);
                ham.oninput = function () {
                    if (this.value >= 1 - top) {
                        this.value = ((1 - top).toFixed(4)).toString();
                    } else if (this.value < 0) {
                        this.value = 0;
                    }
                    if (b != null) {
                        kalinlik.value = b.ACIK2;
                        genislik.value = b.ACIK1;
                        agirlik.value = (b.MIKTAR * hamoran.value).toLocaleString('tr-TR') + " / " + (b.MIKTAR).toLocaleString('tr-TR');
                        marka.innerHTML = b.MENSEI;
                        adet.value = b.MIKTAR2;
                        kaplama.value = b.SERI_NO_4;
                        kalite.value = b.SERI_NO_3;
                        stokAdi.innerHTML = b.STOK_ADI;
                        metraj.value = parseFloat((parseFloat(b.MIKTAR * hamoran.value)) / ((parseFloat(b.ACIK1) + parseFloat(document.getElementById('genislikalti').value)) * parseFloat((b.ACIK2).replace(",", ".")) * (0.00786))).toFixed(2) + " / " + parseFloat(parseFloat((b.MIKTAR)) / ((parseFloat(b.ACIK1) + parseFloat(document.getElementById('genislikalti').value)) * parseFloat((b.ACIK2).replace(",", ".")) * (0.00786))).toFixed(2);
                        var alltr = document.getElementsByTagName("table")[1].getElementsByTagName("tr");



                    }
                    else {
                        genislik.value = "";
                        kalinlik.value = "";
                        agirlik.value = "";
                        marka.innerHTML = "";
                        adet.value = "";
                        kaplama.value = "";
                        stokAdi.innerHTML = "";
                        kalite.value = "";
                        $("#metraj").val("");
                    }
                    var Tip = $('input[name="uretim-tip"]:checked').val();


                    var tr = document.getElementById("DLTable").getElementsByTagName("tr");
                    //Hammadde seri değişince aktif olan fonsiyon
                    switch (Tip) {
                        case 'DL':
                            for (let i = 1; i < tr.length; i++) {
                                if (i == 1) {
                                    MachineChange(tr[i].getElementsByTagName("select")[0], 'DLTable')
                                    tr[i].getElementsByTagName("input")[0].onblur();

                                } else {
                                    MachineChange(tr[i].getElementsByTagName("select")[0], 'DLTable')
                                    DlInputChange(tr[i].getElementsByTagName("input")[2]);

                                }
                            }
                            break;
                        case 'BK':

                            var l = $("#BKTable").find("tr").length;
                            if (l > 2) {
                                for (let a = 1; a < l; a++) {
                                    if (a == 1) {

                                        $("#BKTable").find("tr").eq(a).find("select").eq(1).trigger("change");
                                    } else {

                                        $("#BKTable").find("tr").eq(a).find("input").eq(0).trigger("blur");
                                    }
                                }
                            } else {

                                $("#BKTable").find("select").eq(1).trigger("change");
                            }
                            break;
                        case 'PB':
                            $("#PBTable").find("select").eq(1).trigger("change");
                            break;
                        case 'RF':
                            $("#RFTable").find("select").eq(1).trigger("change");
                            break;
                    }
                    KaydetAktivite()
                    if (top != 0) {
                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'center',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })
                        if ((1 - top) == 0) {
                            KaydetAktivite()
                            Toast.fire({
                                icon: 'error',
                                title: 'Ürün kullanılabilir değil!'
                            });

                        } else {
                            Toast.fire({
                                icon: 'info',
                                title: 'Ürün maksimum %' + (((1 - top).toFixed(4)) * 100) + ' oranında kullanılabilir!'
                            });
                            KaydetAktivite()

                        }

                    } else {
                        KaydetAktivite()
                    }

                };

                if (b != null) {
                    kalinlik.value = b.ACIK2;
                    genislik.value = b.ACIK1;
                    agirlik.value = (b.MIKTAR * hamoran.value).toLocaleString('tr-TR') + " / " + (b.MIKTAR).toLocaleString('tr-TR');
                    marka.innerHTML = b.MENSEI;
                    adet.value = b.MIKTAR2;
                    kaplama.value = b.SERI_NO_4;
                    kalite.value = b.SERI_NO_3;
                    stokAdi.innerHTML = b.STOK_ADI;
                    metraj.value = parseFloat((parseFloat(b.MIKTAR * hamoran.value)) / ((parseFloat(b.ACIK1) + parseFloat(document.getElementById('genislikalti').value)) * parseFloat((b.ACIK2).replace(",", ".")) * (0.00786))).toFixed(2) + " / " + parseFloat(parseFloat((b.MIKTAR)) / ((parseFloat(b.ACIK1) + parseFloat(document.getElementById('genislikalti').value)) * parseFloat((b.ACIK2).replace(",", ".")) * (0.00786))).toFixed(2);
                    var alltr = document.getElementsByTagName("table")[1].getElementsByTagName("tr");



                }
                else {
                    genislik.value = "";
                    kalinlik.value = "";
                    agirlik.value = "";
                    marka.innerHTML = "";
                    adet.value = "";
                    kaplama.value = "";
                    stokAdi.innerHTML = "";
                    kalite.value = "";
                    $("#metraj").val("");
                }
                var Tip = $('input[name="uretim-tip"]:checked').val();


                var tr = document.getElementById("DLTable").getElementsByTagName("tr");
                //Hammadde seri değişince aktif olan fonsiyon
                switch (Tip) {
                    case 'DL':
                        for (let i = 1; i < tr.length; i++) {
                            if (i == 1) {
                                if (tr[i].getElementsByTagName("input")[2].value.length>0) {

                                    tr[i].getElementsByTagName("input")[0].onblur();
                                }
                            } else {
                                if (tr[i].getElementsByTagName("input")[2].value.length > 0) {
                                    DlInputChange(tr[i].getElementsByTagName("input")[2]);

                                }
                            }

                            MachineChange(tr[i].getElementsByTagName("select")[0], 'DLTable')
                        }
                        oran(tr[1].getElementsByTagName("input")[0])
                        break;
                    case 'BK':
                        var l = $("#BKTable").find("tr").length;
                        if (l > 2) {
                            for (let a = 1; a < l; a++) {
                                if (a == 1) {
                                    MachineChange($("#BKTable").find("tr").eq(a).find("select").eq(0).val(),'BKTable')
                                    $("#BKTable").find("tr").eq(a).find("select").eq(1).trigger("change");
                                } else {

                                    $("#BKTable").find("tr").eq(a).find("input").eq(0).trigger("blur");
                                }
                            }
                            KaydetAktivite()
                        } else {
                            $("#BKTable").find("select").eq(0).trigger("change");
                            $("#BKTable").find("select").eq(1).trigger("change");
                            KaydetAktivite()
                        }

                        break;
                    case 'PB':
                        $("#PBTable").find("select").eq(0).trigger("change");
                        $("#PBTable").find("select").eq(1).trigger("change");
                        KaydetAktivite()
                        break;
                    case 'RF':
                        $("#RFTable").find("select").eq(0).trigger("change");
                        $("#RFTable").find("select").eq(1).trigger("change");
                        KaydetAktivite()
                        break;
                }
                KaydetAktivite()
                if (top != 0) {
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'center',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    })
                    if ((1 - top) == 0) {
                        KaydetAktivite()
                        Toast.fire({
                            icon: 'error',
                            title: 'Ürün kullanılabilir değil!'
                        });

                    } else {
                        Toast.fire({
                            icon: 'info',
                            title: 'Ürün maksimum %' + (((1 - top).toFixed(4)) * 100) + ' oranında kullanılabilir!'
                        });
                        KaydetAktivite()

                    }

                } else {
                    KaydetAktivite()
                }



            })




    }
    var DLlist = null;
    var DLListTop = null;
    var serilist = [];
    var isemrilist = [];
    var siralist = [];
    var say = 0;
    var tp = 0;
    var sonSeri = null;
    var takiplist = [];
    var takiplist2 = null;
    var DLList = null;
    var OldStokAdi = null;
    var Stoklar = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
    $(document).on('select2:open', () => {
        document.querySelector('.select2-search__field').focus();
    });

    $(document).ready(function () {
       
        $('#pageName').html('<div class="dot"></div> İş Emri')
        
        $(".js-select").select2(
            {
                "language": {
                    "noResults": function () {
                        return "Sonuç bulunamadı.";
                    }
                },
                escapeMarkup: function (markup) {
                    return markup;
                }
            });
        var tpl = $.pivotUtilities.aggregatorTemplates;
        function drawPivot() {

            $(function () {
                $("#DLPivot").pivot(
                    takiplist,
                    {
                        rows: ["GIRDI1", "GIRDI2", "ISEMRINO", "STOKADI", "KALINLIK", "KALITE", "KAPLAMA", "GENISLIK", "ADET", "REF_ISEMRINO", "REF_STOKOLCUSU", "REF_ADET", "MIKTAR_SABITLE", "AGIRLIK", "FIRE", "HAMSARF"],
                        cols: [],
                        aggregator: tpl.sum()(["ADET"]),
                        sorters: {

                            GIRDI1: function (a, b) { return a - b; } //sort backwards
                        }


                    }, false, "tr")
            })
        }
        function getPivot() {

                    document.body.style.cursor = 'default';
                    takiplist = JSON.parse(localStorage.DLlist);
                    var girdi1 = [];
                    for (let i = 0; i < takiplist.length; i++) {

                        if (!girdi1.includes(takiplist[i].GIRDI1)) {

                            girdi1.push({ GIRDI1: takiplist[i].GIRDI1 });

                        }

                    }
                    var newtakip = [];
                    var hamtop = 0;
                    var firtop = 0;
                    for (let i = 0; i < girdi1.length; i++) {
                        var sum = 0;
                        var fil = takiplist.filter(x => x.GIRDI1 == girdi1[i].GIRDI1);


                            for (let e = 0; e < fil.length; e++) {
                                
                                    sum = sum + parseFloat(fil[e].GENISLIK);
                                

                            }
                        var ek = 0;
                        for (let e = 0; e < fil.length; e++) {
                            if (fil[e].MIKTAR_SABITLE == "E") {
                                fil[e].HAMSARF = parseFloat(parseFloat(fil[e].GENISLIK) / sum) * (parseFloat(fil[e].TAMAGIRLIK)) * parseFloat(fil[e].ORAN);
                                var oldek = ek;
                                ek = ek + fil[e].HAMSARF - parseInt(fil[e].HAMSARF);
                                if (Math.round(ek) != Math.round(oldek)) {
                                    fil[e].HAMSARF = parseInt(fil[e].HAMSARF) + 1;
                                } else {
                                    fil[e].HAMSARF = parseInt(fil[e].HAMSARF)
                                }
                                fil[e].FIRE = fil[e].HAMSARF - (parseFloat(fil[e].AGIRLIK));
                                fil[e].AGIRLIK = parseFloat(parseFloat(fil[e].AGIRLIK));

                                if (fil.length == 1) {
                                    fil[0].FIRE = fil[0].HAMSARF - (parseFloat(fil[0].AGIRLIK));
                                }
                            } else {
                                for (let e = 0; e < fil.length; e++) {
                                    fil[e].HAMSARF = "1";
                                    fil[e].FIRE = "-";
                                    fil[e].AGIRLIK = parseFloat(parseFloat(fil[e].AGIRLIK));
                                }
                            }
                        }

                        if (newtakip.length == 0) {
                            newtakip = fil;
                        } else {
                            newtakip = newtakip.concat(fil);
                        }

                    }
                    takiplist = newtakip;
                    var fn = takiplist.filter(x => x.ISEMRINO === takiplist[0].ISEMRINO).length;
                    for (let i = 0; i < takiplist.length; i++) {
                        tp = tp + parseFloat(takiplist[i].FIRE);
                    }

                    for (let i = 0; i < takiplist.length; i++) {
                        hamtop = hamtop + takiplist[i].HAMSARF;
                        firtop = firtop + takiplist[i].FIRE;
                    }
                    //fireag.value = (firtop / fn).toLocaleString();
                    //fireyuz.value = ((firtop / fn) / (hamtop / fn) * 100).toFixed(2) + " %";
                    localStorage.list4 = JSON.stringify(takiplist);
                    drawPivot();




        }
        takiplist2 = [];
        function drawPivot2() {


            $("#DLPivotTop").pivot(
                takiplist2,
                {
                    rows: ["MUSTERI", "STOKADI", "ADET", "AGIRLIK"]
                }, false, "tr")
        }
        function getPivot2() {

            var result = Grupla(JSON.parse(localStorage.DLlistTop))

            for (let i = 0; i < result.length; i++) {


                takiplist2.push({ STOKADI: result[i].STOKADI, MUSTERI: result[i].MUSTERI, AGIRLIK: result[i].AGIRLIK, ADET: result[i].ADET })


                    }
                    drawPivot2();

                    document.body.style.cursor = 'default';
                    var rr = document.getElementsByClassName("pvtTable")[0].getElementsByTagName("tr");
                    var sum = 0;
                    var sum2 = 0;
                    for (let i = 1; i < rr.length - 1; i++) {
                        sum = sum + parseFloat(rr[i].getElementsByTagName("th")[rr[i].getElementsByTagName("th").length - 2].innerHTML);
                        sum2 = sum2 + parseFloat(rr[i].getElementsByTagName("th")[rr[i].getElementsByTagName("th").length - 1].innerHTML);
                    }
                    document.getElementById("fireagirligi1").value = sum;

                    document.getElementById("fireyuzde1").value = parseFloat(sum / sum2 * 100).toFixed(2) + " %";

        }
        if (localStorage.DLlist != "null" && localStorage.DLlist != null) {

            getPivot2();
            getPivot();
        }
        $("#btnradio12").prop("checked", true).trigger("click");
    })
    var hamkod = null;
    function MachineChange(val, tableId) {
        if (val.value != "SEÇİNİZ") {
            document.getElementById(tableId).getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[1].removeAttribute("disabled");
            $.getJSON("http://192.168.2.13:83/api/ie/besleme", function (data) {
                var d = data.filter(x => x.HAT_KODU == val.value);


                if (OldStokAdi != $("#stokadi").val()) {
                    $(".js-select").select2('destroy');
                    if (document.getElementById(tableId).getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[2].value == "SEÇİNİZ") {


                        var $sel2 = document.getElementById(tableId).getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[2];
                        $sel2.replaceChildren();
                        var opt = document.createElement("option");
                        opt.value = "SEÇİNİZ";
                        opt.text = "SEÇİNİZ";
                        opt.setAttribute("selected", "");
                        opt.setAttribute("disabled", "");
                        $sel2.appendChild(opt);
                        for (let i = 0; i < d.length; i++) {
                            var opt1 = document.createElement("option");
                            opt1.value = d[i].HAT_KODU2;
                            opt1.text = d[i].HAT_KODU2;
                            $sel2.appendChild(opt1);
                        }



                    }

                    $(".js-select").select2(
                        {
                            "language": {
                            "noResults": function () {
                            return "Sonuç bulunamadı.";
                        }
                    },
                        escapeMarkup: function (markup) {
                            return markup;
                        }
                        });
                    DlInputChange(document.getElementById(tableId).getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("input")[2]);
                }

                KaydetAktivite();
            }).done(function () {
                if (val.value.substring(0, 2) != "TP") {
                    if (hamkod != null) {
                        if (OldStokAdi != $("#stokadi").html()) {
                            var url = "http://192.168.2.13:83/api/seri/receteden/" + hamkod + "/0/"+ val.value
                            if (val.value.substring(0, 2) == "BK") {
                                var gen = $('#genislik').val();
                                url = "http://192.168.2.13:83/api/seri/receteden/" + hamkod + "/" + gen + "/" + val.value
                            }
                            $.getJSON(url, function (d1) {
                                var $sel3 = document.getElementById(tableId).getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[1];
                                $sel3.replaceChildren();
                                var opt2 = document.createElement("option");
                                opt2.value = "SEÇİNİZ";
                                opt2.text = "SEÇİNİZ";
                                opt2.setAttribute("selected", "");
                                opt2.setAttribute("disabled", "");
                                $sel3.appendChild(opt2);
                                for (let i = 0; i < d1.length; i++) {
                                    var opt3 = document.createElement("option");
                                    opt3.value = d1[i].STOK_ADI;
                                    opt3.text = d1[i].STOK_ADI;
                                    $sel3.appendChild(opt3);
                                }
                            })
                            OldStokAdi = null;

                        }
                    }
                } else {


                    var url = "http://192.168.2.13:83/api/seri/receteden/0/0/" + val.value
                    $.getJSON(url, function (d1) {
                        var $sel3 = document.getElementById(tableId).getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[1];
                        $sel3.replaceChildren();
                        var opt2 = document.createElement("option");
                        opt2.value = "SEÇİNİZ";
                        opt2.text = "SEÇİNİZ";
                        opt2.setAttribute("selected", "");
                        opt2.setAttribute("disabled", "");
                        $sel3.appendChild(opt2);
                        for (let i = 0; i < d1.length; i++) {
                            var opt3 = document.createElement("option");
                            opt3.value = d1[i].MAMUL_KODU;
                            opt3.text = d1[i].STOK_ADI;
                            $sel3.appendChild(opt3);
                        }
                    })

                }


            })
        }
        }
    function RefMachineChange(val) {
        if (val.value != "SEÇİNİZ") {

            document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[3].removeAttribute("disabled");
            document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName('i')[0].style.display = "block";
            var s = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[1].value;



            if (OldStokAdi != $("#stokadi").val() && s != "SEÇİNİZ") {
                var stokkodu = Stoklar.filter(x => x.STOK_ADI == s)[0].STOK_KODU;
                var url = "http://192.168.2.13:83/api/seri/receteden/" + stokkodu + "/0/" + val.value
                $.getJSON(url, function (d1) {

                    if (d1.length > 0) {
                        var $sel3 = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[3];
                        $sel3.replaceChildren();
                        var opt2 = document.createElement("option");
                        opt2.value = "SEÇİNİZ";
                        opt2.text = "SEÇİNİZ";
                        opt2.setAttribute("selected", "");
                        opt2.setAttribute("disabled", "");
                        $sel3.appendChild(opt2);
                        for (let i = 0; i < d1.length; i++) {
                            var opt3 = document.createElement("option");
                            opt3.value = d1[i].STOK_ADI;
                            opt3.text = d1[i].STOK_ADI;
                            $sel3.appendChild(opt3);
                        }
                    }

                })
            }
        } else {

                var $sel3 = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[3];
                $sel3.replaceChildren();
                var opt2 = document.createElement("option");
                opt2.value = "SEÇİNİZ";
                opt2.text = "SEÇİNİZ";
                opt2.setAttribute("selected", "");
                opt2.setAttribute("disabled", "");
                $sel3.appendChild(opt2);
            }


        KaydetAktivite();
        }
    function DlInputChange(val) {
        var tr = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex];
        tr.getElementsByTagName("td")[11].getElementsByTagName("input")[0].value = Math.round(parseFloat((parseFloat(tr.getElementsByTagName("td")[4].getElementsByTagName("input")[0].value.replace(',','.')) * parseFloat(tr.getElementsByTagName("td")[5].getElementsByTagName("input")[0].value)) / ((parseFloat(document.getElementById("genislik").value)) + (parseFloat(document.getElementById("genislikalti").value))) * (parseFloat(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(tr.getElementsByTagName("td")[1].getElementsByTagName("input")[0].value.toString().replace(",", "."))));
            tr.getElementsByTagName("td")[11].getElementsByTagName("input")[1].value = parseFloat(tr.getElementsByTagName("td")[11].getElementsByTagName("input")[0].value)
            var top1 = 0;
            var rows = document.getElementById("DLTable").getElementsByTagName("tr");
            for (let i = 1; i < rows.length; i++) {
                if (rows[i].getElementsByTagName("td")[4].getElementsByTagName("input")[0].value != "") {
                    top1 = top1 + parseFloat(parseFloat(rows[i].getElementsByTagName("td")[4].getElementsByTagName("input")[0].value.replace(',', '.')) * parseFloat(rows[i].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value));
                }
        }
        var d = parseFloat(((parseFloat(document.getElementById("genislik").value)) + (parseFloat(document.getElementById("genislikalti").value))) - top1);
        document.getElementById("fireagir").value = d.toFixed(2);
            document.getElementById("fireyuzde").value = parseFloat((parseFloat(document.getElementById("fireagir").value) / ((parseFloat(document.getElementById("genislik").value)) + (parseFloat(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";

            document.getElementById("fireagirligi").value = ((parseFloat(document.getElementById("fireagir").value) / ((parseFloat(document.getElementById("genislik").value)) + (parseFloat(document.getElementById("genislikalti").value)))) * (parseFloat(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2);
            KaydetAktivite();
            tr.getElementsByTagName("select")[3].onchange()

        }
    function RefStokChange(val) {
            var tr = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex];
            var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
            var adet = tr.getElementsByTagName("input")[3].value;
            var oo = jsonObj.find(x => x.STOK_ADI == val.value);
            var m = document.getElementById("metraj").value;
            var upt = m.split('/')[0];
        var o = parseFloat(tr.getElementsByTagName("input")[0].value);
        if (oo != undefined) {
            tr.getElementsByTagName("td")[9].innerHTML = Math.round((parseFloat(upt) / (oo.BOY / 1000)) * o) * adet;
        }

        KaydetAktivite();
        DLCariGetir(val.parentNode.parentNode.rowIndex);
    }
     function StokChange(val) {

     KaydetAktivite();
         DLCariGetir(val.parentNode.parentNode.rowIndex);
         if(document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[2].value!="SEÇİNİZ")
         document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex].getElementsByTagName("select")[2].onchange();
      }
    function oran(val) {
        var tr = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.parentNode.rowIndex];
        if (val.value > 1) {
            val.value = "1.00"
        } else if (val.value <= 0) {
            val.value = "0.01"
        }

        DlInputChange(tr.getElementsByTagName("td")[4].getElementsByTagName("input")[0]);
        $(".js-select").trigger("change");
        KaydetAktivite();
    }
    function ParcalioranUst(val) {
        var tr = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.parentNode.rowIndex];
        if (val.value > 1) {
            val.value = "1.00"
        } else if (val.value <= 0) {
            val.value = "0.01"
        }
        document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.parentNode.rowIndex + 1].getElementsByTagName("input")[0].value = (1 - parseFloat(val.value)).toFixed(2)
        DlInputChange(tr.getElementsByTagName("td")[4].getElementsByTagName("input")[0]);
        DlInputChange(document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.parentNode.rowIndex + 1].getElementsByTagName("td")[4].getElementsByTagName("input")[0]);
        $(".js-select").trigger("change");
        KaydetAktivite();
    }
    function ParcalioranAlt(val) {
        var tr = document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex];
        if (val.value > 1) {
            val.value = "1.00"
        } else if (val.value <= 0) {
            val.value = "0.01"
        }
        document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex - 1].getElementsByTagName("input")[0].value = (1 - parseFloat(val.value)).toFixed(2)
        DlInputChange(tr.getElementsByTagName("td")[4].getElementsByTagName("input")[0]);
        DlInputChange(document.getElementById("DLTable").getElementsByTagName("tr")[val.parentNode.parentNode.rowIndex -1].getElementsByTagName("td")[4].getElementsByTagName("input")[0]);
        $(".js-select").trigger("change");
        KaydetAktivite();
    }
    function addRow() {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var TableId = "";
        switch (Tip) {
            case 'DL':
                TableId = 'DLTable'
                break;
            case 'TP':
                TableId = 'TPTable'
                break;
        }
        var table = document.getElementById(TableId)
        var totaltr = table.getElementsByTagName("tr");
        var tr = document.createElement("tr");
        $('.js-select').select2("destroy");
        var totaltd = totaltr[1].getElementsByTagName("td").length;
        switch (TableId) {
            case 'DLTable':
                for (let i = 0; i < totaltd; i++) {
                    var td = document.createElement("td");
                    if (i == 6 || i == 10) {

                        td.style = table.getElementsByTagName("tr")[1].getElementsByTagName("td")[i].getAttribute("style");
                    }
                    td.className = table.getElementsByTagName("tr")[1].getElementsByTagName("td")[i].className;
                    td.innerHTML = table.getElementsByTagName("tr")[1].getElementsByTagName("td")[i].innerHTML;
                    if (i == 7) {
                        td.style = "";
                    }
                    tr.appendChild(td);
                    if (i == 9) {
                        td.replaceChildren();
                    }
                    if (i == 0) {
                        td.innerHTML = parseFloat(totaltr[totaltr.length - 1].getElementsByTagName("td")[0].innerHTML) + 1;
                    }
                    if (i == 1) {
                        td.innerHTML = '<input class="border-0 text-center" style="font-size:small;max-width:50px" type="number" value="1.00" max="1.00" min="0.00" onblur="oran(this)" /><div><img onclick="addRow1(this)" style="width:18px;cursor:pointer" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAAmlJREFUWEftmOFxFDEMhd9VQKiApAJIBUkHQAVABZAKQiogVABUAHRAKiCpINABVEDmu7FuhM5ey3s3zE4G/dm5W9l6lp7l511pYbZaGB7dG0BPJL2QxPOgPEn2taRf5fmpPIeKMJqht5JeFxCZQIC7lHSRccYnC+iZpHeSDrMTB78fks4kfemNzwAiK+dhop9l8m+SCEapMEoI6FNJLOJRGMdck9nqAfpYuGLzAoRJ+T9jL4u/B8bYV63BU4BiZr5KIgC8GDFID4inbhBZYv4tawEi3Z+dNzsGMLtYzPbzGqdagOCFpZnMALBl8OWkvLySBK9aBqktU8Q4io41QL5UcAaiTpXJ+zdLUQJTPoA8KL+3/GuACG4DIF+PwCOAwEHpPxRAxHrosxQBkY3vxYHsZPrOKCCm95Q49h09AqKr0omx95LeJFg8B1AzTgQEIY2g1V1QATgHkN/FbAQ2xtoiIDru4/Lur1SWQQbW42Iym5AF1XZZ3H2eGsQkVhXQHxcpgq0dIYmKrl1qu68aKwZdHKBeyTa1dqnJNMZYSl+yG6entji0OFIvbtv7VFbPmj1t+3RjJN6/PDp+RzncO1xZCT1in4frrQOROlzjWYNkoGu3LNMYbayXH9WzMivQJmVnsjvuJNCIETszq0OOzJGwyA0v8oYlrC06rgpOARRJmzG0D9cnhJnZpBzu3TpqmTKOkTEaKVzw1yCkr12Dop7qKcqhiyJNM96zMlnCB9Boq71cFH1QysXEJnF7gOgzLKR65akNzpSsNo6ODj/sY4NpKA5K+9gA/6yUPeCb93MBpQOMOv4H1MvYHYPjoiWLe0qnAAAAAElFTkSuQmCC"></div>'
                    }
                    if (i == 3 || i == 8) {
                        var HtmlElement = StringToHtml(td.innerHTML);

                        HtmlElement.getElementsByTagName('select')[0].disabled = true;

                        td.innerHTML = HtmlElement.innerHTML;
                    }
                    if ($('#tamami').is(':checked')) {
                        if (i == 7) {
                            var HtmlElement = StringToHtml(td.innerHTML);

                            HtmlElement.getElementsByTagName('select')[0].disabled = false;

                            td.innerHTML = HtmlElement.innerHTML;
                        }
                    } else {
                        if (i == 7) {
                            var HtmlElement = StringToHtml(td.innerHTML);

                            HtmlElement.getElementsByTagName('select')[0].disabled = true;

                            td.innerHTML = HtmlElement.innerHTML;
                        }
                    }
                }
                break;
            case 'TPTable':
                for (let i = 0; i < totaltd; i++) {
                    var td = document.createElement("td");
                    td.style = table.getElementsByTagName("tr")[totaltr.length - 1].getElementsByTagName("td")[i].getAttribute("style");
                    td.className = table.getElementsByTagName("tr")[totaltr.length - 1].getElementsByTagName("td")[i].className;
                    td.innerHTML = table.getElementsByTagName("tr")[totaltr.length - 1].getElementsByTagName("td")[i].innerHTML;
                    tr.appendChild(td);
                    if (i == 8) {
                        td.replaceChildren();
                    }
                    if (i == 0) {
                        td.innerHTML = parseFloat(td.innerHTML) + 1;
                    }
                    if (i == 6) {
                        var HtmlElement = StringToHtml(td.innerHTML);

                        HtmlElement.getElementsByTagName('i')[0].style.display = "none";

                        td.innerHTML = HtmlElement.innerHTML;
                    }
                    if (i == 7) {
                        var HtmlElement = StringToHtml(td.innerHTML);

                        HtmlElement.getElementsByTagName('select')[0].disabled = true;

                        td.innerHTML = HtmlElement.innerHTML;
                    }
                }
                break;

        }
        table.getElementsByTagName("tbody")[0].appendChild(tr);
        $('.js-select').select2(
            {
                "language": {
                    "noResults": function () {
                        return "Sonuç bulunamadı.";
                    }
                },
                escapeMarkup: function (markup) {
                    return markup;
                }
            });;
        KaydetAktivite();
    }
    function addRow1(value) {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var tableId = "";
        switch (Tip) {
            case 'DL':
                tableId = 'DLTable'
                break;
            case 'BK':
                tableId = 'BKTable'
                break;
        }
    var search = true;
        var rownum = value.parentNode.parentNode.parentNode.parentNode.rowIndex;
        if (rownum == undefined) {
            rownum = value.parentNode.parentNode.parentNode.rowIndex;
        }
        var table = document.getElementById(tableId)
    var totaltr = table.getElementsByTagName("tr");
        var currenttr = table.getElementsByTagName("tr")[rownum];

    var currenttd = currenttr.getElementsByTagName("td");


        if (tableId == 'DLTable') {

            for (let i = 0; i < 4; i++) {
                var val = currenttr.getElementsByTagName("select")[i].value;

                if (val == "SEÇİNİZ") {
                    search = false;
                }
            }

            if (currenttd[4].getElementsByTagName("input")[0].value == null || currenttd[4].getElementsByTagName("input")[0].value == "") {

                search = false
            }

        } else {
            for (let i = 0; i < 3; i++) {
                var val = currenttr.getElementsByTagName("select")[i].value;


                if (val == "SEÇİNİZ") {
                    search = false;
                }
            }

        }

        if (search) {
            currenttr.getElementsByTagName("input")[0].value = "0.5";

            if (tableId == 'DLTable') {
                currenttr.getElementsByTagName("input")[3].value = 1;
                DlInputChange(currenttr.getElementsByTagName("td")[4].getElementsByTagName("input")[0])
                currenttr.getElementsByTagName("select")[3].onchange();
            } else {
                currenttr.getElementsByTagName("td")[1].getElementsByTagName("input")[0].onblur();
            }

            $('.js-select').select2("destroy");
            for (let i = 0; i < currenttd.length; i++) {
                if (tableId == 'DLTable') {
                    if (i == 10 || i == 6) {

                    } else if (i == 7) {
                        currenttd[i].style = "background-color:#edf0f5"
                    }
                    else {

                        currenttd[i].style = "background-color:#edf0f5"
                    }
                } else {
                    currenttd[i].style = "background-color:#edf0f5"
                }

            }
            var totaltd = totaltr[1].getElementsByTagName("td").length;
            var tr = table.insertRow(rownum + 1);
            if (tableId == "DLTable") {
                for (let i = 0; i < totaltd; i++) {
                    var td = tr.insertCell(i);
                    if (i == 10 || i == 6) {
                        td.style = table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getAttribute("style")
                    } else {
                        td.style = "background-color:#edf0f5"
                    }
                    td.className = table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].className;
                    if (i == 1) {
                        td.innerHTML = '<input class="border-0 text-center" style="font-size:small" type="number" value="0.5" max="1.00" min="0.00" onblur="ParcalioranAlt(this)"><div class="text-center"><img onclick = "removeRow1(this)" style = "width:18px" src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAVJJREFUSEu9leFRwzAMhb9OAkwAnQBGgAlgA+gkwATABMAGMAGwQZkE7uOsnuMmscOl1Z1/xFb09GTpecGObbHj+LQAXAGnwEla5vSZ1gvwOpbkGMA5cAscVliugRUg2JYNAdwB18n7G/D7LWXttmzOgBvgIPnpI1DH+gDy4P7g95gJIlPtPoFu/EsAy/KcTpdZxrVekNFHcrrIy1UCWE8pt2ReggYTYxzFYQ5gtzwA1rx2sUOMIsENixzgEbj8Z/YBGCyeABPuzIG9fQxMqX3JJO7CWMbpAPwk75xV7NUuue+fv73BgxRxVoA5S/QVsrLXS44h6/RxrfjF+Wib6jvHoHXmaO9SIYtc7BwcBWw2sYtAOYhl8/u9kGsfIRMIWdlS0nIOyiy9dAOH3g+xsOYCTXpw8mACuZQBpUSzz50bg/YG7lPTiR3Z5t7y6LdFGvD6BU/pUBk06brSAAAAAElFTkSuQmCC"></div>'
                    } else if (i == 2) {
                        td.innerHTML = '<select class="js-select" style="width:100px" value="DL01" onchange="MachineChange(this, "DLTable")"><option disabled = ""  >SEÇİNİZ</option><option selected="" value="DL01">DL01</option></select>'
                    } else if (i == 3) {
                        td.innerHTML = '<select class="js-select" style="width:350px" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("select")[1].value + '"><option disabled="">SEÇİNİZ</option><option selected="" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("select")[1].value + '" >' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("select")[1].value + '</option></select>'
                    }
                    else if (i == 4) {
                        td.innerHTML = '<input class="border-0 text-center" style="width:80px" readonly oninput="DlInputChange(this)" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[4].getElementsByTagName("input")[0].value + '">'
                    } else if (i == 5) {
                        td.innerHTML = '<input class="border-0 text-center" style="width:80px" readonly oninput="DlInputChange(this)" value="1">'
                    }
                    else if (i == 7) {

                        td.innerHTML = '<i onclick="ReferansSecimiTemizle(this, \'DL\')" data-bs-toggle="tooltip" data-popup="tooltip-custom" data-bs-placement="top" data-bs-html="true" data-bs-original-title="<span>Seçimi Temizle</span>" class="bi bi-x-lg me-2" style="color:#203289;font-size:larger;cursor:pointer;float:left"></i>' + '<select class="js-select" style="width:100px;float: left" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("select")[2].value + '" onchange="RefMachineChange(this)"><option disabled="">SEÇİNİZ</option><option selected="" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("select")[2].value + '" >' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("select")[2].value + '</option></select>'
                    }
                    else if (i == 8) {
                        td.innerHTML = '<select class="js-select" style="width:350px">' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("select")[3].innerHTML + '</select>'
                    }
                    else {
                        td.innerHTML = td.innerHTML = table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].innerHTML;
                    }


                }
            }
            else {
                for (let i = 0; i < totaltd; i++) {
                    var td = tr.insertCell(i);
                    if (i == 10 || i == 6) {
                        td.style = table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getAttribute("style")
                    } else {
                        td.style = "background-color:#edf0f5"
                    }
                    td.className = table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].className;
                    if (i == 1) {
                        td.innerHTML = '<input class="border-0 text-center" style="font-size:small;width:100px" type="number" value="0.5" max="1.00" min="0.00" onblur="oranBK(this)"><div class="text-center"><img onclick = "removeRow1(this)" style = "width:18px" src = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAVJJREFUSEu9leFRwzAMhb9OAkwAnQBGgAlgA+gkwATABMAGMAGwQZkE7uOsnuMmscOl1Z1/xFb09GTpecGObbHj+LQAXAGnwEla5vSZ1gvwOpbkGMA5cAscVliugRUg2JYNAdwB18n7G/D7LWXttmzOgBvgIPnpI1DH+gDy4P7g95gJIlPtPoFu/EsAy/KcTpdZxrVekNFHcrrIy1UCWE8pt2ReggYTYxzFYQ5gtzwA1rx2sUOMIsENixzgEbj8Z/YBGCyeABPuzIG9fQxMqX3JJO7CWMbpAPwk75xV7NUuue+fv73BgxRxVoA5S/QVsrLXS44h6/RxrfjF+Wib6jvHoHXmaO9SIYtc7BwcBWw2sYtAOYhl8/u9kGsfIRMIWdlS0nIOyiy9dAOH3g+xsOYCTXpw8mACuZQBpUSzz50bg/YG7lPTiR3Z5t7y6LdFGvD6BU/pUBk06brSAAAAAElFTkSuQmCC"></div>'
                    }
                    else if (i == 2 ) {
                        table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getElementsByTagName("select")[0].setAttribute("disabled", "");
                        td.innerHTML = '<select class="js-select" disabled style="width:100px" onchange="MachineChange(this, \'BKTable\')" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getElementsByTagName("select")[0].value +'"><option selected="" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getElementsByTagName("select")[0].value + '" disabled="">' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getElementsByTagName("select")[0].value+'</option></select> ';
                    }
                    else if (i == 4) {
                        td.innerHTML = '<input class="border-0 text-center" style="width:80px" readonly="" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getElementsByTagName("input")[0].value + '">';
                    }
                    else if (i == 5) {
                        td.innerHTML = '<input class="border-0 text-center" style="width:80px;display:none" readonly=""><input class="border-0 text-center" style="width:80px" readonly="" value="' + table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].getElementsByTagName("input")[1].value + '">';
                    }
                    else {
                        td.innerHTML = table.getElementsByTagName("tr")[rownum].getElementsByTagName("td")[i].innerHTML;
                    }


                }
            }
            $('.js-select').select2(
                {
                    "language": {
                        "noResults": function () {
                            return "Sonuç bulunamadı.";
                        }
                    },
                    escapeMarkup: function (markup) {
                        return markup;
                    }
                });
            if (tableId == "DLTable") {
                table.getElementsByTagName("tr")[rownum].getElementsByTagName("input")[0].setAttribute("onblur", "ParcalioranUst(this)")
                ParcalioranAlt(table.getElementsByTagName("tr")[rownum + 1].getElementsByTagName("input")[0])
            }



    }
    else {
        const Toast = Swal.mixin({
            toast: true,
            position: 'center',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })

        Toast.fire({
            icon: 'info',
            title: 'Lütfen tüm değerleri girdiğinizden emin olun.'
        });
        }
        KaydetAktivite();
    }
    function removeRow() {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var TableId = "";
        switch (Tip) {
            case 'DL':
                TableId = 'DLTable'
                break;
            case 'TP':
                TableId = 'TPTable'
                break;
        }
        var table = document.getElementById(TableId)
        var totaltr = table.getElementsByTagName("tr");
        if (totaltr.length > 3) {
            if (totaltr[totaltr.length - 1].getElementsByTagName("td")[0].innerHTML == totaltr[totaltr.length - 2].getElementsByTagName("td")[0].innerHTML) {
                totaltr[totaltr.length - 1].remove();
                totaltr[totaltr.length - 1].remove();
            } else {
                totaltr[totaltr.length - 1].remove();
            }

        } else {
            tablosil();
        }
        KaydetAktivite();

    }

    function kaydet() {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var TableId = "";
        switch (Tip) {
            case "TP":
                TPTableCreatePivotData()
                TPTableCreatePivot2Data()
                break;
            case "RF":
            case "PB":
            case "BK":
                switch (Tip) {
                    case "RF":
                        TableId = "RFTable"
                        break;
                    case "PB":
                        TableId = "PBTable"
                        break;
                    case "BK":
                        TableId = "BKTable"
                        break;
                }
                var l = $(TableId).find("tr").length;
                if (l > 2) {
                    var sum = 0;
                    for (let i = 1; i < l; i++) {
                        sum += parseFloat(parseFloat($(TableId).find("tr").eq(i).find("input").eq(0).val()).toFixed(3));
                    }
                    if (sum != 1) {
                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'center',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })

                        Toast.fire({
                            icon: 'warning',
                            title: 'Oranların toplamı 1 olmadığından kaydetme işlemi gerçekleştirilemedi.'
                        });
                    } else {
                        if (Tip == "BK") {

                            BKTableCreatePivotData()
                            BKTableCreatePivot2Data()
                        } else if (Tip == "RF") {
                            RFTableCreatePivotData()
                            RFTableCreatePivot2Data()
                        } else {
                            PBTableCreatePivotData()
                            PBTableCreatePivot2Data()
                        }
                    }
                } else {
                    if (Tip == "BK") {

                        BKTableCreatePivotData()
                        BKTableCreatePivot2Data()
                    }
                 else if (Tip == "RF") {
                    RFTableCreatePivotData()
                    RFTableCreatePivot2Data()
                } else {
                        PBTableCreatePivotData()
                        PBTableCreatePivot2Data()
                       }
                }
                break;
            case "DL":
                var TamamiAktarilsin = $("#tamami").is(":checked");
                var f = parseFloat($("#fireagirligi").val());
                var stok = $("#seri").val();
                if (stok.length > 0) {
                    if (f > 0) {
                        $.getJSON("http://192.168.2.13:83/api/seri/exec/1", function (data) {
                            sonSeri = data;
                        }).done(function () {
                            var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                            var table = document.getElementById("DLTable");
                            var tr = table.getElementsByTagName("tr");
                            if (localStorage.DLlist != null && localStorage.DLlist != "null") {
                                DLList = JSON.parse(localStorage.DLlist)
                                DLListTop = JSON.parse(localStorage.DLlistTop)
                                for (let e = 0; e < DLList.length; e++) {
                                    if (!serilist.includes(DLList[e].GIRDI2)) {
                                        serilist.push(DLList[e].GIRDI2);
                                    }

                                    if (!isemrilist.includes(DLList[e].ISEMRINO)) {
                                        isemrilist.push(DLList[e].ISEMRINO);
                                    }

                                    if (!isemrilist.includes(DLList[e].REF_ISEMRINO)) {
                                        isemrilist.push(DLList[e].REF_ISEMRINO);
                                    }

                                }
                            } else {
                                DLList = [];
                                DLListTop = [];
                            }
                            var Cariler = @Html.Raw(Json.Encode(ViewBag.Cariler));
                            for (let i = 1; i < tr.length; i++) {
                                var adet = tr[i].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value;
                                var oran = tr[i].getElementsByTagName("td")[1].getElementsByTagName("input")[0].value;
                                var tam = document.getElementById("agirlik").value.split("/")[0].split('.').join('');
                                var hamor = document.getElementById("hamoran").value;
                                var sirano = parseFloat(tr[i].getElementsByTagName("td")[0].innerHTML);
                                var girdi2old = sonSeri[0].SERI_NO;
                                var girdi2 = sonSeri[0].SERI_NO;
                                var makine = tr[i].getElementsByTagName("select")[0].value;
                                var makineref = tr[i].getElementsByTagName("select")[2].value;
                                var s = jsonObj.filter(x => x.MAK_KODU == makine);
                                var s1 = jsonObj.filter(x => x.MAK_KODU == makineref);
                                var urunkodu = document.getElementById("seri").value;
                                var tamMi = TamamiAktarilsin ? 'E' : 'H';
                                var stokadi = tr[i].getElementsByTagName("select")[1].value;
                                var kalinlik = document.getElementById("kalinlik").value;
                                var kaplama = document.getElementById("kaplama").value;
                                var kalite = document.getElementById("kalite").value;
                                var siparisno, Sipkont = "";

                                var musteri = tr[i].getElementsByTagName("select")[tr[i].getElementsByTagName("select").length - 1].value;
                                if (musteri != "EFECE GALVANİZ") {
                                    var f = Cariler.filter(x => x.CARI_ISIM == musteri)[0];
                                    siparisno = f.FISNO;
                                    Sipkont = f.SIPKONT;
                                }
                                var genislik = tr[i].getElementsByTagName("td")[4].getElementsByTagName("input")[0].value;
                                var refagirlik = tr[i].getElementsByTagName("td")[11].getElementsByTagName("input")[0].value;

                                var refstokolcusu = tr[i].getElementsByTagName("select")[3].value;
                                var sonrefisemri = "-";
                                for (let a = 0; a < adet; a++) {
                                    var refadet = tr[i].getElementsByTagName("td")[9].innerHTML;
                                    var sonisemri = makine + "23" + (s[s.length - 1].MAX_ISEMRINO).toString().padStart(6, '0') + (a + 1).toString().padStart(3, '0');
                                    if (s1.length > 0) {
                                        sonrefisemri = makineref + "23" + (s1[s1.length - 1].MAX_ISEMRINO).toString().padStart(6, '0') + (a + 1).toString().padStart(3, '0');
                                        if (isemrilist.includes(sonrefisemri)) {
                                            var is1 = isemrilist.filter(x => x.includes(makineref));
                                            sonrefisemri = is1[is1.length - 1].substring(0, 12) + (parseFloat(is1[is1.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
                                        }
                                    }


                                    if (isemrilist.includes(sonisemri)) {
                                        var is = isemrilist.filter(x => x.includes(makine));
                                        sonisemri = is[is.length - 1].substring(0, 12) + (parseFloat(is[is.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
                                    }
                             
                                    if (serilist.includes(girdi2)) {
                                        //if (refstokolcusu == "SEÇİNİZ") {
                                        //    if (siralist.includes(sirano) && adet == 1) {
                                        //        girdi2 = serilist[serilist.length - 1];
                                        //    } else {
                                        //        girdi2 = girdi2old.substring(0, 12) + (parseFloat(serilist[serilist.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
                                        //    }
                                            
                                        //}
                                        girdi2 = girdi2old.substring(0, 12) + (parseFloat(serilist[serilist.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
                                    } 
                                    if (refstokolcusu == "SEÇİNİZ") {
                                        refstokolcusu = "-"
                                        refadet = "-"
                                        if (tamMi=='H') {

                                            girdi2 = "-"
                                        }
                                    } else {
                                        refadet = Math.round(refadet / adet)
                                    }
                                    if (refadet == "-") {
                                        refadet = 0;
                                    }
                                    DLList.push({
                                        GIRDI1: urunkodu, GIRDI2: girdi2, ISEMRINO: sonisemri, STOKADI: stokadi, KALINLIK: kalinlik, KALITE: kalite, KAPLAMA: kaplama, GENISLIK: genislik.replace(',','.'), ADET: 1, REF_ISEMRINO: sonrefisemri, REF_STOKOLCUSU: refstokolcusu, REF_ADET: refadet, AGIRLIK: (parseFloat(refagirlik) / adet).toString(), SIPKONT: "", SIPARISNO: siparisno, HAMORAN: hamor, TAMAGIRLIK: tam, ORAN: oran, "MIKTAR_SABITLE": tamMi
                                    });

                                    if (!(serilist.includes(girdi2)) && (girdi2!="-")) {

                                        serilist.push(girdi2);
                                        say++;
                                        
                                    }
                                    if (!siralist.includes(sirano) && girdi2 != "-") {

                                        siralist.push(sirano);
                                    }
                                    isemrilist.push(sonisemri);

                                    if (sonrefisemri != "-") {
                                        isemrilist.push(sonrefisemri);
                                    }

                                   
                                }
                                
                                DLListTop.push({ MAKINE: makine, MAKINEREF: makineref, MUSTERI: musteri, STOKADI: (refstokolcusu == "-" ? stokadi : refstokolcusu), KALINLIK: kalinlik, KAPLAMA: kaplama, KALITE: kalite, ADET: adet, AGIRLIK: parseFloat(refagirlik.replace(',', '.')), REF_ADET: (refadet == 0 || refadet == '-' ? adet : (refadet * adet)) });
                                var fark = DLList.length;
                                OldStokAdi = $("#stokadi").val();
                                siralist = [];
                                var listZ = [];
                               
                               
                                if (localStorage.DLlist != null && localStorage.DLlist != "null") {
                                    var l = JSON.parse(localStorage.DLlist);
                                    for (let z = 0; z < l.length; z++) {

                                        if (!listZ.includes(l[z].GIRDI2)) {
                                            listZ.push(l[z].GIRDI2)
                                        }

                                    }
                                    fark = fark - listZ.length;
                                }
                                var uu = "http://192.168.2.13:83/api/seri/1/" + fark;
                                $.getJSON(uu, function (data) { });
                                localStorage.DLlist = JSON.stringify(DLList);
                                localStorage.DLlistTop = JSON.stringify(DLListTop);

                            }
                            var tpl = $.pivotUtilities.aggregatorTemplates;
                            takiplist = [];

                            function drawPivot() {

                                $(function () {
                                    document.getElementById("DLPivot").replaceChildren();
                                    $("#tamamidiv").show()
                                    $("#tamami").show()
                                    $("#DLPivot").pivot(
                                        takiplist,
                                        {
                                            rows: ["GIRDI1", "GIRDI2", "ISEMRINO", "STOKADI", "KALINLIK", "KALITE", "KAPLAMA", "GENISLIK", "ADET", "REF_ISEMRINO", "REF_STOKOLCUSU", "REF_ADET","MIKTAR_SABITLE", "AGIRLIK", "FIRE", "HAMSARF"],
                                            cols: [],
                                            aggregator: tpl.sum()(["ADET"]),
                                            sorters: {

                                                GIRDI1: function (a, b) { return a - b; } //sort backwards
                                            }


                                        }, false, "tr")
                                })
                            }
                            function getPivot() {

                                document.body.style.cursor = 'default';
                                takiplist = JSON.parse(localStorage.DLlist);
                                var girdi1 = [];
                                for (let i = 0; i < takiplist.length; i++) {

                                    if (!girdi1.includes(takiplist[i].GIRDI1)) {

                                        girdi1.push({ GIRDI1: takiplist[i].GIRDI1 });

                                    }

                                }

                                var newtakip = [];
                                var hamtop = 0;
                                var firtop = 0;
                                for (let i = 0; i < girdi1.length; i++) {
                                    var sum = 0;
                                    var fil = takiplist.filter(x => x.GIRDI1 == girdi1[i].GIRDI1);

                                    for (let e = 0; e < fil.length; e++) {
                                       
                                            sum = sum + parseFloat(fil[e].GENISLIK);
                                        

                                    }
                                    var ek = 0;
                                    
                                    for (let e = 0; e < fil.length; e++) {
                                        if (fil[e].MIKTAR_SABITLE == "E") {
                                            fil[e].HAMSARF = parseFloat(parseFloat(fil[e].GENISLIK) / sum) * (parseFloat(fil[e].TAMAGIRLIK)) * parseFloat(fil[e].ORAN);
                                            var oldek = ek;
                                            ek = ek + fil[e].HAMSARF - parseInt(fil[e].HAMSARF);
                                            if (Math.round(ek) != Math.round(oldek)) {
                                                fil[e].HAMSARF = parseInt(fil[e].HAMSARF) + 1;
                                            } else {
                                                fil[e].HAMSARF = parseInt(fil[e].HAMSARF)
                                            }
                                            fil[e].FIRE = fil[e].HAMSARF - (parseFloat(fil[e].AGIRLIK));
                                            fil[e].AGIRLIK = parseFloat(parseFloat(fil[e].AGIRLIK));
                                        
                                        if (fil.length == 1) {
                                            fil[0].FIRE = fil[0].HAMSARF - (parseFloat(fil[0].AGIRLIK));
                                        }
                                    }else {
                                        for (let e = 0; e < fil.length; e++) {
                                            fil[e].HAMSARF = "1";
                                            fil[e].FIRE = "-";
                                            fil[e].AGIRLIK = parseFloat(parseFloat(fil[e].AGIRLIK));
                                        }
                                    }
                                    } 
                                    

                                    if (newtakip.length == 0) {
                                        newtakip = fil;
                                    } else {
                                        newtakip = newtakip.concat(fil);
                                    }

                                }

                                takiplist = newtakip;
                                var fn = takiplist.filter(x => x.ISEMRINO === takiplist[0].ISEMRINO).length;
                                for (let i = 0; i < takiplist.length; i++) {
                                    tp = tp + parseFloat(takiplist[i].FIRE);
                                }

                                for (let i = 0; i < takiplist.length; i++) {
                                    hamtop = hamtop + takiplist[i].HAMSARF;
                                    firtop = firtop + takiplist[i].FIRE;
                                }
                                //fireag.value = (firtop / fn).toLocaleString();
                                //fireyuz.value = ((firtop / fn) / (hamtop / fn) * 100).toFixed(2) + " %";
                                localStorage.list4 = JSON.stringify(takiplist);
                                drawPivot();




                            }
                            takiplist2 = [];
                            function drawPivot2() {


                                $("#DLPivotTop").pivot(
                                    takiplist2,
                                    {
                                        rows: ["MUSTERI", "STOKADI", "ADET", "AGIRLIK"],




                                    }, false, "tr")
                            }
                            function getPivot2() {

                                var result = Grupla(JSON.parse(localStorage.DLlistTop))
                                for (let i = 0; i < result.length; i++) {

                                    takiplist2.push({ STOKADI: result[i].STOKADI, MUSTERI: result[i].MUSTERI, AGIRLIK: result[i].AGIRLIK, ADET: result[i].ADET })


                                }
                                drawPivot2();
                                document.body.style.cursor = 'default';
                                var rr = document.getElementsByClassName("pvtTable")[0].getElementsByTagName("tr");
                                var sum = 0;
                                var sum2 = 0;
                                for (let i = 1; i < rr.length - 1; i++) {
                                    sum = sum + parseFloat(rr[i].getElementsByTagName("th")[rr[i].getElementsByTagName("th").length - 2].innerHTML);
                                    sum2 = sum2 + parseFloat(rr[i].getElementsByTagName("th")[rr[i].getElementsByTagName("th").length - 1].innerHTML);
                                }

                            }
                            var aggMap = {
                                'agg1': {
                                    aggType: 'Sum',
                                    arguments: ['ADET'],
                                    name: 'ADET TOPLAM',
                                    varName: 'a',
                                    renderEnhancement: 'barchart'
                                },

                                'agg2': {
                                    aggType: 'Sum',
                                    arguments: ['AGIRLIK'],
                                    name: 'AGIRLIK TOPLAM',
                                    varName: 'b',
                                    hidden: false,
                                    renderEnhancement: 'none'
                                },

                            };


                            var customAggs = {};
                            customAggs['Multifact Aggregators'] = $.pivotUtilities.multifactAggregatorGenerator(aggMap, []);

                            var config = {
                                "cols": [],
                                "rows": ["MUSTERI", "STOKOLCULERI", "KALINLIK", "KALITE", "KAPLAMA"],
                                "vals": [],
                                "rowOrder": "key_a_to_z",
                                "colOrder": "key_a_to_z",
                                "aggregatorName": "Multifact Aggregators",
                                "rendererName": "GT Table Heatmap and Barchart",
                                "rendererOptions": {

                                    aggregations: {
                                        defaultAggregations: aggMap,


                                    }
                                }
                            };




                            $.pivotUtilities.customAggs = customAggs;

                            config.aggregators = $.extend($.pivotUtilities.aggregators, $.pivotUtilities.customAggs);

                            config.renderers = $.extend($.pivotUtilities.renderers, $.pivotUtilities.gtRenderers);
                            getPivot();
                            getPivot2();
                            $("#seri").val(null).trigger("input");
                            $("#stokadi").html("")
                            $("#marka").html(null)
                            $("#adet").val(null)
                            $("#kalinlik").val(null)
                            $("#genislik").val(null)
                            $("#genislikalti").val(0)
                            $("#kaplama").val(null)
                            $("#kalite").val(null)
                            $("#metraj").val(null)
                            $("#agirlik").val(null)
                            $("#tamami").hide();

                        })

                    } else {
                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'center',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })

                        Toast.fire({
                            icon: 'error',
                            title: 'Fire eksi olamaz!'
                        })

                    }

                } else {
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'center',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    })

                    Toast.fire({
                        icon: 'error',
                        title: 'Hammadde seçmediniz!'
                    })
                }
                $('#tamami').show();
                $('#tamamidiv').show();

                break;

        };



    }
    function sil() {
        OldStokAdi = null;
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var TableId = "";
        switch (Tip) {
            case 'DL':
                localStorage.DLlist = null;
                localStorage.DLlistTop = null;
                $("#tamamidiv").hide();
                document.getElementById("DLPivot").replaceChildren();
                document.getElementById("DLPivotTop").replaceChildren();
                $("#tamamidiv").show();
                $("#tamami").show();
                break;
            case 'TP':
                localStorage.TPPivotVeri = null;
                localStorage.TPPivotToplamVeri = null;
                document.getElementById("TPPivot").replaceChildren();
                document.getElementById("TPPivotTop").replaceChildren();
                $("#tamamidiv").hide();
                break;
            case 'BK':
                localStorage.BKPivotVeri = null;
                localStorage.BKPivotToplamVeri = null;
                document.getElementById("BKPivot").replaceChildren();
                document.getElementById("BKPivotTop").replaceChildren();
                $("#tamamidiv").hide();
                break;
            case 'RF':
                localStorage.RFPivotVeri = null;
                localStorage.RFPivotToplamVeri = null;
                document.getElementById("RFPivot").replaceChildren();
                document.getElementById("RFPivotTop").replaceChildren();
                $("#tamamidiv").hide();
                break;
            case 'PB':
                localStorage.PBPivotVeri = null;
                localStorage.PBPivotToplamVeri = null;
                document.getElementById("PBPivot").replaceChildren();
                document.getElementById("PBPivotTop").replaceChildren();
                $("#tamamidiv").hide();
                break;
        }
       
    }
    function c(val) {
        if (val.value == "DL") {
            $("#HammaddeCard").show();
            $("#addRw").show();
            $("#removeRw").show();
            $("#DLTable").show();
            $("#DLPivot").show();
            $("#DLPivotTop").show();
            $("#fireTable").show();
            document.getElementById("DLTable").getElementsByTagName("select")[0].value = "DL01";

            $("#TPTable").hide();
            $("#TPPivot").hide();
            $("#TPPivotTop").hide();

            $("#BKTable").hide();
            $("#BKPivot").hide();
            $("#BKPivotTop").hide();

            $("#PBTable").hide();
            $("#PBPivot").hide();
            $("#PBPivotTop").hide();

            $("#RFTable").hide();
            $("#RFPivot").hide();
            $("#RFPivotTop").hide();
            $("#tamamidiv").show();
            $("#tamami").prop("checked", true);
            if ($("#seri").val() != null && $("#seri").val()!="") {

                MachineChange(document.getElementById("DLTable").getElementsByTagName("tr")[1].getElementsByTagName("select")[0], "DLTable");
            } else {
                document.getElementById("DLTable").getElementsByTagName("tr")[1].getElementsByTagName("select")[1].replaceChildren();
                var opt = document.createElement("option");
                opt.value = "SEÇİNİZ";
                opt.text = "SEÇİNİZ";
                opt.setAttribute("selected", "");
                opt.setAttribute("disabled", "");
                document.getElementById("DLTable").getElementsByTagName("tr")[1].getElementsByTagName("select")[1].appendChild(opt);
            }

        }
        else if (val.value == "TP")
        {
            hamkod = null;
            $("#HammaddeCard").hide();
            $("#addRw").show();
            $("#removeRw").show();
            $("#DLTable").hide();
            $("#DLPivot").hide();
            $("#DLPivotTop").hide();
            $("#fireTable").hide();

            $("#TPTable").show();
            $("#TPPivot").show();
            $("#TPPivotTop").show();

            $("#BKTable").hide();
            $("#BKPivot").hide();
            $("#BKPivotTop").hide();

            $("#PBTable").hide();
            $("#PBPivot").hide();
            $("#PBPivotTop").hide();

            $("#RFTable").hide();
            $("#RFPivot").hide();
            $("#RFPivotTop").hide();
            $("#tamamidiv").hide();
            $("#tamami").prop("checked", true);
            TPTableLoadLocalData();
        }
        else if (val.value == "BK") {
            $("#HammaddeCard").show();
            $("#addRw").hide();
            $("#removeRw").hide();
            $("#DLTable").hide();
            $("#DLPivot").hide();
            $("#DLPivotTop").hide();
            $("#fireTable").hide();

            $("#TPTable").hide();
            $("#TPPivot").hide();
            $("#TPPivotTop").hide();

            $("#BKTable").show();
            $("#BKPivot").show();
            $("#BKPivotTop").show();

            $("#PBTable").hide();
            $("#PBPivot").hide();
            $("#PBPivotTop").hide();

            $("#RFTable").hide();
            $("#RFPivot").hide();
            $("#RFPivotTop").hide();
            $("#tamami").prop("checked", true);
            if (localStorage.BKPivotVeri != null && localStorage.BKPivotVeri != undefined && localStorage.BKPivotVeri != "null") {

                $("#tamamidiv").show();
            }
            BKTableLoadLocalData();

        }
        else if (val.value == "PB")
        {
            $("#HammaddeCard").show();
            $("#addRw").hide();
            $("#removeRw").hide();
            $("#DLTable").hide();
            $("#DLPivot").hide();
            $("#DLPivotTop").hide();
            $("#fireTable").hide();

            $("#TPTable").hide();
            $("#TPPivot").hide();
            $("#TPPivotTop").hide();

            $("#BKTable").hide();
            $("#BKPivot").hide();
            $("#BKPivotTop").hide();

            $("#PBTable").show();
            $("#PBPivot").show();
            $("#PBPivotTop").show();

            $("#RFTable").hide();
            $("#RFPivot").hide();
            $("#RFPivotTop").hide();
            $("#tamami").prop("checked", true);
            if (localStorage.PBPivotVeri != null && localStorage.PBPivotVeri != undefined && localStorage.PBPivotVeri != "null") {

                $("#tamamidiv").show();
            } else {
                $("#tamamidiv").hide();
            }
            PBTableLoadLocalData();
        }
        else if (val.value == "RF") {
            $("#HammaddeCard").show();
            $("#addRw").hide();
            $("#removeRw").hide();
            $("#DLTable").hide();
            $("#DLPivot").hide();
            $("#DLPivotTop").hide();
            $("#fireTable").hide();

            $("#TPTable").hide();
            $("#TPPivot").hide();
            $("#TPPivotTop").hide();

            $("#BKTable").hide();
            $("#BKPivot").hide();
            $("#BKPivotTop").hide();

            $("#PBTable").hide();
            $("#PBPivot").hide();
            $("#PBPivotTop").hide();

            $("#RFTable").show();
            $("#RFPivot").show();
            $("#RFPivotTop").show();
            $("#tamami").prop("checked", true);
            if (localStorage.RFPivotVeri != null && localStorage.RFPivotVeri != undefined && localStorage.RFPivotVeri != "null") {

                $("#tamamidiv").show();
            } else {
                $("#tamamidiv").hide();
            }
            RFTableLoadLocalData();
        }
        else
        {
            $("#HammaddeCard").hide();
            $("#addRw").hide();
            $("#removeRw").hide();
            $("#DLTable").hide();
            $("#DLPivot").hide();
            $("#DLPivotTop").hide();
            $("#fireTable").hide();

            $("#TPTable").hide();
            $("#TPPivot").hide();
            $("#TPPivotTop").hide();

            $("#BKTable").hide();
            $("#BKPivot").hide();
            $("#BKPivotTop").hide();

            $("#PBTable").hide();
            $("#PBPivot").hide();
            $("#PBPivotTop").hide();

            $("#RFTable").hide();
            $("#RFPivot").hide();
            $("#RFPivotTop").hide();
            $("#tamamidiv").hide();

        }

        $(".js-select").trigger("change");
        KaydetAktivite();
    }

    function netsisaktar() {

        $("#content").show();
        document.body.style.cursor = 'wait';
        var Tip = $('input[name="uretim-tip"]:checked').val();
        switch (Tip) {
            case 'DL':
                var TamamiAktarilsin = $("#tamami").is(":checked");
                var lis = [];
                lis = takiplist;
                $.ajax({
    url: '@Url.Action("Post","IsEmri")',
    type: 'POST',
                    data: { isemri: lis, TamamiKullanilsin: TamamiAktarilsin },
    success: function () {

        $("#content").hide();

        $("#seri").val(null).trigger("input");
        mail();

        Swal.fire(
            'Veriler başarılı bir şekilde Netsis\'e aktarıldı.',
            '',
            'success'
        ).then((result) => {
            if (result.isConfirmed) {
                location.reload();
            }
        })
        $("#seri").val(null);

        $("#tamamidiv").hide();
        document.getElementById("genislikalti").value = 0;
    },
    error: function () {
        document.body.style.cursor = 'default';
        $("#content").hide();
        const Toast = Swal.mixin({
            toast: true,
            position: 'center',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })

        Toast.fire({
            icon: 'error',
            title: 'Veriler Netsis\'e aktarılamadı!'
        });
    }
}).done(function () {
                           $("#content").hide();
                           sil()
                           document.body.style.cursor = 'default';


                                            })
                break;
            case 'TP':
                var lis = [];
                lis = JSON.parse(localStorage.TPPivotVeri);
                                $.ajax({
    url: '@Url.Action("PostTRPZ", "IsEmri")',
    type: 'POST',
    data: { isemri: lis },
    success: function () {

        $("#content").hide();

        $("#seri").val(null).trigger("input");
        mail();
        const Toast = Swal.mixin({
            toast: true,
            position: 'center',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })
        var Message =@Html.Raw(Json.Encode(TempData["Hata"]));
        if (Message == "HATA") {
            Toast.fire({
                icon: 'error',
                title: 'Veriler Netsis\'e aktarılamadı.'
            });
        } else {
            Toast.fire({
                icon: 'success',
                title: 'Veriler başarılı bir şekilde Netsis\'e aktarıldı.'
            });
        }

        $("#tamamidiv").hide();
        $("#seri").val(null);
        document.getElementById("genislikalti").value = 0;
    },
    error: function () {
        document.body.style.cursor = 'default';
        $("#content").hide();
        const Toast = Swal.mixin({
            toast: true,
            position: 'center',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })

        Toast.fire({
            icon: 'error',
            title: 'Veriler Netsis\'e aktarılamadı!'
        });
    }
}).done(function () {
                           $("#content").hide();
                           sil()
                           document.body.style.cursor = 'default';


                                            })
                break;
            case 'BK':
            case 'PB':
            case 'RF':
                var lis = [];
                var TamamiAktarilsin = $("#tamami").is(":checked");
                if (Tip == "BK") {
                    lis = JSON.parse(localStorage.BKPivotVeri);
                } else if (Tip == "RF") {
                    lis = JSON.parse(localStorage.RFPivotVeri);
                } else {
                    lis = JSON.parse(localStorage.PBPivotVeri);
                }

                                $.ajax({
                                     url: '@Url.Action("PostBKPBRF", "IsEmri")',
                                    type: 'POST',
                                    data: { isemri: lis, TamamiKullanilsin: TamamiAktarilsin },
    success: function () {

        $("#content").hide();

        $("#seri").val(null).trigger("input");
        mail();
        const Toast = Swal.mixin({
            toast: true,
            position: 'center',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })

        Toast.fire({
            icon: 'success',
            title: 'Veriler başarılı bir şekilde Netsis\'e aktarıldı.'
        });

        $("#tamamidiv").hide();
        $("#seri").val(null);
        document.getElementById("genislikalti").value = 0;
    },
    error: function () {
        document.body.style.cursor = 'default';
        $("#content").hide();
        const Toast = Swal.mixin({
            toast: true,
            position: 'center',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })

        Toast.fire({
            icon: 'error',
            title: 'Veriler Netsis\'e aktarılamadı!'
        });
    }
}).done(function () {
                           $("#content").hide();
                           sil()
                           document.body.style.cursor = 'default';


                                            })
                break;
        }




    }
    function removeRow1(value) {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var tableId = "";
        switch (Tip) {
            case 'DL':
                tableId = 'DLTable'
                break;
            case 'BK':
                tableId = 'BKTable'
                break;
        }
        var rownum = value.parentNode.parentNode.parentNode.rowIndex;
        var table = document.getElementById(tableId)
        var currenttr = table.getElementsByTagName("tr")[rownum - 1];
        var currenttd = currenttr.getElementsByTagName("td");
        if (rownum == 2) {
            currenttd[1].getElementsByTagName("img")[0].setAttribute("onclick", "addRow1(this)");
        }
        for (let i = 0; i < currenttd.length; i++) {
            if (rownum == 2) {
                if (i == 6 || i == 10) {

                } else {
                    currenttd[i].removeAttribute("style");
                }


            }
        }
        if (document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("select")[0].value == "DL01") {
            document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("input")[3].disabled = false;
        }

        if (rownum == 2) {

            document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("input")[0].value = "1.00";
        }
        if (tableId == "DLTable") {
            document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("input")[0].setAttribute("onblur", "oran(this)")
            DlInputChange(document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("td")[4].getElementsByTagName("input")[0])
            document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("select")[3].onchange();
        } else {
            document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("input")[0].setAttribute("onblur", "oranBK(this)")
            if (rownum == 2) {

                document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("select")[0].removeAttribute("disabled")
                document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("select")[1].removeAttribute("disabled")
            }
            document.getElementById(tableId).getElementsByTagName("tr")[rownum - 1].getElementsByTagName("input")[0].onblur();
        }

        document.getElementById(tableId).getElementsByTagName("tr")[rownum].remove();
        KaydetAktivite();

    }
    function tablosil() {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var tableId = `${Tip}Table`;

        switch (Tip) {
            case "TP":
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[0].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[1].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[2].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[3].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[4].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[0].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[1].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[2].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[3].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[3].disabled = true;
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName('i')[0].style.display = "none";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[4].value = "EFECE GALVANİZ";
                break;

            case "DL":
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[3].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[0].value = "1.00";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[0].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[1].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[2].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[3].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[4].value = "EFECE GALVANİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[1].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[2].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("td")[9].innerHTML = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[5].value = "";
                break;

            case "BK":
            case "RF":
            case "PB":
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[0].value = "1.00";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[1].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[2].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("input")[3].value = "";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[0].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[0].removeAttribute("disabled");
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[1].value = "SEÇİNİZ";
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[1].disabled = true;
                document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("select")[2].value = "EFECE GALVANİZ";
                break;

        };

        var rows = document.getElementById(tableId).getElementsByTagName("tr").length;
        var td = document.getElementById(tableId).getElementsByTagName("tr")[1].getElementsByTagName("td")

        for (let i = 0; i < td.length; i++) {
            if (tableId == "DLTable")
            {
                if (i != 6 && i != 10)
                    td[i].removeAttribute("style");
            }
            else if (tableId == "BKTable")
            {
                td[i].removeAttribute("style");
            }
        }

        $(".js-select").select2("destroy").select2(
            {
                "language": {
                    "noResults": function () {
                        return "Sonuç bulunamadı.";
                    }
                },
                escapeMarkup: function (markup) {
                    return markup;
                }
            });;

        if (tableId=="DLTable")
            $("#seri").val(null).trigger("input");

        while (rows > 2)
        {
            document.getElementById(tableId).getElementsByTagName("tr")[rows-1].remove();
            rows--;
        }

        KaydetAktivite();
    }

    //#region Genel Metotlar

    //Referans makinesi seçiminde gerçekleşecek metot. Referans için stok seçimini aktif hale getirir.
    function ReferansMakinesiSecimi(Satir, Tip) {
        if (Satir.value != "SEÇİNİZ") {

            switch (Tip) {
                case "TP":
                    document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[Satir.parentNode.parentNode.rowIndex].getElementsByTagName("select")[3].removeAttribute("disabled");
                    document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[Satir.parentNode.parentNode.rowIndex].getElementsByTagName('i')[0].style.display = "block";
                    var s = document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[Satir.parentNode.parentNode.rowIndex].getElementsByTagName("select")[1].value;

                    var url = "http://192.168.2.13:83/api/seri/receteden/" + s + "/0/" + Satir.value

                    $.getJSON(url, function (d1) {
                        var $sel3 = document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[Satir.parentNode.parentNode.rowIndex].getElementsByTagName("select")[3];
                        $sel3.replaceChildren();
                        var opt2 = document.createElement("option");
                        opt2.value = "SEÇİNİZ";
                        opt2.text = "SEÇİNİZ";
                        opt2.setAttribute("selected", "");
                        opt2.setAttribute("disabled", "");
                        $sel3.appendChild(opt2);
                        for (let i = 0; i < d1.length; i++) {
                            var opt3 = document.createElement("option");
                            opt3.value = d1[i].MAMUL_KODU;
                            opt3.text = d1[i].STOK_ADI;
                            $sel3.appendChild(opt3);
                        }
                    })
                    break;
            };

        }

        KaydetAktivite();
    }

    //Referans stok ölçüsü seçildiğinde tablo tipine göre işlem gerçekleştiren metot.
    function ReferansStokSecimi(Satir, Tip)
    {
        switch (Tip) {
            case "TP":
                TPCariGetir(Satir);
                break;
        };

        KaydetAktivite();
    }

    //Referans seçimi temizlendiğinde tablo tipine göre çalışacak metot.
    function ReferansSecimiTemizle(Satir, Tip)
    {
        var SatirNo = Satir.parentNode.parentNode.rowIndex;

        switch (Tip) {
            case "TP":
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("select")[2].value = "SEÇİNİZ";
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("select")[3].value = "SEÇİNİZ";
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("select")[3].disabled = true;

                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName('i')[0].style.display = "none";

                TPCariGetir(Satir);
                $('.js-select').select2("destroy");
                $('.js-select').select2(
                    {
                        "language": {
                            "noResults": function () {
                                return "Sonuç bulunamadı.";
                            }
                        },
                        escapeMarkup: function (markup) {
                            return markup;
                        }
                    });;
                break;
            case "DL":
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("select")[2].value = "SEÇİNİZ";
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("select")[3].value = "SEÇİNİZ";
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("select")[3].disabled = true;
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("td")[9].innerHTML = null;
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName('i')[0].style.display = "none";
                $('.js-select').select2("destroy");
                $('.js-select').select2(
                    {
                        "language": {
                            "noResults": function () {
                                return "Sonuç bulunamadı.";
                            }
                        },
                        escapeMarkup: function (markup) {
                            return markup;
                        }
                    });;
                document.getElementById(`${Tip.toUpperCase()}Table`).getElementsByTagName("tr")[SatirNo].getElementsByTagName("select")[1].onchange();
                break;
        };


        KaydetAktivite();
    }

    //Stok değiştiğinde gerçekleşecek metot.
    function StokDegistir(Satir, Tip) {
        switch (Tip) {
            case "TP":
                TPTableAgirlikHesabi(Satir);
                break;
        };

        TPCariGetir(Satir);
        KaydetAktivite();
    }

    function DLCariGetir(SatirNo)
    {
        var rowNumber = SatirNo;

        var Cariler = @Html.Raw(Json.Encode(ViewBag.Cariler));
        var StokKodu = document.getElementById('DLTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[3].value;

        if (StokKodu == "SEÇİNİZ") {
            StokKodu = document.getElementById('DLTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[1].value;
        }

        var FiltreliCariler = Cariler.filter(x => x.STOK_ADI == StokKodu);
        var CariListe = `<option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>`;

        for (var i = 0; i < FiltreliCariler.length; i++) {
        CariListe += `<option value="${FiltreliCariler[i].CARI_ISIM}">${FiltreliCariler[i].CARI_ISIM}</option>`;
        }

        document.getElementById('DLTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[4].innerHTML = CariListe;

    }

    //String olarak gelen veriyi, html element olarak geriye döner.
    function StringToHtml(str) {
        var dom = document.createElement('div');
        dom.innerHTML = str;
        return dom;
    };

    //Kaydet buton aktif/pasif durumunu yöneten metot.
    function KaydetAktivite()
    {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        switch (Tip)
        {
            case "TP":
                KaydetAktiviteGenel("TP");
                break;
            case "DL":
                KaydetAktiviteGenel("DL");
                break;
            case "BK":
                KaydetAktiviteGenel("BK");
                break;
            case "RF":
                KaydetAktiviteGenel("RF");
                break;
            case "PB":
                KaydetAktiviteGenel("PB");
                break;

        };
    }
    function KaydetAktiviteGenel(Tip) {

        var TableId = "";
        switch (Tip) {
            case 'DL':
                TableId = 'DLTable'
                break;
            case 'TP':
                TableId = 'TPTable'
                break;
            case 'BK':
                TableId = 'BKTable'
                break;
            case "RF":
                TableId = 'RFTable'
                break;
            case "PB":
                TableId = 'PBTable'
                break;
        }
        var Satirlar = document.getElementById(TableId).getElementsByTagName('tr');

        var Makine, Stok, Miktar, Adet, RefMakine, RefStok,Seri;
        var AlanlarDolu = true;

        for (var i = 1; i < Satirlar.length; i++) {
            Makine = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('select')[0].value == "SEÇİNİZ" ? false : true;
            Stok = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('select')[1].value == "SEÇİNİZ" ? false : true;
            var IlkKosul = true;
            var IkinciKosul = false;
            switch (Tip) {
                case 'TP':
                    Miktar = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('td')[3].getElementsByTagName('input')[0].value.trim().length < 1 ? false : true;
                    Adet = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('td')[4].getElementsByTagName('input')[0].value.trim().length < 1 ? false : true;
                    IlkKosul = Makine && Stok && Miktar && Adet;
                    RefMakine = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('select')[2].value == "SEÇİNİZ" ? false : true;
                    RefStok = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('select')[3].value == "SEÇİNİZ" ? false : true;
                    IkinciKosul = (RefMakine && !RefStok) || (!RefMakine && RefStok);
                    break;
                case 'DL':
                    Miktar = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('td')[4].getElementsByTagName('input')[0].value.trim().length < 1 ? false : true;
                    Adet = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('td')[5].getElementsByTagName('input')[0].value.trim().length < 1 ? false : true;
                    Seri = document.getElementById("seri").value.trim().length < 1 ? false : true;
                    IlkKosul = Makine && Stok && Miktar && Adet && Seri;
                    RefMakine = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('select')[2].value == "SEÇİNİZ" ? false : true;
                    RefStok = document.getElementById(TableId).getElementsByTagName('tr')[i].getElementsByTagName('select')[3].value == "SEÇİNİZ" ? false : true;
                    IkinciKosul = (RefMakine && !RefStok) || (!RefMakine && RefStok);
                    break;
                case 'BK':
                case 'PB':
                case 'RF':
                    Seri = document.getElementById("seri").value.trim().length < 1 ? false : true;
                    IlkKosul = Makine && Stok && Seri && (parseFloat($("#agirlik").val().split("/")[0].replaceAll(".", "")) != 0);
                    break;
            }

            if (!IlkKosul) {
                AlanlarDolu = false;
                break;
            }
            else {
                if (IkinciKosul) {
                    AlanlarDolu = false;
                    break;
                }
            }
        }
        $('#kaydet').prop('disabled', !AlanlarDolu);
    }

    function Grupla(Liste) {

        var Grup = [];
        var Tip = $('input[name="uretim-tip"]:checked').val();

        Liste?.forEach(function (a) {

            if (!this[`${a.STOKADI}${a.MUSTERI}`]) {
                this[`${a.STOKADI}${a.MUSTERI}`] = { MUSTERI: a.MUSTERI, STOKADI: a.STOKADI, ADET: 0, AGIRLIK: 0 };
                Grup.push(this[`${a.STOKADI}${a.MUSTERI}`]);
            }
            switch (Tip) {
                case 'DL':
                    this[`${a.STOKADI}${a.MUSTERI}`].ADET += parseFloat(a.REF_ADET);
                    break;
                case 'TP':
                    this[`${a.STOKADI}${a.MUSTERI}`].ADET += parseFloat(a.ADET);
                    break;
                case 'BK':
                case 'PB':
                case 'RF':
                    this[`${a.STOKADI}${a.MUSTERI}`].ADET += parseFloat(a.ADET);
                    break;
            }
            this[`${a.STOKADI}${a.MUSTERI}`].AGIRLIK += a.AGIRLIK;
        }, Object.create(null));

        return Grup;
    }
//#endregion

//#region BK,PB,RF

    function BKCariGetir(SatirNo)
    {

        var rowNumber = SatirNo;

        var Cariler = @Html.Raw(Json.Encode(ViewBag.Cariler));
        var StokKodu = document.getElementById('BKTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[1].value;

        var FiltreliCariler = Cariler.filter(x => x.STOK_ADI == StokKodu);
        var CariListe = `<option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>`;

        for (let i = 0; i < FiltreliCariler.length; i++) {
            CariListe += `<option value="${FiltreliCariler[i].CARI_ISIM}">${FiltreliCariler[i].CARI_ISIM}</option>`;
        }

        document.getElementById('BKTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[2].innerHTML = CariListe;
    }
    function BKTableLoadLocalData() {
        if (localStorage.BKPivotVeri != null && localStorage.BKPivotVeri != "null") {
            BKTableCreatePivot(JSON.parse(localStorage.BKPivotVeri));
            BKTableCreatePivot2Data();
        }
    }
    function BKTableCreatePivotData()
    {
        var Satirlar = Array.from(document.getElementById('BKTable').getElementsByTagName('tr')).slice(1);
        var SeriNoListe = @Html.Raw(Json.Encode(ViewBag.Seriler));
        var StokAdlari = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
        var IsEmirleri = null;
            $.ajax({
                url: `http://192.168.2.13:83/api/isemri/max`,
                type: 'GET',
                success: (data) => {
                    IsEmirleri = data;
                }
            }).then(function () {
                var OlusturulanIsEmirleri = [];

                var BKPivotVeri = [];
                var BKPivotToplamVeri = [];

                if (localStorage.BKPivotVeri != null && localStorage.BKPivotVeri != "null") {
                    BKPivotVeri = JSON.parse(localStorage.BKPivotVeri);
                    BKPivotToplamVeri = JSON.parse(localStorage.BKPivotToplamVeri);

                    BKPivotVeri.filter(x => x.ISEMRINO != "-").forEach((item) => { OlusturulanIsEmirleri.push(item.ISEMRINO); });
                }

                var GuncelSeriData;

                $.ajax({
                    url: `http://192.168.2.13:83/api/seri/exec/1`,
                    type: 'GET',
                    success: (data) => {
                        GuncelSeriData = data[0];
                    }
                }).then(() => {
                    Satirlar.forEach((item) => {
                        var Makine = item.getElementsByTagName('select')[0].value;
                        var Stok = item.getElementsByTagName('select')[1].value;
                        //var Genislik = parseFloat(item.getElementsByTagName('input')[1].value);
                        //var Adet = parseFloat(item.getElementsByTagName('input')[2].value);
                        var Adet2 = parseFloat(item.getElementsByTagName('input')[1].value);
                        var Agirlik = parseFloat(item.getElementsByTagName('input')[3].value);
                        var Girdi1 = $("#seri").val();
                        var Kalinlik = $("#kalinlik").val();
                        var Kalite = $("#kalite").val();
                        var Kaplama = $("#kaplama").val();
                        var Hamoran = $("#hamoran").val();

                        var StokAdi = StokAdlari.filter(x => x.STOK_ADI == Stok).length > 0 ? StokAdlari.filter(x => x.STOK_ADI == Stok)[0].STOK_ADI : "-";

                        var IsEmirleriMakine = IsEmirleri.filter(x => x.MAK_KODU == Makine);
                        var Musteri = item.getElementsByTagName("select")[2].value;

                        var SonIsEmri = Makine + "23" + (IsEmirleriMakine[IsEmirleriMakine.length - 1].MAX_ISEMRINO).toString().padStart(6, '0') + (1).toString().padStart(3, '0');

                        if (OlusturulanIsEmirleri.includes(SonIsEmri)) {
                            SonIsEmri = OlusturulanIsEmirleri[OlusturulanIsEmirleri.length - 1].substring(0, 12) + (parseFloat(OlusturulanIsEmirleri[OlusturulanIsEmirleri.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
                        }

                        OlusturulanIsEmirleri.push(SonIsEmri);

                        var Veri = {
                            HAMORAN: Hamoran,
                            ISEMRINO: SonIsEmri,
                            STOKADI: StokAdi,
                            KALINLIK: Kalinlik,
                            KALITE: Kalite,
                            KAPLAMA: Kaplama,
                            GIRDI1: Girdi1,
                            GIRDI2: GuncelSeriData.SERI_NO,
                            ADET2: Adet2,
                            AGIRLIK: Math.round(Agirlik)
                        };

                        var ToplamVeri = {
                            STOKADI: StokAdi,
                            ADET: Adet2,
                            MUSTERI: Musteri,
                            AGIRLIK: Math.round(Agirlik)
                        };
                        OldStokAdi = $("#stokadi").val();
                        BKPivotVeri.push(Veri);
                        BKPivotToplamVeri.push(ToplamVeri);

                    })

                    BKTableCreatePivot(BKPivotVeri);

                    var fark = BKPivotVeri.length;

                    if (localStorage.BKPivotVeri != null && localStorage.BKPivotVeri != "null") {
                        fark = fark - JSON.parse(localStorage.BKPivotVeri).filter(x => x.REF_ISEMRINO != "-").length;
                    }

                    $.getJSON(`http://192.168.2.13:83/api/seri/1/${fark}`, function (data) { });

                    localStorage.setItem('BKPivotVeri', JSON.stringify(BKPivotVeri));
                    localStorage.setItem('BKPivotToplamVeri', JSON.stringify(BKPivotToplamVeri));

                    BKTableCreatePivot2Data();
                    $("#seri").val(null);
                    $("#stokadi").html("");
                    $("#adet").val(null);
                    $("#kalinlik").val(null);
                    $("#genislik").val(null);
                    $("#kaplama").val(null);
                    $("#kalite").val(null);
                    $("#metraj").val(null);
                    $("#agirlik").val(null);
                    $("#tamami").prop('disabled',false);
                    $("#tamamidiv").show();
                    KaydetAktivite()
                });
            })


    }
    function BKTableCreatePivot2Data() {
        var BKPivotToplamVeri = JSON.parse(localStorage.BKPivotToplamVeri);

        BKTableCreatePivot2(Grupla(BKPivotToplamVeri));
    }
    function BKTableCreatePivot(PivotVeri) {
        $("#BKPivot").pivot(PivotVeri,
            {
                rows: ["GIRDI1", "ISEMRINO", "STOKADI", "KALINLIK", "KALITE", "KAPLAMA", "ADET2", "AGIRLIK"],
                sorters: {
                    ISEMRINO: function (a, b) { return a - b; } //sort backwards
                }
            }, false, "tr");
        $("#BKPivot").find(".pvtAxisLabel").eq(6).text("ADET");
    }
    function BKTableCreatePivot2(PivotToplamVeri) {
        $("#BKPivotTop").pivot(PivotToplamVeri,
            {
                rows: ["MUSTERI", "STOKADI", "ADET", "AGIRLIK"]
            }, false, "tr");
    }
    function StokChangeBK(val) {
        var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
        var selectedValue = jsonObj.find(x => x.STOK_ADI == val.value);
        var upt = $("#metraj").val().split('/')[0];
        var agirlik = $("#agirlik").val().split('/')[0].replaceAll(".","");
        var table = $("#BKTable");
        var rowIndex = $(val).parent().parent().index()

        var currentRow = table.find("tr").eq(rowIndex);
        var makine = table.find("tr").eq(1).find("select").eq(0).val()
        var o = parseFloat(currentRow.find("input").eq(0).val());
        function verileriGetir() {
            currentRow.find("input").eq(1).val(Math.round((parseFloat(upt) / ((selectedValue.BOY != null ? selectedValue.BOY:0) / 1000)) * o));
            currentRow.find("input").eq(3).val(parseFloat(agirlik) * o);
            BKCariGetir(rowIndex);
        }
        function verileriSifirla() {
            currentRow.find("input").eq(1).val(null);
            currentRow.find("input").eq(3).val(null);
        }
        !!makine ? verileriGetir() : verileriSifirla()
        KaydetAktivite();
    }
    function oranBK(val) {
        var table = $("#BKTable");
        var rowIndex =  $(val).parent().parent().index()
        var currentRow = table.find("tr").eq(rowIndex);
        currentRow.find("select").eq(1).trigger("change");
    }


    function PBCariGetir(SatirNo)
    {

        var rowNumber = SatirNo;

        var Cariler = @Html.Raw(Json.Encode(ViewBag.Cariler));
        var StokKodu = document.getElementById('PBTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[1].value;

        var FiltreliCariler = Cariler.filter(x => x.STOK_ADI == StokKodu);
        var CariListe = `<option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>`;

        for (let i = 0; i < FiltreliCariler.length; i++) {
            CariListe += `<option value="${FiltreliCariler[i].CARI_ISIM}">${FiltreliCariler[i].CARI_ISIM}</option>`;
        }

        document.getElementById('PBTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[2].innerHTML = CariListe;
    }
    function PBTableLoadLocalData() {
        if (localStorage.PBPivotVeri != null && localStorage.PBPivotVeri != "null") {
            PBTableCreatePivot(JSON.parse(localStorage.PBPivotVeri));
            PBTableCreatePivot2Data();
        }
    }
    function PBTableCreatePivotData()
    {
        var Satirlar = Array.from(document.getElementById('PBTable').getElementsByTagName('tr')).slice(1);
        var SeriNoListe = @Html.Raw(Json.Encode(ViewBag.Seriler));
        var StokAdlari = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
         var IsEmirleri = null;
        $.ajax({
            url: `http://192.168.2.13:83/api/isemri/max`,
            type: 'GET',
            success: (data) => {
                IsEmirleri = data;
            }
        }).then(function () {


var OlusturulanIsEmirleri = [];

var PBPivotVeri = [];
var PBPivotToplamVeri = [];

    if (localStorage.PBPivotVeri != null && localStorage.PBPivotVeri != "null") {
        PBPivotVeri = JSON.parse(localStorage.PBPivotVeri);
        PBPivotToplamVeri = JSON.parse(localStorage.PBPivotToplamVeri);

        PBPivotVeri.filter(x => x.ISEMRINO != "-").forEach((item) => { OlusturulanIsEmirleri.push(item.ISEMRINO); });
     }

var GuncelSeriData;

$.ajax({
    url: `http://192.168.2.13:83/api/seri/exec/1`,
    type: 'GET',
    success: (data) => {
        GuncelSeriData = data[0];
    }
}).then(() => {
    Satirlar.forEach((item) => {
        var Makine = item.getElementsByTagName('select')[0].value;
        var Stok = item.getElementsByTagName('select')[1].value;
        //var Genislik = parseFloat(item.getElementsByTagName('input')[1].value);
        //var Adet = parseFloat(item.getElementsByTagName('input')[1].value);
        var Adet2 = parseFloat(item.getElementsByTagName('input')[1].value);
        var Agirlik = parseFloat(item.getElementsByTagName('input')[3].value);
        var Girdi1 = $("#seri").val();
        var Kalinlik = $("#kalinlik").val();
        var Kalite = $("#kalite").val();
        var Kaplama = $("#kaplama").val();
        var Hamoran = $("#hamoran").val();

        var StokAdi = StokAdlari.filter(x => x.STOK_ADI == Stok).length > 0 ? StokAdlari.filter(x => x.STOK_ADI == Stok)[0].STOK_ADI : "-";

        var IsEmirleriMakine = IsEmirleri.filter(x => x.MAK_KODU == Makine);
        var Musteri = item.getElementsByTagName("select")[2].value;

        var SonIsEmri = Makine + "23" + (IsEmirleriMakine[IsEmirleriMakine.length - 1].MAX_ISEMRINO).toString().padStart(6, '0') + (1).toString().padStart(3, '0');

        if (OlusturulanIsEmirleri.includes(SonIsEmri)) {
            SonIsEmri = OlusturulanIsEmirleri[OlusturulanIsEmirleri.length - 1].substring(0, 12) + (parseFloat(OlusturulanIsEmirleri[OlusturulanIsEmirleri.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
        }

        OlusturulanIsEmirleri.push(SonIsEmri);

        var Veri = {
            HAMORAN: Hamoran,
            ISEMRINO: SonIsEmri,
            STOKADI: StokAdi,
            KALINLIK: Kalinlik,
            KALITE: Kalite,
            KAPLAMA: Kaplama,
            GIRDI1: Girdi1,
            GIRDI2: GuncelSeriData.SERI_NO,
            ADET2: Adet2,
            AGIRLIK: Math.round(Agirlik)
        };

        var ToplamVeri = {
            STOKADI: StokAdi,
            ADET: Adet2,
            MUSTERI: Musteri,
            AGIRLIK: Math.round(Agirlik)
        };
            OldStokAdi = $("#stokadi").val();
            PBPivotVeri.push(Veri);
            PBPivotToplamVeri.push(ToplamVeri);

    })

    PBTableCreatePivot(PBPivotVeri);
    var fark = PBPivotVeri.length;

    if (localStorage.PBPivotVeri != null && localStorage.PBPivotVeri != "null")
    {
        fark = fark - JSON.parse(localStorage.PBPivotVeri).filter(x => x.REF_ISEMRINO != "-").length;
    }

    $.getJSON(`http://192.168.2.13:83/api/seri/1/${fark}`, function (data) { });

    localStorage.setItem('PBPivotVeri', JSON.stringify(PBPivotVeri));
    localStorage.setItem('PBPivotToplamVeri', JSON.stringify(PBPivotToplamVeri));

    PBTableCreatePivot2Data();
    $("#seri").val(null);
    $("#stokadi").html("");
    $("#adet").val(null);
    $("#kalinlik").val(null);
    $("#genislik").val(null);
    $("#kaplama").val(null);
    $("#kalite").val(null);
    $("#metraj").val(null);
    $("#agirlik").val(null);
    KaydetAktivite()
});

        })

    }
    function PBTableCreatePivot2Data() {
        var PBPivotToplamVeri = JSON.parse(localStorage.PBPivotToplamVeri);

        PBTableCreatePivot2(Grupla(PBPivotToplamVeri));
    }
    function PBTableCreatePivot(PivotVeri) {
        $("#PBPivot").pivot(PivotVeri,
            {
                rows: ["GIRDI1", "GIRDI2", "ISEMRINO", "STOKADI", "KALINLIK", "KALITE", "KAPLAMA", "ADET2", "AGIRLIK"],
                sorters: {
                    ISEMRINO: function (a, b) { return a - b; } //sort backwards
                }
            }, false, "tr");

    }
    function PBTableCreatePivot2(PivotToplamVeri) {
        $("#PBPivotTop").pivot(PivotToplamVeri,
            {
                rows: ["MUSTERI", "STOKADI", "ADET", "AGIRLIK"]
            }, false, "tr");
    }
    function StokChangePB(val) {
        var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
        var selectedValue = jsonObj.find(x => x.STOK_ADI == val.value);
        var upt = $("#metraj").val().split('/')[0];
        var agirlik = $("#agirlik").val().split('/')[0].replaceAll(".","");
        var table = $("#PBTable");
        var rowIndex = $(val).parent().parent().index()
        var currentRow = table.find("tr").eq(rowIndex);
        var makine = currentRow.find("select").eq(0).val()
        var o = parseFloat(currentRow.find("input").eq(0).val());
        function verileriGetir() {
            currentRow.find("input").eq(1).val(Math.round((parseFloat(upt) / (selectedValue.BOY / 1000)) * o));
            currentRow.find("input").eq(3).val(parseFloat(agirlik) * o);
            PBCariGetir(rowIndex);
        }
        function verileriSifirla() {
            currentRow.find("input").eq(1).val(null);
            currentRow.find("input").eq(3).val(null);
        }
        !!makine ? verileriGetir() : verileriSifirla()
        KaydetAktivite();
    }
    function oranPB(val) {
        var table = $("#PBTable");
        var rowIndex = $(val).parent().parent().index()
        var currentRow = table.find("tr").eq(rowIndex);
        currentRow.find("select").eq(1).trigger("change");
    }


    function RFCariGetir(SatirNo)
    {

        var rowNumber = SatirNo;

        var Cariler = @Html.Raw(Json.Encode(ViewBag.Cariler));
        var StokKodu = document.getElementById('RFTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[1].value;

        var FiltreliCariler = Cariler.filter(x => x.STOK_ADI == StokKodu);
        var CariListe = `<option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>`;

        for (let i = 0; i < FiltreliCariler.length; i++) {
            CariListe += `<option value="${FiltreliCariler[i].CARI_ISIM}">${FiltreliCariler[i].CARI_ISIM}</option>`;
        }

        document.getElementById('RFTable').getElementsByTagName('tr')[rowNumber].getElementsByTagName('select')[2].innerHTML = CariListe;
    }
    function RFTableLoadLocalData() {
        if (localStorage.RFPivotVeri != null && localStorage.RFPivotVeri != "null") {
            RFTableCreatePivot(JSON.parse(localStorage.RFPivotVeri));
            RFTableCreatePivot2Data();
        }
    }
    function RFTableCreatePivotData()
    {
        var Satirlar = Array.from(document.getElementById('RFTable').getElementsByTagName('tr')).slice(1);
        var SeriNoListe = @Html.Raw(Json.Encode(ViewBag.Seriler));
        var StokAdlari = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
        var IsEmirleri = null;
        $.ajax({
            url: `http://192.168.2.13:83/api/isemri/max`,
            type: 'GET',
            success: (data) => {
                IsEmirleri = data;
            }
        }).then(function () {
            var OlusturulanIsEmirleri = [];

            var RFPivotVeri = [];
            var RFPivotToplamVeri = [];

            if (localStorage.RFPivotVeri != null && localStorage.RFPivotVeri != "null") {
                RFPivotVeri = JSON.parse(localStorage.RFPivotVeri);
                RFPivotToplamVeri = JSON.parse(localStorage.RFPivotToplamVeri);

                RFPivotVeri.filter(x => x.ISEMRINO != "-").forEach((item) => { OlusturulanIsEmirleri.push(item.ISEMRINO); });
            }

            var GuncelSeriData;

            $.ajax({
                url: `http://192.168.2.13:83/api/seri/exec/1`,
                type: 'GET',
                success: (data) => {
                    GuncelSeriData = data[0];
                }
            }).then(() => {
                Satirlar.forEach((item) => {
                    var Makine = item.getElementsByTagName('select')[0].value;
                    var Stok = item.getElementsByTagName('select')[1].value;
                    //var Genislik = parseFloat(item.getElementsByTagName('input')[1].value);
                    //var Adet = parseFloat(item.getElementsByTagName('input')[1].value);
                    var Adet2 = parseFloat(item.getElementsByTagName('input')[1].value);
                    var Agirlik = parseFloat(item.getElementsByTagName('input')[3].value);
                    var Girdi1 = $("#seri").val();
                    var Kalinlik = $("#kalinlik").val();
                    var Kalite = $("#kalite").val();
                    var Kaplama = $("#kaplama").val();
                    var Hamoran = $("#hamoran").val();

                    var StokAdi = StokAdlari.filter(x => x.STOK_ADI == Stok).length > 0 ? StokAdlari.filter(x => x.STOK_ADI == Stok)[0].STOK_ADI : "-";

                    var IsEmirleriMakine = IsEmirleri.filter(x => x.MAK_KODU == Makine);
                    var Musteri = item.getElementsByTagName("select")[2].value;

                    var SonIsEmri = Makine + "23" + (IsEmirleriMakine[IsEmirleriMakine.length - 1].MAX_ISEMRINO).toString().padStart(6, '0') + (1).toString().padStart(3, '0');

                    if (OlusturulanIsEmirleri.includes(SonIsEmri)) {
                        SonIsEmri = OlusturulanIsEmirleri[OlusturulanIsEmirleri.length - 1].substring(0, 12) + (parseFloat(OlusturulanIsEmirleri[OlusturulanIsEmirleri.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
                    }

                    OlusturulanIsEmirleri.push(SonIsEmri);

                    var Veri = {
                        HAMORAN: Hamoran,
                        ISEMRINO: SonIsEmri,
                        STOKADI: StokAdi,
                        KALINLIK: Kalinlik,
                        KALITE: Kalite,
                        KAPLAMA: Kaplama,
                        GIRDI1: Girdi1,
                        GIRDI2: GuncelSeriData.SERI_NO,
                        ADET2: Adet2,
                        AGIRLIK: Math.round(Agirlik)
                    };

                    var ToplamVeri = {
                        STOKADI: StokAdi,
                        ADET: Adet2,
                        MUSTERI: Musteri,
                        AGIRLIK: Math.round(Agirlik)
                    };
                    OldStokAdi = $("#stokadi").val();
                    RFPivotVeri.push(Veri);
                    RFPivotToplamVeri.push(ToplamVeri);

                })

                RFTableCreatePivot(RFPivotVeri);
                var fark = RFPivotVeri.length;

                if (localStorage.RFPivotVeri != null && localStorage.RFPivotVeri != "null") {
                    fark = fark - JSON.parse(localStorage.RFPivotVeri).filter(x => x.REF_ISEMRINO != "-").length;
                }

                $.getJSON(`http://192.168.2.13:83/api/seri/1/${fark}`, function (data) { });

                localStorage.setItem('RFPivotVeri', JSON.stringify(RFPivotVeri));
                localStorage.setItem('RFPivotToplamVeri', JSON.stringify(RFPivotToplamVeri));

                RFTableCreatePivot2Data();

                $("#seri").val(null);
                $("#stokadi").html("");
                $("#adet").val(null);
                $("#kalinlik").val(null);
                $("#genislik").val(null);
                $("#kaplama").val(null);
                $("#kalite").val(null);
                $("#metraj").val(null);
                $("#agirlik").val(null);
                $("#tamamidiv").hide();
                KaydetAktivite();
            });

        })


    }
    function RFTableCreatePivot2Data() {
        var RFPivotToplamVeri = JSON.parse(localStorage.RFPivotToplamVeri);

        RFTableCreatePivot2(Grupla(RFPivotToplamVeri));
    }
    function RFTableCreatePivot(PivotVeri) {
        $("#RFPivot").pivot(PivotVeri,
            {
                rows: ["GIRDI1", "ISEMRINO", "STOKADI", "KALINLIK", "KALITE", "KAPLAMA", "ADET2", "AGIRLIK"],
                sorters: {
                    ISEMRINO: function (a, b) { return a - b; } //sort backwards
                }
            }, false, "tr");
    }
    function RFTableCreatePivot2(PivotToplamVeri) {
        $("#RFPivotTop").pivot(PivotToplamVeri,
            {
                rows: ["MUSTERI", "STOKADI", "ADET", "AGIRLIK"]
            }, false, "tr");
    }
    function StokChangeRF(val) {
        var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
        var selectedValue = jsonObj.find(x => x.STOK_ADI == val.value);
        var upt = $("#metraj").val().split('/')[0];
        var agirlik = $("#agirlik").val().split('/')[0].replaceAll(".","");
        var table = $("#RFTable");
        var rowIndex = $(val).parent().parent().index()
        var currentRow = table.find("tr").eq(rowIndex);
        var makine = currentRow.find("select").eq(0).val()
        var o = parseFloat(currentRow.find("input").eq(0).val());
        function verileriGetir() {
            currentRow.find("input").eq(1).val(Math.round((parseFloat(upt) / (selectedValue.BOY / 1000)) * o));
            currentRow.find("input").eq(3).val(parseFloat(agirlik) * o);
            RFCariGetir(rowIndex);
        }
        function verileriSifirla() {
            currentRow.find("input").eq(1).val(null);
            currentRow.find("input").eq(3).val(null);
        }
        !!makine ? verileriGetir() : verileriSifirla()
        KaydetAktivite();
    }
    function oranRF(val) {
        var table = $("#RFTable");
        var rowIndex = $(val).parent().parent().index()
        var currentRow = table.find("tr").eq(rowIndex);
        currentRow.find("select").eq(1).trigger("change");
    }
    function mail() {
        var Tip = $('input[name="uretim-tip"]:checked').val();
        var result;
        switch (Tip) {
            case 'DL':
                result = Grupla(JSON.parse(localStorage.DLlistTop))
                break;
            case 'TP':
                result = Grupla(JSON.parse(localStorage.TPPivotToplamVeri));
               
                break;
            case 'BK':
                result = Grupla(JSON.parse(localStorage.BKPivotToplamVeri));

                break;
            case 'MH':
                result = Grupla(JSON.parse(localStorage.MHPivotToplamVeri));

                break;
            case 'RF':
                result = Grupla(JSON.parse(localStorage.RFPivotToplamVeri));

                break;

        }
        $.ajax({
            url: '@Url.Action("Mail", "IsEmri")',
            type: 'POST',
            data: { mail: result, hamkod: Tip },
            success: function () {
                alert('Mail gönderildi!')
            }
        })
    
    }
    function chcked() {
        var b = $('#tamami').is(':checked');
        if (b) {

            $('.selectmakina2').prop('disabled', false);
        } else {
            $('.bi-x-lg ').trigger('click');
            $('.selectmakina2').prop('disabled', true);
        }
    }
//#endregion
</script>
</body>







