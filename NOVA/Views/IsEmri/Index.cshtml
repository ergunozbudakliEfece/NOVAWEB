
@{
    Layout = "/Views/Shared/_Layout_isemri.cshtml";
}

@model NOVA.Models.MSIPAcik


<!DOCTYPE html>



<html>
<head>
    <meta name="viewport" content="width=device-width" />

    <!-- Page CSS -->
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->







    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <!-- PivotTable.js libs from ../dist -->
    <link rel="stylesheet" type="text/css" href="../dist/pivot.css">
    <script type="text/javascript" src="../dist/pivot.js"></script>
    <script src="~/lib/pivot/multifact-pivottable.js"></script>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://lipis.github.io/bootstrap-sweetalert/lib/sweet-alert.css">

    <style>


        .myInput {
            box-sizing: border-box;
            background-image: url('https://www.w3schools.com/howto/searchicon.png');
            background-position: 5px;
            background-repeat: no-repeat;
            font-size: 12px;
            padding: 8px 20px 7px 45px;
            border: none;
            z-index: 5;
        }

            .myInput:focus {
                outline: 3px solid #ddd;
            }

        .dropdown {
            position: fixed;
            display: inline-block;
        }

        .dropdown-content2 {
            position: fixed;
            background-color: #f6f6f6;
            margin-left: -100px;
            min-width: 100px;
            max-height: 300px;
            overflow: auto;
            border: 1px solid;
            display: none;
            z-index: 10;
        }

            .dropdown-content2 a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                width: auto;
                display: none;
                cursor: pointer;
                z-index: 5;
                border-bottom: 1px solid;
            }

        .dropdown-content {
            position: relative;
            background-color: #f6f6f6;
            min-width: 130px;
            overflow: auto;
            border: 1px solid #ddd;
            z-index: 10;
        }

            .dropdown-content a {
                color: black;
                padding: 12px 16px;
                text-decoration: none;
                display: none;
                cursor: pointer;
                z-index: 5;
            }

        .dropdown a:hover {
            background-color: #ddd;
        }

        .show {
            display: flex;
        }

        .pvtAxisContainer {
            display: none;
        }

        .pvtRenderer {
            display: none;
        }

        .pvtVals {
            display: none;
        }

        #pivotoutput .pvtTotalLabel {
            display: none;
        }

        #pivotoutput .pvtTotal {
            display: none;
        }

        #pivotoutput .pvtGrandTotal {
            display: none;
        }
    </style>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script>
        var sag = 0;
    </script>
    <style>
        .centercontent {
            position: absolute;
            max-width: 100%;
            height: auto;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 5;
        }
        .heart {
            animation: heartbeat 1s infinite alternate;
        }

        @@keyframes heartbeat {
            from {
                opacity: 0.3;
                transform: scale(0.32);
            }

            to {
                opacity: 1;
                transform: scale(0.40);
            }
        }
    </style>
</head>
<body style="background-color: #f5f5f9 !important;font-size:10px !important;">
    @if (ViewBag.Hata != null)
    {
        <div class="row"><div class="col">@ViewBag.Hata</div></div>
    }
    <script>
        if (localStorage.list != null && localStorage.list != "null") {
            document.body.style.cursor = 'wait';
        } else {
            document.body.style.cursor = 'default';
        }

       @*var userData = [];
       userData.push({ USERID: "@Request.Cookies["UserId"].Value", USERNAME: "@Request.Cookies["UserName"].Value", PLATFORM: "@Request.Cookies["Platform"].Value", LASTACTIVETIME: "@DateTime.Now.ToString()" });
       localStorage.userlist = JSON.stringify(userData[0]);*@

    </script>
    @{ var seriler = ViewBag.Seriler;}
    <div id="divPartial" style="display:none">
        @Html.Partial("_Layout_menu")
    </div>
    <div id="divPartial2" style="display:none">
        @Html.Partial("_Layout_menu2")
    </div>
    <div class="authentication-wrapper authentication-basic container-fluid">
        <div class="centercontent" id="content" style="display:unset">
            <div class="heart"><img id="progress" src="~/images/novasaydam.png" style="max-width:15vw" /></div>
        </div>
        <div class="authentication-inner" id="body">
            <button class="btn btn-outline-danger d-none" onclick="testFunction()">SERİTRA</button>

            <div class="card mt-2">



                <div class="card-body me-3">
                    <div class="table-responsive text-nowrap">
                        <table class="table table-bordered" style="border-color:black;" id="table1">



                            <tbody>
                                <tr style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">
                                    <th class="text-center" style="font-size:11px">FABRİKA</th>
                                    <th class="text-center" style="font-size: 11px">ORAN</th>
                                    <th class="text-center" style="font-size: 11px">ÜRÜN KODU</th>
                                    <th class="text-center" style="font-size: 11px">STOK ADI</th>
                                    <th class="text-center" style="font-size: 11px">KONUM</th>
                                    <th class="text-center" style="font-size: 11px">MARKA</th>
                                    <th class="text-center" style="font-size: 11px">ADET</th>
                                    <th class="text-center" style="font-size: 11px">KALINLIK</th>
                                    <th class="text-center" style="font-size: 11px">GENİŞLİK | ±</th>
                                    <th class="text-center" style="font-size: 11px">KAPLAMA</th>
                                    <th class="text-center" style="font-size: 11px">KALİTE</th>
                                    <th class="text-wrap" style="font-size: 10px">KULL. METRAJ/TAM METRAJ</th>
                                    <th class="text-wrap" style="font-size: 10px">KULL. AĞIRLIK/TAM AĞIRLIK</th>



                                </tr>
                                <tr>
                                    <td id="fabrika">
                                        MANİSA
                                    </td>
                                    <td class="text-center p-0" id="or">
                                        <input class="border-0 text-center" style="width:80px" id="hamoran" type="number" value="1.0000" />
                                        <script>
                                            var ham = document.getElementById("hamoran");
                                            ham.oninput = function () {
                                                if (this.value >= 1) {
                                                    this.value = "1.0000";
                                                } else if (this.value < 0) {
                                                    this.value = 0;
                                                }
                                            };</script>
                                    </td>

                                    <td class="text-center p-0" id="urunkodu">
                                        <input class="border-0 w-100 text-center" id="seri" onkeyup="rechange()" />
                                    </td>
                                    <td class="text-center p-0">
                                        <input class="border-0 w-100 text-center" id="stokadi" readonly />
                                    </td>
                                    <td class="text-center p-0">
                                        <input class="border-0  w-100 text-center" readonly />
                                    </td>
                                    <td class="text-center p-0">
                                        <label class="border-0 text-center text-wrap" id="marka"></label>

                                    </td>
                                    <td class="text-center p-0">
                                        <input class="border-0 w-100 text-center" id="adet" readonly />
                                    </td>
                                    <td class="text-center p-0">
                                        <input class="border-0 w-100 text-center" id="kalinlik" readonly />
                                    </td>
                                    <td class="text-center p-0">
                                        <input class="border-0 w-px-50 text-center" id="genislik" readonly />
                                        <input class="border-1 w-px-30 text-center" style="border-radius:5px" id="genislikalti" value="0" />
                                    </td>
                                    <td class="text-center p-0">
                                        <input class="border-0 w-100 text-center" id="kaplama" readonly />
                                    </td>
                                    <td class="text-center p-0">
                                        <input class="border-0 w-100 text-center" id="kalite" readonly />
                                    </td>
                                    <td class="text-center  p-0">
                                        <input class="border-0 w-100 text-center" id="metraj" readonly />
                                    </td>

                                    <td class="text-center">
                                        <input class="border-0 w-100 text-center" id="agirlik" readonly />
                                    </td>


                                </tr>
                                <tr style="display:none">
                                    <th style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%); position: unset">
                                        MAKİNE
                                    </th>
                                    <th style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">OPERATÖR</th>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center"><input class="border-0 w-px-50" /></td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center"><input class="border-0 w-px-50" /></td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center"><input class="border-0 w-px-50" /></td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <th class="text-center ms-1" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">ÇIKIŞ</th>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>

                                </tr>

                                <tr style="display:none">
                                    <td class="p-0">
                                        <select class=" form-select w-100 bg-transparent text-center" id="machinenames">

                                            @foreach (var item in ViewBag.Makine)
                                            {
                                                <option>@item.HAT_KODU</option>
                                            }

                                        </select>
                                    </td>
                                    <th style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">KLT/KNTRL</th>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center"><input class="border-0 w-px-50" /></td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center"><input class="border-0 w-px-50" /></td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center"><input class="border-0 w-px-50" /></td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>
                                    <th class="text-center ms-1" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%)">HURDA</th>
                                    <td class="text-center">
                                        <input class="border-0 w-px-50" />
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <script>
                        function rechange() {
                            var t = document.getElementById("test");
                            var r = t.getElementsByTagName("tr");
                            for (let i = 1; i < r.length; i++) {
                                r[i].getElementsByTagName("input")[3].onkeyup();
                                r[i].getElementsByTagName("select")[3].onchange();
                            }
                        }
                    </script>

                </div>
            </div>

            <div class="card mt-2">

                <div class="card-body">
                    <div class="table-responsive text-nowrap" style="overflow-y: hidden;">
                        <div class="row me-1">
                            <div class="col">
                                <button class="float-end mb-1" disabled onclick="addCell()" id="addcll" style="cursor: pointer; background-color: transparent; background-repeat: no-repeat; border: none;"><img style="width:20px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAAmlJREFUWEftmOFxFDEMhd9VQKiApAJIBUkHQAVABZAKQiogVABUAHRAKiCpINABVEDmu7FuhM5ey3s3zE4G/dm5W9l6lp7l511pYbZaGB7dG0BPJL2QxPOgPEn2taRf5fmpPIeKMJqht5JeFxCZQIC7lHSRccYnC+iZpHeSDrMTB78fks4kfemNzwAiK+dhop9l8m+SCEapMEoI6FNJLOJRGMdck9nqAfpYuGLzAoRJ+T9jL4u/B8bYV63BU4BiZr5KIgC8GDFID4inbhBZYv4tawEi3Z+dNzsGMLtYzPbzGqdagOCFpZnMALBl8OWkvLySBK9aBqktU8Q4io41QL5UcAaiTpXJ+zdLUQJTPoA8KL+3/GuACG4DIF+PwCOAwEHpPxRAxHrosxQBkY3vxYHsZPrOKCCm95Q49h09AqKr0omx95LeJFg8B1AzTgQEIY2g1V1QATgHkN/FbAQ2xtoiIDru4/Lur1SWQQbW42Iym5AF1XZZ3H2eGsQkVhXQHxcpgq0dIYmKrl1qu68aKwZdHKBeyTa1dqnJNMZYSl+yG6entji0OFIvbtv7VFbPmj1t+3RjJN6/PDp+RzncO1xZCT1in4frrQOROlzjWYNkoGu3LNMYbayXH9WzMivQJmVnsjvuJNCIETszq0OOzJGwyA0v8oYlrC06rgpOARRJmzG0D9cnhJnZpBzu3TpqmTKOkTEaKVzw1yCkr12Dop7qKcqhiyJNM96zMlnCB9Boq71cFH1QysXEJnF7gOgzLKR65akNzpSsNo6ODj/sY4NpKA5K+9gA/6yUPeCb93MBpQOMOv4H1MvYHYPjoiWLe0qnAAAAAElFTkSuQmCC" /></button>
                                <button class="float-end" disabled onclick="removeCell()" id="rmvcll" style="cursor: pointer; background-color: transparent; background-repeat: no-repeat; border: none;"><img style="width:20px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAVJJREFUSEu9leFRwzAMhb9OAkwAnQBGgAlgA+gkwATABMAGMAGwQZkE7uOsnuMmscOl1Z1/xFb09GTpecGObbHj+LQAXAGnwEla5vSZ1gvwOpbkGMA5cAscVliugRUg2JYNAdwB18n7G/D7LWXttmzOgBvgIPnpI1DH+gDy4P7g95gJIlPtPoFu/EsAy/KcTpdZxrVekNFHcrrIy1UCWE8pt2ReggYTYxzFYQ5gtzwA1rx2sUOMIsENixzgEbj8Z/YBGCyeABPuzIG9fQxMqX3JJO7CWMbpAPwk75xV7NUuue+fv73BgxRxVoA5S/QVsrLXS44h6/RxrfjF+Wib6jvHoHXmaO9SIYtc7BwcBWw2sYtAOYhl8/u9kGsfIRMIWdlS0nIOyiy9dAOH3g+xsOYCTXpw8mACuZQBpUSzz50bg/YG7lPTiR3Z5t7y6LdFGvD6BU/pUBk06brSAAAAAElFTkSuQmCC" /></button>
                            </div>

                        </div>
                        <div class="row me-1">
                            <div class="col-2">
                                <table class="table table-bordered border-dark" id="test">



                                    <tbody>
                                        <tr id="th" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);">
                                            <th class="p-1"></th>
                                            <th class="p-1 text-center" style="font-size: 11px;">ORAN</th>
                                            <th class="p-1 text-center" style="font-size: 11px;">MAKİNE</th>
                                            <th class="p-1 text-center" style="font-size: 11px;">STOK ÖLÇÜLERİ</th>
                                            <th class="p-1 text-center" style="font-size: 11px;">GENİŞLİK(Dilme)</th>
                                            <th class="p-1 text-center" style="font-size: 11px;">ADET(Dilme)</th>
                                            <th class="p-1 text-center" style="font-size: 11px">AĞIRLIK</th>
                                            <th class="p-1 text-center" style="font-size: 11px">MÜŞTERİ</th>
                                        </tr>
                                        <tr>
                                            <td class="text-center p-1">1</td>
                                            <td class="p-1">
                                                <input class="border-0  text-center" type="number" value="1.00" max="1.00" min="0.00" id="oran1" />
                                                <script>

                                                    var oraninput = document.getElementById("oran1");
                                                    oraninput.oninput = function () {
                                                        if (this.value >= 1) {
                                                            this.value = "1.00";
                                                        } else if (this.value < 0) {
                                                            this.value = "0.00";
                                                        }

                                                    };


                                                </script>

                                            </td>
                                            <td class="border-0 text-center p-1">

                                                <select class="js-example-basic-single " style="width:120px" id="machinenames" onchange="selectChange(this.value)">

                                                    <option selected disabled>MAKİNE SEÇİN</option>

                                                    @foreach (var item in ViewBag.Makine)
                                                    {
                                                        <option>@item.HAT_KODU</option>
                                                    }

                                                </select>


                                                <input class="border-0 text-center" id="1input" readonly style="display:none" />

                                                <script>

                                                    function selectChange(value) {
                                                        var tb = document.getElementById("test");
                                                        var tbrows = tb.getElementsByTagName("tr");
                                                        tbrows[1].getElementsByTagName("select")[1].removeAttribute("disabled");
                                                    document.getElementById("1input").name = value;
                                                    if (value == "DL01") {
                                                        document.getElementById("2input").removeAttribute("disabled");
                                                        document.getElementById("3input").removeAttribute("disabled");
                                                    } else {
                                                        document.getElementById("2input").setAttribute("disabled", "");
                                                        document.getElementById("3input").setAttribute("disabled", "");
                                                    }
                                                     var today = new Date();
                                                        var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                                        var b = jsonObj.find(x => x.MAK_KODU === value);
                                                        var m = null;
                                                        if (localStorage.list != null) {
                                                            m = JSON.parse(localStorage.list);
                                                        }


                                                    var x = "";
                                                    if (document.getElementById("1input").name != "MAKİNE SEÇİN") {
                                                        if (m != null) {
                                                            var num = m.filter(x => x.ISEMRINO.substring(0, 4) == value)[m.filter(x => x.ISEMRINO.substring(0, 4) == value).length - 1];
                                                            var s = m.filter(x => x.ISEMRINO.substring(0, 4) == value);
                                                            var stringArray = [];
                                                            for (let i = 0; i < s.length; i++) {

                                                                if (!stringArray.includes((parseInt(s[i].ISEMRINO.substring(6, 11))).toString().padStart(5, '0'))) {
                                                                    stringArray.push((parseInt(s[i].ISEMRINO.substring(6, 11))).toString().padStart(5, '0'));
                                                                }
                                                            }

                                                            if (stringArray.length > 0) {


                                                                if ((parseInt(stringArray[stringArray.length-1]) + 1).toString().length == 1) {
                                                                    x = ".0000" + (parseInt(stringArray[stringArray.length - 1])+1).toString() + ".01";
                                                                } else if ((parseInt(stringArray)).toString().length == 2) {
                                                                    x = ".000" + (parseInt(stringArray[stringArray.length - 1])+1).toString() + ".01";
                                                                }
                                                                else if ((parseInt(stringArray[stringArray.length - 1])+1).toString().length == 3) {
                                                                    x = ".00" + (parseInt(stringArray[stringArray.length - 1])+1).toString() + ".01";
                                                                }
                                                                else if ((parseInt(stringArray[stringArray.length - 1])+1).toString().length == 4) {
                                                                    x = ".0" + (parseInt(stringArray[stringArray.length - 1])+1).toString() + ".01";
                                                                } else {
                                                                    x = ".00000";
                                                                }
                                                            } else {
                                                                if (b.MAX_ISEMRINO.toString().length == 1) {
                                                                    x = ".0000" + b.MAX_ISEMRINO + ".01";
                                                                } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                                    x = ".000" + b.MAX_ISEMRINO + ".01";
                                                                }
                                                                else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                                    x = ".00" + b.MAX_ISEMRINO + ".01";
                                                                }
                                                                else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                                    x = ".0" + b.MAX_ISEMRINO + ".01";
                                                                } else {
                                                                    x = ".00000";
                                                                }
                                                            }
                                                        }
                                                        else {
                                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                                x = ".0000" + b.MAX_ISEMRINO + ".01";
                                                            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                                x = ".000" + b.MAX_ISEMRINO + ".01";
                                                            }
                                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                                x = ".00" + b.MAX_ISEMRINO + ".01";
                                                            }
                                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                                x = ".0" + b.MAX_ISEMRINO + ".01";
                                                            } else {
                                                                x = ".00000";
                                                            }
                                                        }


                                                        document.getElementById("1input").value = value + today.getFullYear().toString().substring(2) + x;

                                                    } else {
                                                        document.getElementById("1input").value = "";
                                                        }
                                                        if (tbrows.length > 1) {
                                                            for (let a = 2; a < tbrows.length ; a++) {

                                                                tbrows[a].getElementsByTagName("select")[0].onchange();

                                                            }

                                                        }


                    };

                                                </script>
                                            </td>

                                            <td class="p-1 text-center">
                                                <select class="js-example-basic-single" style="width:120px" onchange="sc(this.value)" disabled>
                                                    <option selected disabled>STOK SEÇİN</option>
                                                    @foreach (var item in ViewBag.Stok_Adlari)
                                                    {
                                                        <option value="@item.STOK_ADI">@item.STOK_ADI</option>
                                                    }
                                                </select>
                                                <script>
                                                    function sc(value) {

                                                        var tt = document.getElementById("test");
                                                        var row1 = tt.getElementsByTagName("tr")[1];
                                                        var ss = row1.getElementsByTagName("select")[2];
                                                        if (sag < 1) {
                                                            $('#select2-single').val(null).empty();

                                                            ss.replaceChildren();
                                                            var obj = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                                            var filt = obj.filter(x => x.STOK_ADI === value);
                                                            var op = document.createElement("option");
                                                            op.innerHTML = "EFECE GALVANİZ";
                                                            op.selected = true;
                                                            op.disabled = true;
                                                            ss.appendChild(op);
                                                            for (let i = 0; i < filt.length; i++) {
                                                                op = document.createElement("option");
                                                                op.innerHTML = filt[i].CARI_ISIM + "  *" + filt[i].FISNO + "* SIPKONT:" + filt[i].SIPKONT;
                                                                op.value = filt[i].CARI_ISIM;
                                                                ss.appendChild(op);
                                                                ss.onchange = function () {
                                                                    ss.name = ss.options[ss.selectedIndex].text.split("SIPKONT:")[1] + " " + ss.options[ss.selectedIndex].text.split("*")[1];
                                                                }
                                                            }


                                                            $(document).ready(function () {
                                                                $('.select2-single').select2({
                                                                    tags: true
                                                                }
                                                                );
                                                            });
                                                        } else {

                                                            var t = document.getElementById("test");
                                                            var r = t.getElementsByTagName("tr")[1];
                                                            var c = r.getElementsByTagName("select")[4];
                                                            var c1 = r.getElementsByTagName("input")[4];
                                                            if (c1.value == "") {
                                                                  $('#select2-single').val(null).empty();

                                                            c.replaceChildren();
                                                            var obj = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                                            var filt = obj.filter(x => x.STOK_ADI === value);
                                                            var op = document.createElement("option");
                                                            op.innerHTML = "EFECE GALVANİZ";
                                                            op.selected = true;
                                                            op.disabled = true;
                                                            c.appendChild(op);
                                                            for (let i = 0; i < filt.length; i++) {
                                                                op = document.createElement("option");
                                                                op.innerHTML = filt[i].CARI_ISIM + "  *" + filt[i].FISNO + "* SIPKONT:" + filt[i].SIPKONT;
                                                                op.value = filt[i].CARI_ISIM;
                                                                c.appendChild(op);
                                                                c.onchange = function () {
                                                                    c.name = c.options[c.selectedIndex].text.split("SIPKONT:")[1] + " " + c.options[c.selectedIndex].text.split("*")[1];
                                                                }
                                                            }


                                                            $(document).ready(function () {
                                                                $('.select2-single').select2({
                                                                    tags: true
                                                                }
                                                                );
                                                            });
                                                        }
                                                            }


                                                    }

                                                </script>

                                            </td>
                                            <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" id="2input" onkeyup="changeadet()" disabled /></td>
                                            <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" id="3input" onkeyup="changeadet()" disabled /></td>
                                            <td class="text-center p-1"><input class="border-0 text-center" style="width:80px" id="agirlikhesap" readonly /></td>
                                            <td class="text-center p-1" id="deneme">
                                                <select class="select2-single1" style="width:120px">
                                                    <option value="EFECE GALVANİZ" disabled selected>EFECE GALVANİZ</option>
                                                </select>
                                            </td>

                                        </tr>

                                    </tbody>

                                </table>
                            </div>
                        </div>



                        <script>
                            function changeadet() {
                                var top1 = 0;
                                var rows = document.getElementById("test").getElementsByTagName("tr");
                                for (let i = 1; i < rows.length; i++) {
                                    if (rows[i].getElementsByTagName("input")[3].value != "") {
                                        top1 = top1 + (parseInt(rows[i].getElementsByTagName("input")[2].value) * parseInt(rows[i].getElementsByTagName("input")[3].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value));
                                    }
                                    if (x > 0) {
                                        if ((rows[i].getElementsByTagName("input")[4].value != "") && (rows[i].getElementsByTagName("select")[3].value == "STOK SEÇİN")) {
                                            const Toast = Swal.mixin({
                                                toast: true,
                                                position: 'top-end',
                                                showConfirmButton: false,
                                                timer: 3000,
                                                timerProgressBar: true,
                                                didOpen: (toast) => {
                                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                                }
                                            })

                                            Toast.fire({
                                                icon: 'info',
                                                title: 'Hesaplamaların doğru çalışabilmesi için Makine seçtiğiniz satırdaki Stok Ölçüsü alanını seçmeniz gerekmektedir!'
                                            });
                                        }
                                        rows[i].getElementsByTagName("select")[3].onchange();
                                        rows[i].getElementsByTagName("input")[3].onkeyup();
                                    }

                                }
                                var d = parseInt(((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) - top1);
                                document.getElementById("fireagir").value = d;
                                if (d < 0) {
                                    const Toast = Swal.mixin({
                                        toast: true,
                                        position: 'top-end',
                                        showConfirmButton: false,
                                        timer: 3000,
                                        timerProgressBar: true,
                                        didOpen: (toast) => {
                                            toast.addEventListener('mouseenter', Swal.stopTimer)
                                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                                        }
                                    })

                                    Toast.fire({
                                        icon: 'error',
                                        title: 'Fire eksi olamaz!'
                                    });
                                }

                                document.getElementById("agirlikhesap").value = thousands_separators(Math.round(parseFloat((parseInt(document.getElementById("2input").value) * parseInt(document.getElementById("3input").value)) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(document.getElementById("oran1").value)).toFixed(2)));

                                document.getElementById("fireyuzde").value = parseFloat((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";

                                document.getElementById("fireagirligi").value = thousands_separators(((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2));
                            }
                            function thousands_separators(nu) {
                                var nu_parts = nu.toString().split(".");
                                nu_parts[0] = nu_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                return nu_parts.join(",");
                            }

                        </script>
                    </div>
                    <div class="row mt-3">
                        <div class="col">
                            <div class="table-responsive text-nowrap">
                                <table class="table table-bordered" style="border-color:black;">
                                    <tbody>

                                        <tr style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);">
                                            <th class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">

                                            </th>
                                            <td class="text-center p-1" style="font-size: 11px;font-weight:bold;width:20px">
                                                FİRE YÜZDESİ
                                            </td>
                                            <td class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                FİRE GENİŞLİĞİ (mm)
                                            </td>
                                            <td class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                FİRE AĞIRLIĞI (kg)
                                            </td>

                                        </tr>
                                        <tr style="background-color: #edf0f5 ">
                                            <th class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                FİRE
                                            </th>
                                            <td class="text-center p-1">
                                                <input class="border-0 text-center" style="width:80px;background-color:transparent" id="fireyuzde" keyup="updateinput(this.value)" readonly />
                                            </td>
                                            <td class="text-center p-1">
                                                <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagir" readonly />
                                            </td>
                                            <td class="text-center p-1">
                                                <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagirligi" readonly />
                                            </td>

                                        </tr>
                                        <tr style="background-color: #e8ebeb ">

                                            <th class="text-center p-1" style="font-size: 11px; font-weight: bold; width: 20px">
                                                GENEL FİRE
                                            </th>
                                            <td class="text-center p-1">
                                                <input class="border-0 text-center" style="width:80px;background-color:transparent" id="fireyuzde1" readonly />
                                            </td>
                                            <td class="text-center p-1">
                                                <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagir1" readonly />
                                            </td>
                                            <td class="text-center p-1">
                                                <input class="border-0 text-center" style="width: 80px; background-color: transparent" id="fireagirligi1" readonly />
                                            </td>

                                        </tr>
                                    </tbody>
                                </table>

                            </div>
                        </div>

                        <div class="col-6">
                            <div class="row me-1">
                                <div class="col">
                                    <button class="float-end" disabled onclick="addRow()" id="addRw" style="cursor: pointer; background-color: transparent; background-repeat: no-repeat; border: none;"><img style="width:20px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAkCAYAAADhAJiYAAAAAXNSR0IArs4c6QAAAmlJREFUWEftmOFxFDEMhd9VQKiApAJIBUkHQAVABZAKQiogVABUAHRAKiCpINABVEDmu7FuhM5ey3s3zE4G/dm5W9l6lp7l511pYbZaGB7dG0BPJL2QxPOgPEn2taRf5fmpPIeKMJqht5JeFxCZQIC7lHSRccYnC+iZpHeSDrMTB78fks4kfemNzwAiK+dhop9l8m+SCEapMEoI6FNJLOJRGMdck9nqAfpYuGLzAoRJ+T9jL4u/B8bYV63BU4BiZr5KIgC8GDFID4inbhBZYv4tawEi3Z+dNzsGMLtYzPbzGqdagOCFpZnMALBl8OWkvLySBK9aBqktU8Q4io41QL5UcAaiTpXJ+zdLUQJTPoA8KL+3/GuACG4DIF+PwCOAwEHpPxRAxHrosxQBkY3vxYHsZPrOKCCm95Q49h09AqKr0omx95LeJFg8B1AzTgQEIY2g1V1QATgHkN/FbAQ2xtoiIDru4/Lur1SWQQbW42Iym5AF1XZZ3H2eGsQkVhXQHxcpgq0dIYmKrl1qu68aKwZdHKBeyTa1dqnJNMZYSl+yG6entji0OFIvbtv7VFbPmj1t+3RjJN6/PDp+RzncO1xZCT1in4frrQOROlzjWYNkoGu3LNMYbayXH9WzMivQJmVnsjvuJNCIETszq0OOzJGwyA0v8oYlrC06rgpOARRJmzG0D9cnhJnZpBzu3TpqmTKOkTEaKVzw1yCkr12Dop7qKcqhiyJNM96zMlnCB9Boq71cFH1QysXEJnF7gOgzLKR65akNzpSsNo6ODj/sY4NpKA5K+9gA/6yUPeCb93MBpQOMOv4H1MvYHYPjoiWLe0qnAAAAAElFTkSuQmCC" /></button>
                                    <button class="float-end" disabled onclick="removeRow()" id="removeRw" style="cursor: pointer; background-color: transparent; background-repeat: no-repeat; border: none;"><img style="width:20px" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAAVJJREFUSEu9leFRwzAMhb9OAkwAnQBGgAlgA+gkwATABMAGMAGwQZkE7uOsnuMmscOl1Z1/xFb09GTpecGObbHj+LQAXAGnwEla5vSZ1gvwOpbkGMA5cAscVliugRUg2JYNAdwB18n7G/D7LWXttmzOgBvgIPnpI1DH+gDy4P7g95gJIlPtPoFu/EsAy/KcTpdZxrVekNFHcrrIy1UCWE8pt2ReggYTYxzFYQ5gtzwA1rx2sUOMIsENixzgEbj8Z/YBGCyeABPuzIG9fQxMqX3JJO7CWMbpAPwk75xV7NUuue+fv73BgxRxVoA5S/QVsrLXS44h6/RxrfjF+Wib6jvHoHXmaO9SIYtc7BwcBWw2sYtAOYhl8/u9kGsfIRMIWdlS0nIOyiy9dAOH3g+xsOYCTXpw8mACuZQBpUSzz50bg/YG7lPTiR3Z5t7y6LdFGvD6BU/pUBk06brSAAAAAElFTkSuQmCC" /></button>
                                </div>
                            </div>
                            <div class="row mt-3 me-1">
                                <div class="col">
                                    <button class="btn btn-info float-end" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);color:black;font-size:11px" onclick="kaydet()" id="kaydet">KAYDET</button>
                                </div>
                                <script>
                                    var oncekiadet = 0;
                                    function kaydet() {
                                        oncekiadet = 0;
                                        document.body.style.cursor = 'wait';
                                        var tam = document.getElementById("agirlik").value.split("/")[0].split('.').join('');

                                        var isemrinput = document.getElementById("1input").value;
                                        var sackod = document.getElementById("seri").value;
                                        var hamor = document.getElementById("hamoran").value;
                                        var t = document.getElementById("test");
                                        var rows1 = t.getElementsByTagName("tr");
                                        var list2 = [];
                                        var list3 = [];
                                        var old = null;
                                        var old2 = null;
                                        var serilist = [];
                                        var isemrilist = [];
                                        var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                        if (localStorage.list != null) {
                                            old = JSON.parse(localStorage.list);
                                            old2 = JSON.parse(localStorage.list2);

                                        }
                                        var say = 0;
                                        var sonSeri = null;

                                        $.getJSON("http://192.168.2.13:83/api/seri/exec/1", function (data) {
                                            sonSeri = data;
                                        }).done(function () {

                                            for (var i = 1; i < rows1.length; i++) {

                                            var val = rows1[i].getElementsByTagName("input")[1].value;
                                            var val2 = rows1[i].getElementsByTagName("input")[4].value;
                                            var ilk = val.split('.')[0];
                                            var or = val.split('.')[1];
                                            var so = val.split('.')[2];
                                            var ilk2 = "";
                                            var or2 = "";
                                            var so2 = "";


                                            if (((parseInt(or) + 1).toString()).length == 1) {
                                                or = "0000" + (parseInt(or)+1);
                                            } else if (((parseInt(or) + 1).toString()).length == 2) {
                                                or = "000" + (parseInt(or)+1);
                                            }
                                            else if (((parseInt(or) + 1).toString()).length == 3) {
                                                or = "00" + (parseInt(or) + 1);
                                            }
                                            else if (((parseInt(or) + 1).toString()).length == 4) {
                                                or = "0" + (parseInt(or) + 1);
                                            }else {
                                                or = (parseInt(or) + 1).toString();
                                            }

                                            var jsonObjSeri = @Html.Raw(Json.Encode(ViewBag.Seriler));
                                            var jsonObjSip = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                            var isno = rows1[i].getElementsByTagName("input")[1].value;
                                            var stokadi = rows1[i].getElementsByTagName("select")[1].value;
                                            var urunkodu = document.getElementById("seri").value;

                                            var newser = null
                                            if (old == null) {

                                                newser = (((jsonObjSeri.filter(x => x.SERI_NO == (document.getElementById("seri").value).substring(8)))[0].SERI_SIRA) + 1 - 1).toString();
                                                if (newser.length == 1) {
                                                    newser = "00" + newser;
                                                } else if (newser.length == 2) {
                                                    newser = "0" + newser;
                                                }
                                            } else {
                                                newser = (((jsonObjSeri.filter(x => x.SERI_NO == (document.getElementById("seri").value).substring(8)))[0].SERI_SIRA)).toString();
                                                if (newser.length == 1) {
                                                    newser = "00" + newser;
                                                } else if (newser.length == 2) {
                                                    newser = "0" + newser;
                                                }
                                            }

                                            if (old != null) {
                                                var fil = old.filter(x => x.GIRDI2.substring(8) == (document.getElementById("seri").value).substring(8));
                                                if (fil.length > 0) {
                                                    if ((parseInt(newser) + fil.length).toString().length == 1) {
                                                        newser = "00" + (parseInt(newser) + fil.length).toString();
                                                    } else if ((parseInt(newser) + fil.length).toString().length == 2) {
                                                        newser = "0" + (parseInt(newser) + fil.length).toString();
                                                    } else {
                                                        newser = (parseInt(newser) + fil.length).toString();
                                                    }
                                                } else {
                                                    if (parseInt(newser).toString().length == 1) {
                                                        newser = "00" + parseInt(newser).toString();
                                                    } else if (parseInt(newser).toString().length == 2) {
                                                        newser = "0" + parseInt(newser).toString();
                                                    } else {
                                                        newser = parseInt(newser).toString();
                                                    }
                                                }
                                            }



                                            var urunkodunew = "EFC22" + newser + (document.getElementById("seri").value).substring(8);

                                            var kalinlik = document.getElementById("kalinlik").value;
                                            var ham_genislik = parseInt(document.getElementById("genislik").value) + parseInt(document.getElementById("genislikalti").value);
                                            var kaplama = document.getElementById("kaplama").value;
                                            var kalite = document.getElementById("kalite").value;
                                            var genislik = rows1[i].getElementsByTagName("input")[2].value;
                                            var refisemri = rows1[i].getElementsByTagName("input")[4].value;
                                            var makineref = "";
                                            if (rows1[i].getElementsByTagName("input")[4].value != "") {
                                                makineref = rows1[i].getElementsByTagName("input")[4].value.split('.')[0].substring(0, 4);
                                            }

                                            var refstokolcusu = rows1[i].getElementsByTagName("select")[3].value;
                                            if (rows1[i].getElementsByTagName("select")[3].value == 'STOK SEÇİN') {
                                                refstokolcusu = "";
                                            }
                                            var refadet = rows1[i].getElementsByTagName("input")[5].value;
                                            var refagirlik = rows1[i].getElementsByTagName("input")[6].value;
                                                var adet = rows1[i].getElementsByTagName("input")[3].value;
                                                var num = parseInt(oncekiadet) + parseInt(sonSeri[0].SERI_NO.substring(12, 15));
                                                oncekiadet = parseInt(oncekiadet) + parseInt(adet);
                                            var siparisno = rows1[i].getElementsByTagName("select")[4].name.split(" ")[1];
                                            var agirlik =null;
                                            if (rows1[i].getElementsByTagName("input")[6]) {

                                                if (rows1[i].getElementsByTagName("input")[6].value.split('.').length > 1) {
                                                    agirlik = rows1[i].getElementsByTagName("input")[6].value.split('.')[0] + rows1[i].getElementsByTagName("input")[6].value.split('.')[1];
                                                } else {
                                                    agirlik = rows1[i].getElementsByTagName("input")[6].value;
                                                }

                                            }

                                            var musteri = rows1[i].getElementsByTagName("select")[rows1[i].getElementsByTagName("select").length-1].value;
                                            var stokolcu = null;
                                            if (rows1[i].getElementsByTagName("select")[3]) {
                                                if (rows1[i].getElementsByTagName("select")[3].value != 'STOK SEÇİN') {
                                                    stokolcu = rows1[i].getElementsByTagName("select")[3].value;
                                                } else {
                                                    stokolcu = rows1[i].getElementsByTagName("select")[1].value;
                                                }
                                            } else {
                                                stokolcu = rows1[i].getElementsByTagName("select")[1].value;
                                            }
                                            var makine = rows1[i].getElementsByTagName("input")[1].value.split('.')[0].substring(0,4);
                                            var sipkont = parseInt(rows1[i].getElementsByTagName("select")[4].name.split(" ")[0]);
                                            //WARNING:Değişen bölge

                                            if (old != null) {
                                                    list2 = old;
                                                    list3 = old2;
                                                for (let b = 0; b < adet; b++) {
                                                    var girdi2 = sonSeri[0].SERI_NO;

                                                    list2.push({
                                                        GIRDI1: urunkodu, GIRDI2: girdi2, ISEMRINO: "-", STOKADI: stokadi, KALINLIK: kalinlik, KALITE: kalite, KAPLAMA: kaplama, GENISLIK: genislik, ADET: 1, REF_ISEMRINO:"-" , REF_STOKOLCUSU: refstokolcusu, REF_ADET: Math.round(refadet / adet), AGIRLIK: Math.round((parseInt(refagirlik.replace('.', '')) / adet)).toString(), SIPKONT: sipkont, SIPARISNO: siparisno, HAMORAN: hamor, TAMAGIRLIK: tam});
                                                    serilist.push(girdi2);
                                                    say++;
                                                    }

                                                list3.push({ MAKINE: makine, MAKINEREF: makineref, MUSTERI: musteri, STOKOLCULERI: stokolcu, KALINLIK: kalinlik, KAPLAMA: kaplama, KALITE: kalite, ADET: adet, AGIRLIK: agirlik / adet });
                                            }
                                            else {
                                                for (let b = 0; b < adet; b++) {
                                                    var girdi2 = sonSeri[0].SERI_NO;
                                                    var s = jsonObj.filter(x => x.MAK_KODU == makine);
                                                    var s1 = jsonObj.filter(x => x.MAK_KODU == makineref);
                                                    var sonisemri = makine + "23" + (s[s.length - 1].MAX_ISEMRINO).toString().padStart(6, '0') + (b + 1).toString().padStart(3, '0');
                                                    var sonrefisemri = makineref + "23" + (s1[s1.length - 1].MAX_ISEMRINO).toString().padStart(6, '0') + (b + 1).toString().padStart(3, '0');
                                                    if (isemrilist.includes(sonisemri)) {
                                                        sonisemri = makine + "23" + ((s[s.length - 1].MAX_ISEMRINO) + 1).toString().padStart(6, '0') + (b + 1).toString().padStart(3, '0');
                                                    }
                                                    if (isemrilist.includes(sonrefisemri)) {
                                                        sonrefisemri = makineref + "23" + ((s1[s1.length - 1].MAX_ISEMRINO) + 1).toString().padStart(6, '0') + (b + 1).toString().padStart(3, '0');
                                                    }
                                                    if (serilist.includes(girdi2)) {
                                                        girdi2 = girdi2.substring(0, 12) + (parseInt(serilist[serilist.length - 1].substring(12, 15)) + 1).toString().padStart(3, '0');
                                                    }
                                                    list2.push({
                                                        GIRDI1: urunkodu, GIRDI2: girdi2, ISEMRINO: sonisemri, STOKADI: stokadi, KALINLIK: kalinlik, KALITE: kalite, KAPLAMA: kaplama, GENISLIK: genislik, ADET: 1, REF_ISEMRINO: sonrefisemri, REF_STOKOLCUSU: refstokolcusu, REF_ADET: Math.round(refadet / adet), AGIRLIK: Math.round((parseInt(refagirlik.replace('.', '')) / adet)).toString(), SIPKONT: sipkont, SIPARISNO: siparisno, HAMORAN: hamor, TAMAGIRLIK: tam
                                                    });
                                                    serilist.push(girdi2);
                                                    isemrilist.push(sonisemri);
                                                    isemrilist.push(sonrefisemri);
                                                    say++;
                                                }
                                                    list3.push({ MAKINE: makine, MAKINEREF: makineref, MUSTERI: musteri, STOKOLCULERI: stokolcu, KALINLIK: kalinlik, KAPLAMA: kaplama, KALITE: kalite, ADET: adet, AGIRLIK: agirlik/adet });
                                                }


                                                rows1[i].getElementsByTagName("input")[1].value = ilk + '.' + or + '.' + so;
                                                if (val2 != "") {
                                                    ilk2 = val2.split('.')[0];
                                                    or2 = val2.split('.')[1];
                                                    so2 = val2.split('.')[2];
                                                    if (((parseInt(or2) + 1).toString()).length == 1) {
                                                        or2 = "0000" + (parseInt(or2) + 1);
                                                    } else if (((parseInt(or2) + 1).toString()).length == 2) {
                                                        or2 = "000" + (parseInt(or2) + 1);
                                                    }
                                                    else if (((parseInt(or2) + 1).toString()).length == 3) {
                                                        or2 = "00" + (parseInt(or2) + 1);
                                                    }
                                                    else if (((parseInt(or2) + 1).toString()).length == 4) {
                                                        or2 = "0" + (parseInt(or2) + 1);
                                                    } else {
                                                        or2 = (parseInt(or2) + 1).toString();
                                                    }
                                                    rows1[i].getElementsByTagName("input")[4].value = ilk2 + '.' + or2 + '.' + so2;
                                                }



                                            }
                                            var number = 0;

                                            var rowNumber = (document.getElementsByTagName("table")[1].getElementsByTagName("tr").length);
                                            for (let e = 1; e < rowNumber; e++) {
                                                var adet = document.getElementsByTagName("table")[1].getElementsByTagName("tr")[e].getElementsByTagName("input")[3].value
                                                number = parseInt(number) + parseInt(adet);

                                            }
                                            var uu = "http://192.168.2.13:83/api/seri/1/" + number;
                                            $.getJSON(uu, function (data) { });

                                        var ta = document.getElementById("test");
                                        var ro = ta.getElementsByTagName("tr");
                                        var tp = 0;
                                        var fireag = document.getElementById("fireagirligi1");
                                        var fireyuz = document.getElementById("fireyuzde1");
                                        for (let i = 1; i < ro.length; i++) {

                                            ro[i].getElementsByTagName("input")[3].onkeyup();
                                        }
                                        var tpl = $.pivotUtilities.aggregatorTemplates;
                                        var takiplist = [];

                                        function drawPivot() {

                                            $(function () {

                                                $("#pivotoutput").pivot(
                                                    takiplist,
                                                    {
                                                        rows: ["GIRDI1", "GIRDI2", "ISEMRINO", "STOKADI", "KALINLIK", "KALITE", "KAPLAMA", "GENISLIK", "ADET", "REF_ISEMRINO", "REF_STOKOLCUSU", "REF_ADET", "AGIRLIK", "FIRE", "HAMSARF"],
                                                        cols: [],
                                                        aggregator: tpl.sum()(["ADET"]),
                                                        sorters: {

                                                            GIRDI1: function (a, b) { return a - b; } //sort backwards
                                                        }


                                                    }, false, "tr")
                                            })
                                        }
                                        function getPivot() {
                                            return fetch('./Index?handler=PivotData',
                                                {
                                                    method: 'get',
                                                    headers: {
                                                        'Content-Type': 'application/json;charset=UTF-8'
                                                    }
                                                }).then(function (response) {
                                                    if (response.ok) { return response.text(); } else { throw Error("Hata"); }
                                                }).then(function (text) {
                                                    try {
                                                        return JSON.parse(text);
                                                    } catch (e) {

                                                    }
                                                }).then(function (responseJSON) {
                                                    document.body.style.cursor = 'default';
                                                    takiplist = JSON.parse(localStorage.list);
                                                    var girdi1 = [];

                                                    for (let i = 0; i < takiplist.length; i++) {

                                                        if (!girdi1.includes(takiplist[i].GIRDI1)) {

                                                            girdi1.push({ GIRDI1: takiplist[i].GIRDI1 });

                                                        }

                                                    }

                                                    var newtakip = [];
                                                    for (let i = 0; i < girdi1.length; i++) {
                                                        var sum = 0;
                                                        var fil = takiplist.filter(x => x.GIRDI1 == girdi1[i].GIRDI1);
                                                        for (let e = 0; e < fil.length; e++) {
                                                            sum = sum + parseFloat(fil[e].AGIRLIK.split('.').join(''));
                                                        }

                                                        for (let e = 0; e < fil.length; e++) {
                                                            fil[e].HAMSARF = Math.round((parseFloat(fil[e].AGIRLIK.split('.').join('')) / sum) * (parseFloat(fil[e].TAMAGIRLIK)));
                                                            fil[e].FIRE = Math.round(fil[e].HAMSARF - (parseFloat(fil[e].AGIRLIK.split('.').join(''))));
                                                        }
                                                        if (newtakip.length == 0) {
                                                            newtakip = fil;
                                                        } else {
                                                            newtakip = newtakip.concat(fil);
                                                        }

                                                    }



                                                    takiplist = newtakip;

                                                    for (let i = 0; i < takiplist.length; i++) {
                                                        tp = tp + parseInt(takiplist[i].FIRE);
                                                    }

                                                    fireyuz.value = ((fireag.value / parseFloat(takiplist[0].TAMAGIRLIK)) * 100).toFixed(2) + " %";
                                                    localStorage.list4 = JSON.stringify(takiplist);
                                                    drawPivot();
                                                });



                                        }

                                        var takiplist2 = [];
                                        var aggMap = {
                                            'agg1': {
                                                aggType: 'Sum',
                                                arguments: ['ADET'],
                                                name: 'ADET TOPLAM',
                                                varName: 'a',
                                                renderEnhancement: 'barchart'
                                            },

                                            'agg2': {
                                                aggType: 'Sum',
                                                arguments: ['AGIRLIK'],
                                                name: 'AGIRLIK TOPLAM',
                                                varName: 'b',
                                                hidden: false,
                                                renderEnhancement: 'none'
                                            },

                                        };


                                        var customAggs = {};
                                        customAggs['Multifact Aggregators'] = $.pivotUtilities.multifactAggregatorGenerator(aggMap, []);

                                        var config = {
                                            "cols": [],
                                            "rows": ["MUSTERI", "STOKOLCULERI", "KALINLIK", "KALITE", "KAPLAMA"],
                                            "vals": [],
                                            "rowOrder": "key_a_to_z",
                                            "colOrder": "key_a_to_z",
                                            "aggregatorName": "Multifact Aggregators",
                                            "rendererName": "GT Table Heatmap and Barchart",
                                            "rendererOptions": {

                                                aggregations: {
                                                    defaultAggregations: aggMap,


                                                }
                                            }
                                        };




                                        $.pivotUtilities.customAggs = customAggs;

                                        config.aggregators = $.extend($.pivotUtilities.aggregators, $.pivotUtilities.customAggs);

                                        config.renderers = $.extend($.pivotUtilities.renderers, $.pivotUtilities.gtRenderers);



                                        function drawpivot2() {
                                            $("#pivotoutput2").pivotUI(
                                                takiplist2,
                                                config);
                                        }



                                        function getPivot2() {
                                            return fetch('./Index?handler=PivotData',
                                                {
                                                    method: 'get',
                                                    headers: {
                                                        'Content-Type': 'application/json;charset=UTF-8'
                                                    }
                                                }).then(function (response) {

                                                    if (response.ok) { return response.text(); } else { throw Error("Hata"); }
                                                }).then(function (text) {
                                                    try {
                                                        return JSON.parse(text);
                                                    } catch (e) {
                                                        document.getElementById("addcll").removeAttribute("disabled");
                                                        document.getElementById("rmvcll").removeAttribute("disabled");
                                                        document.getElementById("addRw").removeAttribute("disabled");
                                                        document.getElementById("removeRw").removeAttribute("disabled");
                                                    }
                                                }).then(function (responseJSON) {
                                                    list3.sort((a, b) => a.GIRDI2.localeCompare(b.GIRDI2))
                                                    takiplist2 = list3;
                                                    drawpivot2();
                                                    $('.js-example-basic-single').select2();
                                                    $('.select2-single1').select2();
                                                }).then(function () {
                                                    document.body.style.cursor = 'default';
                                                });
                                        }
                                        var boo=true;
                                        for (let i = 1; i < rows1.length; i++) {
                                            if (rows1[i].getElementsByTagName("select")[1].value == "STOK SEÇİN") {
                                                boo = false;
                                                break;
                                            }
                                        }
                                        if (boo == true) {
                                            localStorage.list = JSON.stringify(list2);
                                            localStorage.list2 = JSON.stringify(list3);

                                            document.getElementById("seri").value = "";
                                            document.getElementById("stokadi").value = "";
                                            document.getElementById("marka").innerHTML = "";
                                            document.getElementById("adet").value = "";
                                            document.getElementById("kalinlik").value = "";
                                            document.getElementById("genislik").value = "";
                                            document.getElementById("genislikalti").value = "0";
                                            document.getElementById("kaplama").value = "";
                                            document.getElementById("kalite").value = "";
                                            document.getElementById("metraj").value = "";
                                            document.getElementById("agirlik").value = "";
                                            document.getElementById("hamoran").value = "1.0000";
                                            document.getElementById("addcll").setAttribute("disabled","");
                                            document.getElementById("rmvcll").setAttribute("disabled", "");
                                            document.getElementById("addRw").setAttribute("disabled", "");
                                            document.getElementById("removeRw").setAttribute("disabled", "");
                                            getPivot();
                                            getPivot2();
                                        } else {
                                            const Toast = Swal.mixin({
                                                toast: true,
                                                position: 'top-end',
                                                showConfirmButton: false,
                                                timer: 3000,
                                                timerProgressBar: true,
                                                didOpen: (toast) => {
                                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                                }
                                            })

                                            Toast.fire({
                                                icon: 'error',
                                                title: 'Eksik veri girdiniz!'
                                            });
                                            document.body.style.cursor = 'default';
                                        }
                                        })







                                    }
                                </script>
                            </div>



                        </div>
                    </div>

                </div>
            </div>

            <div class="card mt-2" id="card">
                <div class="card-body">

                    <div class="row">

                        <div class="col-10 text-end">
                            <button class="btn btn-info" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);color:black;font-size:11px" onclick="sil()" id="sil"><i class='bx bx-trash'> SİL</i></button>
                        </div>
                        <div class="col-2 text-end">
                            <button class="btn btn-info text-nowrap" style="background-image: linear-gradient(to right, #E0EAFC 0%, #CFDEF3 51%, #E0EAFC 100%);color:black;font-size:11px" onclick="netsisaktar()"><i class='bx bx-transfer'></i> NETSİSE AKTAR</button>

                        </div>

                    </div>
                    <div class="table-responsive">
                        <div class="row me-0">
                            <div class="col">




                                <div class="text-center" id="pivotoutput2"></div>





                            </div>
                        </div>


                        <div class="row mb-2 me-0">


                            <div class="col">

                                <div class="text-center mt-3" id="pivotoutput"></div>


                            </div>



                        </div>
                    </div>


                </div>
            </div>
        </div>
    </div>

    <script>
        function testFunction() {
             $.ajax({
                url: '@Url.Action("Post1","IsEmri")',
                type: 'POST',
            })
        }
        function sil() {
            document.body.style.cursor = 'wait';

            load();
        }
        function load() {

            localStorage.list = null;
            localStorage.list2 = null;
            localStorage.list3 = null;
                $('#card').load(document.URL + ' #card');
                document.body.style.cursor = 'default';
            };








        function netsisaktar() {
            $("#progress").show();
            document.body.style.cursor = 'wait';
            var lis = [];
            lis = JSON.parse(localStorage.list4);
            var len = document.getElementById("pivotoutput").getElementsByTagName("tr");
            $.ajax({
                url: '@Url.Action("Post","IsEmri")',
                type: 'POST',
                data: { isemri: lis, number: len.length-2 }
            }).success(function () {
                $("#progress").hide();
                mail();
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'success',
                    title: 'Veriler başarılı bir şekilde Netsis\'e aktarıldı.'
                });
                load();
            }).done(function ()
          {
                localStorage.list = null;
                localStorage.list2 = null;
                localStorage.list3 = null;
                document.body.style.cursor = 'default';

            }).error(function () {
                document.body.style.cursor = 'default';
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })

                Toast.fire({
                    icon: 'error',
                    title: 'Veriler Netsis\'e aktarılamadı!'
                });
            });
        }
         function mail() {
            document.body.style.cursor = 'wait';
            var lis1 = [];
            lis1 = JSON.parse(localStorage.list2);
            $.ajax({
                url: '@Url.Action("Mail")',
                type: 'POST',
                data: { mail:lis1 }
          }).done(function ()
          {

          document.body.style.cursor = 'default';

          });
        }

    </script>





    <script type="text/javascript" src="/assets/vendor/libs/popper/popper.js"></script>
    <script type="text/javascript" src="/assets/vendor/js/bootstrap.js"></script>
    <script type="text/javascript" src="/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

    <script type="text/javascript" src="/assets/vendor/js/menu.js"></script>
    <!-- endbuild -->
    <!-- Vendors JS -->
    <script type="text/javascript" src="/assets/vendor/libs/apex-charts/apexcharts.js"></script>

    <!-- Main JS -->
    <script type="text/javascript" src="/assets/js/main.js"></script>

    <!-- Page JS -->
    <script type="text/javascript" src="/assets/js/dashboards-analytics.js"></script>

    <!-- Place this tag in your head or just before your close body tag. -->


    <script type="text/javascript" async defer src="/Scripts/buttons.js"></script>
    <script type="text/javascript" src="/Scripts/boxicons.js"></script>




    <script>
        document.body.style.zoom = "100%";
        document.getElementById("uretim").className = "menu-item open active";
        document.getElementById("isemri").className = "menu-item active";
    </script>





    <script>
        var rownum = 2;
        var tablealtrow = 0;
        var id = 0;
        var x = 0;

        var selectindex = 0;
        var sayac = 0;
        var fireagirlik = 0;
        var fire = 0;
        var fireyuzde = 0;

        function addRow() {
            var table = document.getElementById("test");
            var onceki = table.getElementsByTagName("tr");
            if (onceki[1].getElementsByTagName("input")[1].name == "DL01") {
                if (onceki[onceki.length - 1].getElementsByTagName("input")[1].value.length > 0) {
                    const idIndex = [];
                    // (B1) GET TABLE

                    var th = document.getElementById("th").getElementsByTagName("th");
                    // (B2) INSERT ROW

                    var row = table.insertRow();


                    // (B3) INSERT CELLS
                    var cell = row.insertCell();
                    cell.innerHTML = cell.parentNode.rowIndex;
                    cell.className = "text-center p-1";
                    cell.style = "width:20px";
                    for (let i = 0; i < th.length - 1; i++) {

                        var input = document.createElement("input");
                        var grup = document.getElementById("machinenames");
                        input.className = "border-0 text-center";

                        var sl = document.createElement("select");
                        cell = row.insertCell();
                        cell.className = "text-center p-1"
                        if (x == 0) {
                            if (i == 0) {
                                cell.className = "text-center p-1"
                                var rows = table.getElementsByTagName("tr");
                                var c = 0;
                                var oraninput = document.createElement("input");
                                oraninput.className = "border-0 text-center";
                                oraninput.type = "number";
                                oraninput.max = "1.00";
                                oraninput.min = "0.00";
                                oraninput.value = "1.00";
                                oraninput.onkeyup = function () {
                                    if (this.value >= 1) {
                                        this.value = "1.00";
                                    } else if (this.value < 0) {
                                        this.value = "0.00";
                                    }

                                    for (let i = 1; i < rows.length; i++) {
                                        c = c + parseFloat(parseInt(rows[i].getElementsByTagName("input")[3].value) * (parseInt(rows[i].getElementsByTagName("input")[4].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value)));
                                    }



                                    document.getElementById("fireagirligi").value = thousands_separators(((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2));

                                    row.getElementsByTagName("input")[5].value = thousands_separators(parseFloat((parseInt(row.getElementsByTagName("input")[4].value) * parseInt(row.getElementsByTagName("input")[3].value)) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(row.getElementsByTagName("input")[0].value)).toFixed(2));
                                };
                                cell.appendChild(oraninput);
                            }
                            else if (i == 1) {
                                cell.className = "text-center border-0 p-1";
                                var sl = document.createElement("select");

                                sl.className = "selectmakina";
                                sl.style = "width:120px";


                                var option;
                                option = document.createElement('option');
                                option.disabled = true;
                                option.selected = true;
                                option.value = "MAKİNE SEÇİN";
                                option.innerHTML = "MAKİNE SEÇİN";
                                sl.appendChild(option);
                                for (let a = 0; a < grup.length; a++) {
                                    option = document.createElement('option');
                                    option.innerHTML = grup.options[a].text;
                                    option.value = grup.options[a].text;

                                    sl.appendChild(option);

                                }
                                cell.appendChild(sl);


                                var input1 = document.createElement("input");
                                input1.className = "border-0 ms-1 text-center d-none";
                                input1.name = sl.value;




                                sl.style = "width:120px";
                                sl.name = "select1";
                                sl.onchange = function () {
                                    input1.name = this.value;
                                    var table = document.getElementById("test");
                                    var ttt = table.getElementsByTagName("tr");
                                    ttt[cell.parentNode.rowIndex].getElementsByTagName("select")[1].removeAttribute("disabled");
                                    if (this.value == "DL01") {
                                        document.getElementById(idIndex[0]).removeAttribute("disabled");
                                        document.getElementById(idIndex[1]).removeAttribute("disabled");
                                    } else {
                                        document.getElementById(idIndex[0]).setAttribute("disabled", "");
                                        document.getElementById(idIndex[1]).setAttribute("disabled", "");
                                    }

                                    var today = new Date();
                                    var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                    var b = jsonObj.find(x => x.MAK_KODU === this.value);
                                    var x = "";
                                    var y = (rownum - 1 - 2) * (6 + rownum - 1 - 2) + 1;
                                    if (y == 0) {
                                        y = 1;
                                    }
                                    var son = 0;
                                    var m = null;
                                    if (localStorage.list != null) {
                                        m = JSON.parse(localStorage.list);
                                    }

                                    var df = [];
                                    if (m != null) {
                                        for (let i = 0; i < m.length; i++) {
                                            df.push(m[i].ISEMRINO.substring(0, 4));
                                        }
                                    }


                                    for (let i = (cell.parentNode.rowIndex) - 1; i > 0; i--) {

                                        if (ttt[i].getElementsByTagName("input")[1].name == this.value) {
                                            son = parseInt(ttt[i].getElementsByTagName("input")[1].value.split('.')[2]);
                                            break;
                                        }
                                    }

                                    if (df.includes(this.value)) {

                                        var maks = [];

                                        var s = m.filter(x => x.ISEMRINO.substring(0, 4) == this.value);
                                        for (let i = 0; i < s.length; i++) {
                                            if (!maks.includes((parseInt(s[i].ISEMRINO.substring(6, 11))).toString().padStart(5, '0'))) {
                                                maks.push((parseInt(s[i].ISEMRINO.substring(6, 11))).toString().padStart(5, '0'));

                                            }

                                        }

                                        if (son != 0) {

                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                x = ".0000" + (Math.max(maks) + 1) + ".0" + (son + 1);
                                            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                x = ".000" + (Math.max(maks) + 1) + ".0" + (son + 1);
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                x = ".00" + (Math.max(maks) + 1) + ".0" + (son + 1);
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                x = ".0" + (Math.max(maks) + 1) + ".0" + (son + 1);
                                            } else {
                                                x = ".00000.00";
                                            }
                                            input1.name = this.value;
                                        }
                                        else {
                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                x = ".0000" + (Math.max(maks) + 1) + ".01";
                                            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                x = ".000" + (Math.max(maks) + 1) + ".01";
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                x = ".00" + (Math.max(maks) + 1) + ".01";
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                x = ".0" + (Math.max(maks) + 1) + ".01";
                                            } else {
                                                x = ".00000.00";
                                            }
                                        }
                                    } else {
                                        if (son != 0) {

                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                x = ".0000" + b.MAX_ISEMRINO + ".0" + (son + 1);
                                            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                x = ".000" + b.MAX_ISEMRINO + ".0" + (son + 1);
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                x = ".00" + b.MAX_ISEMRINO + ".0" + (son + 1);
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                x = ".0" + b.MAX_ISEMRINO + ".0" + (son + 1);
                                            } else {
                                                x = ".00000.00";
                                            }
                                            input1.name = this.value;
                                        }
                                        else {
                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                x = ".0000" + b.MAX_ISEMRINO + ".01";
                                            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                x = ".000" + b.MAX_ISEMRINO + ".01";
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                x = ".00" + b.MAX_ISEMRINO + ".01";
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                x = ".0" + b.MAX_ISEMRINO + ".01";
                                            } else {
                                                x = ".00000.00";
                                            }
                                        }
                                    }




                                    for (let a = cell.parentNode.rowIndex - 1; a >= 1; a--) {

                                        if (this.value == rows[a].getElementsByTagName("input")[1].name) {
                                            son = parseInt(rows[a].getElementsByTagName("input")[1].value.substring(13));

                                            break;
                                        }

                                    }









                                    input1.name = this.value;
                                    rows[cell.parentNode.rowIndex].getElementsByTagName("input")[1].value = this.value + today.getFullYear().toString().substring(2) + x;
                                    if (cell.parentNode.rowIndex < onceki.length - 1) {

                                        for (let a = cell.parentNode.rowIndex + 1; a < onceki.length; a++) {


                                            rows[a].getElementsByTagName("select")[0].onchange();

                                        }

                                    }


                                }

                                input1.setAttribute("readonly", "");

                                cell.appendChild(input1);


                                $('.selectmakina').select2();

                            }
                            else if (i == 2) {

                                var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));

                                var sl1 = document.createElement("select");
                                sl1.className = "selectchild";
                                sl1.style = "width: 120px";
                                sl1.disabled = true;
                                var opt = document.createElement("option");
                                opt.innerHTML = "STOK SEÇİN";
                                opt.disabled = true;
                                opt.selected = true;
                                sl1.appendChild(opt);
                                for (let i = 0; i < jsonObj.length; i++) {
                                    opt = document.createElement("option");
                                    opt.innerHTML = jsonObj[i].STOK_ADI;
                                    opt.value = jsonObj[i].STOK_ADI;
                                    sl1.appendChild(opt);
                                }
                                cell.className = "text-center p-1";
                                cell.appendChild(sl1);
                                $('.selectchild').select2();
                                sl1.onchange = function () {

                                    var tt = document.getElementById("test");
                                    var thisrow = tt.getElementsByTagName("tr")[cell.parentNode.rowIndex];
                                    var ss2 = thisrow.getElementsByClassName("selectcari")[0];
                                    if (x < 1) {
                                        //$('.' + cell.parentNode.rowIndex + "select").val(null).empty();

                                        $('.' + cell.parentNode.rowIndex).val(null).empty();
                                        var obj1 = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                        var filt1 = obj1.filter(x => x.STOK_ADI === this.value);
                                        var op = document.createElement("option");
                                        op.innerHTML = "EFECE GALVANİZ";
                                        ss2.appendChild(op);
                                        for (let i = 0; i < filt1.length; i++) {
                                            op = document.createElement("option");
                                            op.innerHTML = filt1[i].CARI_ISIM + " *" + filt1[i].FISNO + "* SIPKONT:" + filt1[i].SIPKONT;
                                            op.value = filt1[i].CARI_ISIM;
                                            ss2.appendChild(op);
                                            ss2.onchange = function () {
                                                ss2.name = ss2.options[ss2.selectedIndex].text.split("SIPKONT:")[1] + " " + ss2.options[ss2.selectedIndex].text.split("*")[1];
                                            }
                                        }


                                        $(document).ready(function () {
                                            $('.selectcari').select2({
                                                tags: true
                                            }
                                            );
                                        });
                                    }

                                }
                            }
                            else if (i == 3 || i == 4) {
                                cell.className = "text-center p-1";
                                if (row.getElementsByTagName("select")[0].value == "DL01") {

                                    input.id = Math.random() * 100;
                                    input.style = "width:80px";
                                    cell.appendChild(input);
                                    idIndex.push(input.id);
                                } else {
                                    input.setAttribute("disabled", "");
                                    input.id = Math.random() * 100;
                                    input.style = "width:80px";
                                    cell.appendChild(input);
                                    idIndex.push(input.id);
                                }

                                if (i == 4) {
                                    input.onkeyup = function changeadet(e) {
                                        var rows = table.getElementsByTagName("tr");
                                        var top = 0;

                                        for (let i = 1; i < rows.length; i++) {
                                            if (rows[i].getElementsByTagName("input")[3].value != "") {
                                                top = top + (parseInt(rows[i].getElementsByTagName("input")[2].value) * parseInt(rows[i].getElementsByTagName("input")[3].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value));
                                            }

                                        }
                                        var d = parseInt(((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) - top);
                                        document.getElementById("fireagir").value = d;
                                        if (d < 0) {
                                            const Toast = Swal.mixin({
                                                toast: true,
                                                position: 'top-end',
                                                showConfirmButton: false,
                                                timer: 3000,
                                                timerProgressBar: true,
                                                didOpen: (toast) => {
                                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                                }
                                            })

                                            Toast.fire({
                                                icon: 'error',
                                                title: 'Fire eksi olamaz!'
                                            });
                                        }

                                        if (fireyuzde == 0) {
                                            document.getElementById("fireyuzde").value = parseFloat((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";
                                        } else {
                                            document.getElementById("fireyuzde").value = ((fireagirlik / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";

                                        }


                                        document.getElementById("fireagirligi").value = thousands_separators(((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2));

                                        row.getElementsByTagName("input")[4].value = thousands_separators(parseFloat((parseInt(row.getElementsByTagName("input")[3].value) * parseInt(row.getElementsByTagName("input")[2].value)) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(row.getElementsByTagName("input")[0].value)).toFixed(2));
                                    };
                                }

                            }
                            else if (i == 6) {
                                var sl1 = document.createElement("select");
                                sl1.className = "selectcari" + " " + cell.parentNode.rowIndex;
                                sl1.style = "width:120px";
                                var opt = document.createElement("option");
                                opt.innerHTML = "EFECE GALVANİZ";
                                opt.value = "EFECE GALVANİZ";
                                sl1.appendChild(opt);
                                cell.className = "text-center p-1";
                                cell.appendChild(sl1);
                                $("." + cell.parentNode.rowIndex).select2();

                            }
                            else {
                                cell.className = "text-center p-1"
                                var ag = document.createElement("input");
                                ag.className = "border-0 text-center";
                                ag.style = "width:80px";
                                ag.readOnly = true;
                                cell.appendChild(ag);
                            }

                        }
                        else if (x == 1) {
                            if (i == 0) {
                                cell.className = " p-1"
                                var oraninput = document.createElement("input");
                                oraninput.className = "border-0 text-center";
                                oraninput.type = "number";
                                oraninput.max = "1.00";
                                oraninput.min = "0.00";
                                oraninput.value = "1.00";
                                oraninput.onkeyup = function (e) {
                                    if (this.value > 1) {
                                        this.value = "1.00";
                                    } else if (this.value < 0) {
                                        this.value = "0.00";
                                    }
                                    document.getElementsByTagName("table")[1].getElementsByTagName("tr")[e.currentTarget.parentNode.parentNode.rowIndex].getElementsByTagName("input")[3].onkeyup();
                                };
                                cell.appendChild(oraninput);
                            }
                            else if (i == 1) {
                                var rows = table.getElementsByTagName("tr");
                                cell.className = "text-center p-1 border-0";
                                var sl = document.createElement("select");

                                sl.className = "selectmakina";

                                if (rows[1].getElementsByTagName("input")[1].name == "DL01") {
                                    var option;
                                    option = document.createElement('option');
                                    option.disabled = false;
                                    option.selected = true;
                                    option.value = "DL01";
                                    option.innerHTML = "DL01";
                                    sl.appendChild(option);
                                    rows[1].getElementsByTagName("select")[0].setAttribute("disabled", "true");
                                } else {
                                    var option;
                                    option = document.createElement('option');
                                    option.disabled = true;
                                    option.selected = true;
                                    option.value = "MAKİNE SEÇİN";
                                    option.innerHTML = "MAKİNE SEÇİN";
                                    sl.appendChild(option);
                                    for (let a = 0; a < grup.length; a++) {
                                        option = document.createElement('option');
                                        option.innerHTML = grup.options[a].text;
                                        option.value = grup.options[a].text;
                                        if (grup.options[a].text != "DL01") {
                                            sl.appendChild(option);
                                        }
                                       

                                    }
                                }
                                
                                
                                cell.appendChild(sl);


                                var input1 = document.createElement("input");
                                input1.className = "border-0 ms-1 text-center d-none";
                                




                                sl.style = "width:120px"
                                sl.name = "select1";
                                 
                                sl.onchange = function () {
                                    rows[cell.parentNode.rowIndex].getElementsByTagName("select")[1].removeAttribute("disabled");
                                    if (this.value == "DL01") {
                                        document.getElementById(idIndex[0]).removeAttribute("disabled");
                                        document.getElementById(idIndex[1]).removeAttribute("disabled");
                                    } else {
                                        document.getElementById(idIndex[0]).setAttribute("disabled", "");
                                        document.getElementById(idIndex[1]).setAttribute("disabled", "");
                                    }
                                    rows[cell.parentNode.rowIndex].getElementsByTagName("input")[1].name = this.value;
                                    var today = new Date();
                                    var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                    var b = jsonObj.find(x => x.MAK_KODU === this.value);
                                    var x = "";

                                    var m = null;
                                    if (localStorage.list != null) {
                                        m = JSON.parse(localStorage.list);
                                    }

                                    var df = [];
                                    var maks = [];
                                    var s = null;
                                    if (m != null) {
                                        for (let i = 0; i < m.length; i++) {
                                            df.push(m[i].ISEMRINO.substring(0, 4));
                                        }
                                        s = m.filter(x => x.ISEMRINO.substring(0, 4) == this.value);
                                        for (let i = 0; i < s.length; i++) {
                                            if (!maks.includes((parseInt(s[i].ISEMRINO.substring(6, 11))).toString().padStart(5, '0'))) {
                                                maks.push((parseInt(s[i].ISEMRINO.substring(6, 11))).toString().padStart(5, '0'));

                                            }

                                        }
                                    }
                                    var son1 = 0;
                                    for (let i = cell.parentNode.rowIndex - 1; i > 0; i--) {
                                        if (rows[i].getElementsByTagName("input")[1].name == this.value) {
                                            son1 = parseInt(rows[i].getElementsByTagName("input")[1].value.split('.')[2]) + 1;
                                            break;
                                        }

                                    }
                                    if (m != null) {
                                        if (df.includes(this.value)) {
                                           
                                            if (maks.length > 0) {
                                                if (son1 != 0) {
                                                    if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 1) {
                                                        x = ".0000" + (parseInt(maks[maks.length - 1]) + 1).toString() + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                    } else if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 2) {
                                                        x = ".000" + (parseInt(maks[maks.length - 1]) + 1).toString() + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                    }
                                                    else if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 3) {
                                                        x = ".00" + (parseInt(maks[maks.length - 1]) + 1).toString() + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                    }
                                                    else if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 4) {
                                                        x = ".0" + (parseInt(maks[maks.length - 1]) + 1).toString() + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                    } else {
                                                        x = ".00000.00";
                                                    }
                                                } else {
                                                    if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 1) {
                                                        x = ".0000" + (parseInt(maks[maks.length - 1]) + 1).toString() + ".01";
                                                    } else if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 2) {
                                                        x = ".000" + (parseInt(maks[maks.length - 1]) + 1).toString() + ".01";
                                                    }
                                                    else if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 3) {
                                                        x = ".00" + (parseInt(maks[maks.length - 1]) + 1).toString() + ".01";
                                                    }
                                                    else if ((parseInt(maks[maks.length - 1]) + 1).toString().length == 4) {
                                                        x = ".0" + (parseInt(maks[maks.length - 1]) + 1).toString() + ".01";
                                                    } else {
                                                        x = ".00000.00";
                                                    }
                                                }

                                            } else {
                                                if (b.MAX_ISEMRINO.toString().length == 1) {
                                                    x = ".0000" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                    x = ".000" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                    x = ".00" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                    x = ".0" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                    x = ".00000.00";
                                                }
                                            }

                                        } else {
                                            if (son1 != 0) {
                                                if (b.MAX_ISEMRINO.toString().length == 1) {
                                                    x = ".0000" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                    x = ".000" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                    x = ".00" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                    x = ".0" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                } else {
                                                    x = ".00000.00";
                                                }
                                            } else {
                                                if (b.MAX_ISEMRINO.toString().length == 1) {
                                                    x = ".0000" + b.MAX_ISEMRINO + ".01";
                                                } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                    x = ".000" + b.MAX_ISEMRINO + ".01";
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                    x = ".00" + b.MAX_ISEMRINO + ".01";
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                    x = ".0" + b.MAX_ISEMRINO + ".01";
                                                } else {
                                                    x = ".00000.00";
                                                }
                                            }
                                        }
                                    } else {
                                        if (son1 != 0) {
                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                x = ".0000" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                x = ".000" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                x = ".00" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                x = ".0" + b.MAX_ISEMRINO + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                            } else {
                                                x = ".00000.00";
                                            }
                                        } else {
                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                x = ".0000" + b.MAX_ISEMRINO + ".01";
                                            } else if (b.MAX_ISEMRINO.toString().length == 2) { 
                                                x = ".000" + b.MAX_ISEMRINO + ".01";
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                x = ".00" + b.MAX_ISEMRINO + ".01";
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                x = ".0" + b.MAX_ISEMRINO + ".01";
                                            } else {
                                                x = ".00000.00";
                                            }
                                        }
                                    }





                                    rows[cell.parentNode.rowIndex].getElementsByTagName("input")[1].name = this.value;
                                    rows[cell.parentNode.rowIndex].getElementsByTagName("input")[1].value = this.value + today.getFullYear().toString().substring(2) + x;
                                    if (cell.parentNode.rowIndex < onceki.length - 1) {

                                        for (let a = cell.parentNode.rowIndex + 1; a < onceki.length; a++) {


                                            rows[a].getElementsByTagName("select")[0].onchange();

                                        }


                                    }
                                    for (let a = 1; a < onceki.length; a++) {

                                        if (rows[a].getElementsByTagName("select")[2].value != "MAKİNE SEÇİN") {
                                            rows[a].getElementsByTagName("select")[2].onchange();
                                        }

                                    }


                                }

                                input1.setAttribute("readonly", "");

                                cell.appendChild(input1);

                                $('.selectmakina').select2();
                            }
                            else if (i == 2) {
                                var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));

                                var sl1 = document.createElement("select");
                                sl1.className = "selectchild";
                                sl1.style = "width:120px";
                                if (rows[1].getElementsByTagName("input")[1].name == "DL01") {
                                    sl1.disabled = false;
                                } else {
                                    sl1.disabled = true;
                                }
                                
                                var opt = document.createElement("option");
                                opt.innerHTML = "STOK SEÇİN";
                                opt.disabled = true;
                                opt.selected = true;
                                sl1.appendChild(opt);
                                for (let i = 0; i < jsonObj.length; i++) {
                                    opt = document.createElement("option");
                                    opt.innerHTML = jsonObj[i].STOK_ADI;
                                    opt.value = jsonObj[i].STOK_ADI;
                                    sl1.appendChild(opt);
                                }
                                cell.className = "text-center p-1";
                                cell.appendChild(sl1);
                                $('.selectchild').select2();
                                sl1.onchange = function () {

                                    var tt = document.getElementById("test");
                                    var thisrow = tt.getElementsByTagName("tr")[cell.parentNode.rowIndex];
                                    var ss2 = null;
                                    if (sag < 1) {
                                        //$('.' + cell.parentNode.rowIndex + "select").val(null).empty();
                                        ss2 = thisrow.getElementsByTagName("select")[2];
                                        ss2.replaceChild();
                                        var obj1 = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                        var filt1 = obj1.filter(x => x.STOK_ADI === this.value);

                                        for (let i = 0; i < filt1.length; i++) {
                                            var op = document.createElement("option");
                                            op.innerHTML = filt1[i].CARI_ISIM;
                                            op.value = filt1[i].CARI_ISIM;
                                            ss2.appendChild(op);
                                        }


                                        $(document).ready(function () {
                                            $('.selectcari').select2({
                                                tags: true
                                            }
                                            );
                                        });
                                    } else {
                                        var tt2 = document.getElementById("test");
                                        var thisrow2 = tt2.getElementsByTagName("tr")[cell.parentNode.rowIndex];
                                        var ss3 = thisrow2.getElementsByTagName("select")[thisrow2.getElementsByTagName("select").length - 1];
                                        if (thisrow2.getElementsByTagName("input")[thisrow2.getElementsByTagName("input").length - 3].value == "") {


                                            var obj1 = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                            var filt1 = obj1.filter(x => x.STOK_ADI === this.value);
                                            ss3.replaceChildren();
                                            var op = document.createElement("option");
                                            op.innerHTML = "EFECE GALVANİZ";
                                            ss3.appendChild(op);
                                            for (let i = 0; i < filt1.length; i++) {
                                                op = document.createElement("option");
                                                op.innerHTML = filt1[i].CARI_ISIM + " *" + filt1[i].FISNO + "* SIPKONT:" + filt1[i].SIPKONT;
                                                op.value = filt1[i].CARI_ISIM;
                                                ss3.appendChild(op);
                                                ss3.onchange = function () {
                                                    ss3.name = ss3.options[ss3.selectedIndex].text.split("SIPKONT:")[1] + " " + ss3.options[ss3.selectedIndex].text.split("*")[1];
                                                }
                                            }


                                            $(document).ready(function () {
                                                $('.selectcari').select2({
                                                    tags: true
                                                }
                                                );
                                            });
                                        }

                                    }

                                }
                            }
                            else if (i == 3 || i == 4) {
                                cell.className = "text-center p-1";
                                if (row.getElementsByTagName("select")[0].value == "DL01") {

                                    input.id = Math.random() * 100;
                                    input.style = "width:80px";
                                    cell.appendChild(input);
                                    idIndex.push(input.id);
                                } else {
                                    input.setAttribute("disabled", "");
                                    input.id = Math.random() * 100;
                                    input.style = "width:80px";
                                    cell.appendChild(input);
                                    idIndex.push(input.id);
                                }
                                if (i == 4 || i == 3) {
                                    input.onkeyup = function () {
                                        var rows = table.getElementsByTagName("tr");
                                        var top = 0;

                                        for (let i = 1; i < rows.length; i++) {
                                            if (rows[i].getElementsByTagName("input")[3].value != "") {
                                                top = top + (parseInt(rows[i].getElementsByTagName("input")[2].value) * parseInt(rows[i].getElementsByTagName("input")[3].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value));
                                            }
                                            if (x > 0) {
                                                if ((rows[i].getElementsByTagName("input")[4].value != "") && (rows[i].getElementsByTagName("select")[3].value == "STOK SEÇİN")) {
                                                    const Toast = Swal.mixin({
                                                        toast: true,
                                                        position: 'top-end',
                                                        showConfirmButton: false,
                                                        timer: 3000,
                                                        timerProgressBar: true,
                                                        didOpen: (toast) => {
                                                            toast.addEventListener('mouseenter', Swal.stopTimer)
                                                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                                                        }
                                                    })

                                                    Toast.fire({
                                                        icon: 'info',
                                                        title: 'Hesaplamaların doğru çalışabilmesi için Makine seçtiğiniz satırdaki Stok Ölçüsü alanını seçmeniz gerekmektedir!'
                                                    });
                                                }
                                                if (rows[i].getElementsByTagName("select")[3].disabled != true) {
                                                    rows[i].getElementsByTagName("select")[3].onchange();
                                                }

                                            }

                                        }
                                        var d = parseInt(((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) - top);
                                        document.getElementById("fireagir").value = d;
                                        if (d < 0) {

                                            const Toast = Swal.mixin({
                                                toast: true,
                                                position: 'top-end',
                                                showConfirmButton: false,
                                                timer: 3000,
                                                timerProgressBar: true,
                                                didOpen: (toast) => {
                                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                                }
                                            })

                                            Toast.fire({
                                                icon: 'error',
                                                title: 'Fire eksi olamaz!'
                                            });

                                        }
                                        if (fireyuzde == 0) {
                                            document.getElementById("fireyuzde").value = parseFloat((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";
                                        } else {
                                            document.getElementById("fireyuzde").value = ((fireagirlik / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";

                                        }


                                        document.getElementById("fireagirligi").value = thousands_separators(((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2));

                                        row.getElementsByTagName("input")[6].value = thousands_separators(parseFloat((parseInt(row.getElementsByTagName("input")[3].value) * parseInt(row.getElementsByTagName("input")[2].value)) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(row.getElementsByTagName("input")[0].value)).toFixed(0));


                                    }

                                }
                            }
                            else if (i == 11) {
                                var sl1 = document.createElement("select");
                                sl1.className = "selectcari" + " " + cell.parentNode.rowIndex;
                                var opt = document.createElement("option");
                                opt.innerHTML = "EFECE GALVANİZ";
                                opt.value = "EFECE GALVANİZ";
                                sl1.appendChild(opt);
                                sl1.style = "width:120px";
                                cell.className = "text-center p-1";
                                cell.appendChild(sl1);
                                $("." + cell.parentNode.rowIndex).select2();
                            }
                            else if (i == th.length - 7) {
                                if (x == 1) {
                                    if (i == th.length - 4 || i == th.length - 8) {
                                        cell.style = "border-bottom:hidden";
                                    } else {
                                        if (i == th.length - 7) {

                                        } else {
                                            cell.appendChild(input);

                                        }

                                    }


                                    var input1 = document.createElement("input");
                                    var select = document.createElement("select");
                                    select.className = "selectmakina2 ";
                                    select.style = "width:120px";
                                    var option;
                                    var grup = document.getElementById("machinenames");
                                    option = document.createElement('option');
                                    option.innerHTML = "MAKİNE SEÇİN";
                                    option.value = "MAKİNE SEÇİN";
                                    option.selected = true;
                                    option.disabled = true;
                                    select.appendChild(option);
                                    for (let a = 0; a < grup.length; a++) {
                                        option = document.createElement('option');
                                        option.innerHTML = grup.options[a].text;
                                        option.value = grup.options[a].text;
                                        select.appendChild(option);

                                    }

                                    cell.className = "text-center border-0 p-1"
                                    input1.className = "border-0 ms-1 text-center d-none";

                                    cell.appendChild(select);
                                   
                                    select.onchange = function () {

                                        onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].name = this.value + 2;
                                        if (this.value != "MAKİNE SEÇİN") {
                                            onceki[cell.parentNode.rowIndex].getElementsByTagName("select")[3].disabled = false;
                                        }

                                        var today = new Date();
                                        var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                        var b = jsonObj.find(x => x.MAK_KODU === this.value);
                                        var m = null;
                                        if (localStorage.list != null) {
                                            m = JSON.parse(localStorage.list);
                                        }


                                        var x = "";

                                        if (onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].name != "MAKİNE SEÇİN") {
                                            if (m != null) {
                                                var f = m.filter(x => x.REF_ISEMRINO.substring(0, 4) == this.value);
                                                var orta = 0;
                                                var son = 0;
                                                for (let i = onceki.length - 1; i > 0; i--) {
                                                    if (this.value == onceki[i].getElementsByTagName("input")[1].name) {
                                                        orta = parseInt(onceki[i].getElementsByTagName("input")[1].value.split('.')[1]) + 1;
                                                        break;
                                                    }
                                                }
                                                if (f.length > 0) {
                                                    orta = parseInt(f[f.length - 1].REF_ISEMRINO.substring(6, 11)) + 1;
                                                }

                                                for (let i = cell.parentNode.rowIndex - 1; i > 0; i--) {
                                                    if (this.value + 2 == onceki[i].getElementsByTagName("input")[4].name) {
                                                        son = parseInt(onceki[i].getElementsByTagName("input")[4].value.split('.')[2]) + 1;
                                                        break;
                                                    }
                                                }
                                                if (orta != 0) {
                                                    if (son != 0) {
                                                        if (orta.toString().length == 1) {
                                                            x = ".0000" + orta + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                        } else if (orta.toString().length == 2) {
                                                            x = ".000" + orta + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                        }
                                                        else if (orta.toString().length == 3) {
                                                            x = ".00" + orta + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                        }
                                                        else if (orta.toString().length == 4) {
                                                            x = ".0" + orta + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                        } else {
                                                            x = ".00000";
                                                        }
                                                    } else {
                                                        if (orta.toString().length == 1) {
                                                            x = ".0000" + orta + ".01";
                                                        } else if (orta.toString().length == 2) {
                                                            x = ".000" + orta + ".01";
                                                        }
                                                        else if (orta.toString().length == 3) {
                                                            x = ".00" + orta + ".01";
                                                        }
                                                        else if (orta.toString().length == 4) {
                                                            x = ".0" + orta + ".01";
                                                        } else {
                                                            x = ".00000";
                                                        }
                                                    }

                                                } else {
                                                    if (b.MAX_ISEMRINO.toString().length == 1) {
                                                        x = ".0000" + b.MAX_ISEMRINO + ".01";
                                                    } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                        x = ".000" + b.MAX_ISEMRINO + ".01";
                                                    }
                                                    else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                        x = ".00" + b.MAX_ISEMRINO + ".01";
                                                    }
                                                    else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                        x = ".0" + b.MAX_ISEMRINO + ".01";
                                                    } else {
                                                        x = ".00000";
                                                    }
                                                }
                                            } else {
                                                var son = 0;
                                                var orta = 0;
                                                if (this.value == onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[1].name) {
                                                    orta = (parseInt(b.MAX_ISEMRINO) + 1);
                                                } else {
                                                    orta = parseInt(b.MAX_ISEMRINO);
                                                }




                                                if (cell.parentNode.rowIndex == 1) {
                                                    if (b.MAX_ISEMRINO.toString().length == 1) {
                                                        x = ".0000" + orta + ".01";
                                                    } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                        x = ".000" + orta + ".01";
                                                    }
                                                    else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                        x = ".00" + orta + ".01";
                                                    }
                                                    else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                        x = ".0" + orta + ".01";
                                                    } else {
                                                        x = ".00000.00";
                                                    }
                                                    onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].name = this.value + 2;
                                                } else {
                                                    if (cell.parentNode.rowIndex > 1) {
                                                        for (let a = cell.parentNode.rowIndex - 1; a >= 1; a--) {

                                                            if (this.value + 2 == onceki[a].getElementsByTagName("input")[4].name) {
                                                                son = parseInt(onceki[a].getElementsByTagName("input")[4].value.substring(13));

                                                                break;
                                                            }

                                                        }
                                                    }

                                                    if (son != 0) {

                                                        if (b.MAX_ISEMRINO.toString().length == 1) {
                                                            x = ".0000" + orta + "." + ((parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0'));
                                                        } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                            x = ".000" + orta + "." + ((parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0'));
                                                        }
                                                        else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                            x = ".00" + orta + "." + ((parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0'));
                                                        }
                                                        else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                            x = ".0" + orta + "." + (parseInt(rows[cell.parentNode.rowIndex - 1].getElementsByTagName("td")[5].getElementsByTagName("input")[0].value) + 1).toString().padStart(2, '0');
                                                        } else {
                                                            x = ".00000.00";
                                                        }
                                                        onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].name = this.value + 2;
                                                    } else {
                                                        if (b.MAX_ISEMRINO.toString().length == 1) {
                                                            x = ".0000" + orta + ".01";
                                                        } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                            x = ".000" + orta + ".01";
                                                        }
                                                        else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                            x = ".00" + orta + ".01";
                                                        }
                                                        else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                            x = ".0" + orta + ".01";
                                                        } else {
                                                            x = ".00000.00";
                                                        }
                                                    }
                                                }





                                                onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].name = this.value + 2;
                                                onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].value = this.value + today.getFullYear().toString().substring(2) + x;



                                            }

                                            onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].value = this.value + today.getFullYear().toString().substring(2) + x;
                                            onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[4].name = this.value + 2;


                                            for (let a = cell.parentNode.rowIndex + 1; a < onceki.length; a++) {

                                                if (onceki[a].getElementsByTagName("select")[2].value != "MAKİNE SEÇİN") {
                                                    onceki[a].getElementsByTagName("select")[2].onchange();
                                                }


                                            }




                                        }

                                    }
                                    cell.appendChild(input1);
                                }
                                $('.selectmakina2').select2();
                            }
                            else if (i == th.length - 8) {
                                cell.style = "border-bottom:hidden";
                            }
                            else if (i == 9) {
                                cell.style = "border-top:hidden;border-bottom:hidden";
                            }
                            else if (i == th.length - 6) {
                                var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
                                var sl = document.createElement("select");
                                sl.className = "js-example-basic-single";
                                sl.onchange = function () {

                                    var tt = document.getElementById("test");
                                    var rows1 = tt.getElementsByTagName("tr")[cell.parentNode.rowIndex];
                                    var ss = rows1.getElementsByTagName("select")[4];
                                    ss.replaceChildren();
                                    var obj = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                    var filt = obj.filter(x => x.STOK_ADI === this.value);

                                    var filt1 = filt.filter(x => x.FISNO === (ss.name).split(" ")[1]);
                                    var op = document.createElement("option");
                                    if (filt1.length > 0) {
                                        op.innerHTML = "EFECE GALVANİZ";
                                        op.disabled = true;
                                        ss.appendChild(op);
                                        for (let i = 0; i < filt.length; i++) {
                                            op = document.createElement("option");
                                            op.innerHTML = filt[i].CARI_ISIM + "  *" + filt[i].FISNO + "* SIPKONT:" + filt[i].SIPKONT;
                                            op.value = filt[i].CARI_ISIM;
                                            ss.appendChild(op);
                                            if (filt1[0].FISNO == filt[i].FISNO) {
                                                op.selected = true;
                                            }
                                            ss.onchange = function () {
                                                ss.name = ss.options[ss.selectedIndex].text.split("SIPKONT:")[1] + " " + ss.options[ss.selectedIndex].text.split("*")[1];
                                            }
                                        }
                                    } else {
                                        op.innerHTML = "EFECE GALVANİZ";
                                        op.disabled = true;
                                        op.selected = true;
                                        ss.appendChild(op);
                                        for (let i = 0; i < filt.length; i++) {
                                            op = document.createElement("option");
                                            op.innerHTML = filt[i].CARI_ISIM + "  *" + filt[i].FISNO + "* SIPKONT:" + filt[i].SIPKONT;
                                            op.value = filt[i].CARI_ISIM;
                                            ss.appendChild(op);
                                            ss.onchange = function () {
                                                ss.name = ss.options[ss.selectedIndex].text.split("SIPKONT:")[1] + " " + ss.options[ss.selectedIndex].text.split("*")[1];
                                            }
                                        }
                                    }

                                    var oo = jsonObj.find(x => x.STOK_ADI == this.value);
                                    var m = document.getElementById("metraj").value;
                                    var adt = onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[3].value;
                                    var upt = m.split('/')[0];
                                    var o = parseFloat(onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[0].value)
                                    onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[5].value = Math.round(((parseFloat(upt) * parseFloat(adt)) / (oo.BOY / 1000))*o);


                                    $(document).ready(function () {
                                        $('.select2-single').select2({
                                            tags: true
                                        }
                                        );
                                    });


                                }
                                sl.name = "state";
                                var op = document.createElement("option");
                                op.innerHTML = "STOK SEÇİN";
                                op.selected = true;
                                op.disabled = true;
                                sl.appendChild(op);
                                for (let i = 0; i < jsonObj.length; i++) {
                                    op = document.createElement("option");
                                    op.innerHTML = jsonObj[i].STOK_ADI;
                                    op.value = jsonObj[i].STOK_ADI;
                                    sl.appendChild(op);

                                }

                                sl.disabled = true;
                                sl.style = "width:120px";
                                cell.appendChild(sl);
                                $('.js-example-basic-single').select2();


                            }
                            else {
                                var n = document.createElement("input")
                                n.className = "border-0 text-center";
                                n.style = "width:80px";
                                n.readOnly = true;
                                cell.appendChild(n);
                            }
                            
                        }
                        else {
                            if (i == 0) {
                                cell.className = "text-center p-0";
                                var oraninput = document.createElement("input");
                                oraninput.className = "border-0 w-px-75 text-center";
                                oraninput.type = "number";
                                oraninput.max = "1.00";
                                oraninput.min = "0.00";
                                oraninput.value = "1.00";
                                oraninput.onkeyup = function () {
                                    if (this.value > 1) {
                                        this.value = "1.00";
                                    } else if (this.value < 0) {
                                        this.value = "0.00";
                                    }
                                };
                                cell.appendChild(oraninput);
                            }
                            else if (i == 1) {
                                cell.className = "p-0";
                                select.value = "MAKİNE SEÇİN";
                                cell.appendChild(select);

                                cell.style = "display:flex";
                                var input1 = document.createElement("input");
                                input1.className = "border-0 ms-1 text-center";
                                input1.style = "width:200px";
                                input1.name = select.value;




                                select.style = "width:100px"
                                select.name = "select1";
                                select.onchange = function () {
                                    if (this.value == "DL01") {
                                        document.getElementById(idIndex[0]).removeAttribute("disabled");
                                        document.getElementById(idIndex[1]).removeAttribute("disabled");
                                    } else {
                                        document.getElementById(idIndex[0]).setAttribute("disabled", "");
                                        document.getElementById(idIndex[1]).setAttribute("disabled", "");
                                    }
                                    select.value = input1.name;
                                    var today = new Date();
                                    var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                    var b = jsonObj.find(x => x.MAK_KODU === this.value);
                                    var x = "";
                                    var y = (rownum - 1 - 2) * (6 + rownum - 1 - 2) + 1;
                                    if (y == 0) {
                                        y = 1;
                                    }




                                    var k = onceki[cell.parentNode.rowIndex].getElementsByTagName("input")[1];
                                    var son = 0;
                                    for (let a = cell.parentNode.rowIndex - 1; a > 0; a--) {
                                        if (onceki[a].name == this.value) {
                                            son = parseInt(onceki[a].value.split('.')[2]) + 1;
                                            break;
                                        }
                                    }

                                    if (son != 0) {


                                        if (b.MAX_ISEMRINO.toString().length == 1) {
                                            x = ".0000" + b.MAX_ISEMRINO + ".0" + son;
                                        } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                            x = ".000" + b.MAX_ISEMRINO + ".0" + son;
                                        }
                                        else if (b.MAX_ISEMRINO.toString().length == 3) {
                                            x = ".00" + b.MAX_ISEMRINO + ".0" + son;
                                        }
                                        else if (b.MAX_ISEMRINO.toString().length == 4) {
                                            x = ".0" + b.MAX_ISEMRINO + ".0" + son;
                                        } else {
                                            x = ".00000.00";
                                        }
                                    } else {
                                        if (b.MAX_ISEMRINO.toString().length == 1) {
                                            x = ".0000" + b.MAX_ISEMRINO + ".01";
                                        } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                            x = ".000" + b.MAX_ISEMRINO + ".01";
                                        }
                                        else if (b.MAX_ISEMRINO.toString().length == 3) {
                                            x = ".00" + b.MAX_ISEMRINO + ".01";
                                        }
                                        else if (b.MAX_ISEMRINO.toString().length == 4) {
                                            x = ".0" + b.MAX_ISEMRINO + ".01";
                                        } else {
                                            x = ".00000.00";
                                        }
                                    }



                                    input1.value = this.value + today.getFullYear().toString().substring(2) + x;
                                    input1.name = this.value;



                                }

                                input1.setAttribute("readonly", "");

                                cell.appendChild(input1);
                            }
                            else if (i == 2) {
                                var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));

                                var div3 = document.createElement("div");
                                var div4 = document.createElement("div");
                                div3.id = "myDropdown" + rownum;
                                div3.className = "dropdown-content";
                                div4.className = "dropdown-content2";
                                div4.id = Math.random();
                                var input2 = document.createElement("input");
                                input2.type = "text";
                                input2.className = "myInput w-100";
                                input2.placeholder = "Ara..";
                                input2.onkeyup = function () {
                                    var input, filter, ul, li, a, i;
                                    filter = this.value.toUpperCase();
                                    var drop = div4.id;
                                    div4 = document.getElementById(drop);
                                    a = div4.getElementsByTagName("a");
                                    if (filter.length > 0) {
                                        for (i = 0; i < a.length; i++) {
                                            txtValue = a[i].textContent || a[i].innerText;
                                            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                                a[i].style.display = "block";
                                            } else {
                                                a[i].style.display = "none";
                                            }
                                        }
                                    } else {
                                        for (i = 0; i < a.length; i++) {
                                            txtValue = a[i].textContent || a[i].innerText;

                                            a[i].style.display = "none";

                                        }
                                    }
                                };
                                div3.appendChild(input2);
                                var jsonObj1 = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                for (let x = 0; x < jsonObj.length; x++) {
                                    var adiv = document.createElement("a");
                                    adiv.innerHTML = jsonObj[x].STOK_ADI;
                                    adiv.onclick = function () {
                                        input2.value = this.text;
                                        var all = div4.getElementsByTagName("a");
                                        for (let i = 0; i < all.length; i++) {
                                            all[i].style = "display:none";


                                        }
                                        var filterobj = jsonObj1.filter(x => x.STOK_ADI === this.text);
                                        for (let i = 0; i < filterobj.length; i++) {

                                            var newA = document.createElement("a");
                                            newA.innerHTML = filterobj[i].FISNO + "→" + filterobj[i].CARI_ISIM;
                                            newA.style = "display:block";
                                            newA.onclick = function () {

                                                var all = div.getElementsByTagName("a");
                                                for (let i = 0; i < all.length; i++) {
                                                    all[i].style = "display:none";
                                                }

                                                input3.value = this.text;
                                            };
                                            div2.appendChild(newA);
                                        }


                                    };
                                    div4.style = "text-align: left";
                                    div4.appendChild(adiv);
                                }
                                div3.appendChild(div4);






                                cell.appendChild(div3);
                            }
                            else if (i == 3 || i == 4) {
                                if (row.getElementsByTagName("select")[0].value == "DL01") {

                                    input.id = Math.random() * 100;
                                    cell.appendChild(input);
                                    idIndex.push(input.id);
                                } else {
                                    input.setAttribute("disabled", "");
                                    input.id = Math.random() * 100;
                                    cell.appendChild(input);
                                    idIndex.push(input.id);
                                }
                            }
                            else if (i == th.length) {
                                var jsonObj = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                var div = document.createElement("div");
                                var div2 = document.createElement("div");
                                div.id = "myDropdown" + Math.random();
                                div.className = "dropdown-content";
                                div2.className = "dropdown-content2";
                                div2.id = Math.random();
                                var input3 = document.createElement("input");
                                input3.type = "text";
                                input3.className = "myInput w-100";
                                input3.placeholder = "Ara..";
                                input3.onkeyup = function () {
                                    var input, filter, ul, li, a, i;
                                    filter = this.value.toUpperCase();
                                    var drop = div2.id;
                                    div2 = document.getElementById(drop);
                                    a = div2.getElementsByTagName("a");
                                    if (filter.length > 0) {
                                        for (i = 0; i < a.length; i++) {
                                            txtValue = a[i].textContent || a[i].innerText;
                                            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                                a[i].style.display = "block";
                                            } else {
                                                a[i].style.display = "none";
                                            }
                                        }
                                    } else {
                                        for (i = 0; i < a.length; i++) {
                                            txtValue = a[i].textContent || a[i].innerText;

                                            a[i].style.display = "none";

                                        }
                                    }
                                };
                                div.appendChild(input3);
                                for (let x = 0; x < jsonObj.length; x++) {
                                    var adiv = document.createElement("a");
                                    adiv.innerHTML = jsonObj[x].CARI_ISIM;
                                    adiv.onclick = function () {

                                        var all = div.getElementsByTagName("a");
                                        for (let i = 0; i < all.length; i++) {
                                            all[i].style = "display:none";
                                        }

                                        input3.value = this.text;
                                    };
                                    //div2.appendChild(adiv);
                                }
                                div2.style = "text-align: left"
                                div2.id = rownum * 10 + "input";
                                div.appendChild(div2);






                                cell.appendChild(div);
                            }
                            else if (i == th.length - 7) {
                                if (x == 1) {
                                    if (i == th.length - 4 || i == th.length - 8) {
                                        cell.style = "border-bottom:hidden";
                                    } else {
                                        if (i == th.length - 7) {

                                        } else {
                                            cell.appendChild(input);
                                        }

                                    }


                                    cell.className = "p-0";
                                    select.value = "MAKİNE SEÇİN";
                                    cell.appendChild(select);

                                    cell.style = "display:flex";
                                    var input1 = document.createElement("input");
                                    input1.className = "border-0 ms-1 text-center";
                                    input1.style = "width:200px";
                                    input1.name = select.value;





                                    select.name = "select1";
                                    select.onchange = function () {
                                        if (this.value == "DL01") {
                                            document.getElementById(idIndex[0]).removeAttribute("disabled");
                                            document.getElementById(idIndex[1]).removeAttribute("disabled");
                                        } else {
                                            document.getElementById(idIndex[0]).setAttribute("disabled", "");
                                            document.getElementById(idIndex[1]).setAttribute("disabled", "");
                                        }
                                        select.value = input1.name;
                                        var today = new Date();
                                        var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                        var b = jsonObj.find(x => x.MAK_KODU === this.value);
                                        var x = "";
                                        var y = (rownum - 1 - 2) * (6 + rownum - 1 - 2) + 1;
                                        if (y == 0) {
                                            y = 1;
                                        }
                                       

                                        if (this.value == table.getElementsByTagName("select")[selectindex - 1].value) {
                                            var d = parseInt(document.getElementsByName(this.value)[(document.getElementsByName(this.value).length) - 1].value.substring(13)) + 1;

                                            if (b.MAX_ISEMRINO.toString().length == 1) {
                                                x = ".0000" + b.MAX_ISEMRINO + ".0" + d;
                                            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                x = ".000" + b.MAX_ISEMRINO + ".0" + d;
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                x = ".00" + b.MAX_ISEMRINO + ".0" + d;
                                            }
                                            else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                x = ".0" + b.MAX_ISEMRINO + ".0" + d;
                                            } else {
                                                x = ".00000";
                                            }
                                            input1.value = this.value + today.getFullYear().toString().substring(2) + x;
                                            input1.name = this.value;
                                        } else {

                                            var k = document.getElementsByName(this.value).length;
                                            var son = 0;
                                            if (k > 0) {
                                                son = parseInt(document.getElementsByName(this.value)[(document.getElementsByName(this.value).length) - 1].value.substring(13)) + 1;

                                                if (b.MAX_ISEMRINO.toString().length == 1) {
                                                    x = ".0000" + b.MAX_ISEMRINO + ".0" + son;
                                                } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                    x = ".000" + b.MAX_ISEMRINO + ".0" + son;
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                    x = ".00" + b.MAX_ISEMRINO + ".0" + son;
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                    x = ".0" + b.MAX_ISEMRINO + ".0" + son;
                                                } else {
                                                    x = ".00000.00";
                                                }
                                            } else {
                                                if (b.MAX_ISEMRINO.toString().length == 1) {
                                                    x = ".0000" + b.MAX_ISEMRINO + ".01";
                                                } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                    x = ".000" + b.MAX_ISEMRINO + ".01";
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                    x = ".00" + b.MAX_ISEMRINO + ".01";
                                                }
                                                else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                    x = ".0" + b.MAX_ISEMRINO + ".01";
                                                } else {
                                                    x = ".00000.00";
                                                }
                                            }



                                            input1.value = this.value + today.getFullYear().toString().substring(2) + x;
                                            input1.name = this.value;
                                        }


                                    }

                                    input1.setAttribute("readonly", "");

                                    cell.appendChild(input1);

                                }
                                else if (x == 2) {
                                    if (i == th.length - 8 || i == th.length - 12 || i == th.length - 4) {
                                        cell.style = "border-bottom:hidden";
                                    } else {
                                        cell.appendChild(input);
                                    }
                                }
                                else if (x == 3) {
                                    if (i == th.length - 8 || i == th.length - 12 || i == th.length - 4 || i == th.length - 16) {
                                        cell.style = "border-bottom:hidden";
                                    } else {
                                        cell.appendChild(input);
                                    }
                                }
                                else {
                                    cell.appendChild(input);
                                }
                            }
                            else if (i == th.length - 8) {
                                cell.style = "border-bottom:hidden";
                            }
                            else if (i == th.length - 4) {
                                cell.style = "border-bottom:hidden";
                            }
                            else if (i == th.length - 6) {
                                var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));

                                var div3 = document.createElement("div");
                                var div4 = document.createElement("div");
                                div3.id = "myDropdown" + rownum;
                                div3.className = "dropdown-content";
                                div4.className = "dropdown-content2";
                                div4.id = Math.random();
                                var input2 = document.createElement("input");
                                input2.type = "text";
                                input2.className = "myInput w-100";
                                input2.placeholder = "Ara..";
                                input2.onkeyup = function () {
                                    var input, filter, ul, li, a, i;
                                    filter = this.value.toUpperCase();
                                    var drop = div4.id;
                                    div4 = document.getElementById(drop);
                                    a = div4.getElementsByTagName("a");
                                    if (filter.length > 0) {
                                        for (i = 0; i < a.length; i++) {
                                            txtValue = a[i].textContent || a[i].innerText;
                                            if (txtValue.toUpperCase().indexOf(filter) > -1) {
                                                a[i].style.display = "block";
                                            } else {
                                                a[i].style.display = "none";
                                            }
                                        }
                                    } else {
                                        for (i = 0; i < a.length; i++) {
                                            txtValue = a[i].textContent || a[i].innerText;

                                            a[i].style.display = "none";

                                        }
                                    }
                                };
                                div3.appendChild(input2);
                                var jsonObj1 = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                for (let x = 0; x < jsonObj.length; x++) {
                                    var adiv = document.createElement("a");
                                    adiv.innerHTML = jsonObj[x].STOK_ADI;
                                    adiv.onclick = function () {
                                        input2.value = this.text;
                                        var all = div4.getElementsByTagName("a");
                                        for (let i = 0; i < all.length; i++) {
                                            all[i].style = "display:none";


                                        }
                                        var filterobj = jsonObj1.filter(x => x.STOK_ADI === this.text);
                                        for (let i = 0; i < filterobj.length; i++) {

                                            var newA = document.createElement("a");
                                            newA.innerHTML = filterobj[i].FISNO + "→" + filterobj[i].CARI_ISIM;
                                            newA.style = "display:block";
                                            newA.onclick = function () {

                                                var all = div.getElementsByTagName("a");
                                                for (let i = 0; i < all.length; i++) {
                                                    all[i].style = "display:none";
                                                }

                                                input3.value = this.text;
                                            };
                                            div2.appendChild(newA);
                                        }


                                    };
                                    div4.style = "text-align: left";
                                    div4.appendChild(adiv);
                                }
                                div3.appendChild(div4);






                                cell.appendChild(div3);
                            }
                            else {
                                cell.appendChild(document.createElement("input"));
                            }
                        }




                    }
                    var filt2 = jsonObj.find(x => x.STOK_ADI == this.value);
                    rownum++;
                    selectindex++;
                    rows[cell.parentNode.rowIndex].getElementsByTagName("select")[0].onchange();




                } else {
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    })
                    Toast.fire({
                        icon: 'error',
                        title: 'Makine seçmediniz!'
                    })
                }
            } else {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                Toast.fire({
                    icon: 'error',
                    title: 'Belirtilen makinede başka ürün seçemezsiniz!'
                })
            }


        }



        $(document).ready(function () {
    var tp = 0;
    var fireag = document.getElementById("fireagirligi1");
    var fireyuz = document.getElementById("fireyuzde1");
    $("#makkodlari").select2();
    document.getElementById("test").getElementsByTagName("tbody")[0].onclick = function (e) {
        console.log(e.target.parentNode.rowIndex)
        console.log(e.target.innerHTML)
    };
    var tpl = $.pivotUtilities.aggregatorTemplates;
    var takiplist = [];
    function drawPivot() {

        $(function () {

            $("#pivotoutput").pivot(
                takiplist,
                {
                    rows: ["GIRDI1", "GIRDI2", "ISEMRINO", "STOKADI", "KALINLIK", "KALITE", "KAPLAMA", "GENISLIK", "ADET", "REF_ISEMRINO", "REF_STOKOLCUSU", "REF_ADET", "AGIRLIK", "FIRE", "HAMSARF"],
                    cols: [],
                    aggregator: tpl.sum()(["ADET"]),
                    sorters: {

                        GIRDI1: function (a, b) { return a - b; } //sort backwards
                    }



                }, false, "tr")
        })
    }
    function getPivot() {
        return fetch('./Index?handler=PivotData',
            {
                method: 'get',
                headers: {
                    'Content-Type': 'application/json;charset=UTF-8'
                }
            }).then(function (response) {
                if (response.ok) { return response.text(); } else { throw Error("Hata"); }
            }).then(function (text) {
                try {
                    return JSON.parse(text);
                } catch (e) {

                }
            }).then(function (responseJSON) {

                takiplist = JSON.parse(localStorage.list);
                var girdi1 = [];

                for (let i = 0; i < takiplist.length; i++) {

                    if (!girdi1.includes(takiplist[i].GIRDI1)) {

                        girdi1.push({ GIRDI1: takiplist[i].GIRDI1 });

                    }

                }

                var newtakip = [];
                for (let i = 0; i < girdi1.length; i++) {
                    var sum = 0;
                    var fil = takiplist.filter(x => x.GIRDI1 == girdi1[i].GIRDI1);
                    for (let e = 0; e < fil.length; e++) {
                        sum = sum + parseFloat(fil[e].AGIRLIK.split('.').join(''));
                    }

                    for (let e = 0; e < fil.length; e++) {
                        fil[e].HAMSARF = Math.round((parseFloat(fil[e].AGIRLIK.split('.').join('')) / sum) * (parseFloat(fil[e].TAMAGIRLIK)));
                        fil[e].FIRE = Math.round(fil[e].HAMSARF - (parseFloat(fil[e].AGIRLIK.split('.').join(''))));
                    }
                    if (newtakip.length == 0) {
                        newtakip = fil;
                    } else {
                        newtakip = newtakip.concat(fil);
                    }

                }



                takiplist = newtakip;

                for (let i = 0; i < takiplist.length; i++) {
                    tp = tp + parseInt(takiplist[i].FIRE);
                }

                fireyuz.value = ((fireag.value / parseFloat(takiplist[0].TAMAGIRLIK)) * 100).toFixed(2) + " %";
                localStorage.list4 = JSON.stringify(takiplist);
                drawPivot();
                document.body.style.cursor = 'default';
            });



    }
    var takiplist2 = [];
    function drawPivot2() {


        var aggMap = {
            'agg1': {
                aggType: 'Sum',
                arguments: ['ADET'],
                name: 'ADET TOPLAM',
                varName: 'a',
                renderEnhancement: 'none'
            },

            'agg2': {
                aggType: 'Sum',
                arguments: ['AGIRLIK'],
                name: 'AGIRLIK TOPLAM',
                varName: 'b',
                hidden: false,
                renderEnhancement: 'none'
            },

        };


        var customAggs = {};
        customAggs['Multifact Aggregators'] = $.pivotUtilities.multifactAggregatorGenerator(aggMap, []);

        var config = {
            "cols": [],
            "rows": ["MUSTERI", "STOKOLCULERI", "KALINLIK", "KALITE", "KAPLAMA", "REF_ISEMRINO"],
            "vals": [],
            "rowOrder": "key_a_to_z",
            "colOrder": "key_a_to_z",
            "aggregatorName": "Multifact Aggregators",
            "rendererName": "GT Table Heatmap and Barchart",
            "rendererOptions": {

                aggregations: {
                    defaultAggregations: aggMap,


                }
            }
        };




        $.pivotUtilities.customAggs = customAggs;

        config.aggregators = $.extend($.pivotUtilities.aggregators, $.pivotUtilities.customAggs);

        config.renderers = $.extend($.pivotUtilities.renderers, $.pivotUtilities.gtRenderers);

        //$(function () {


        //    $("#pivotoutput2").pivotUI(
        //        takiplist2,
        //        config);
        //});
    }
    function getPivot2() {
        return fetch('./Index?handler=PivotData',
            {
                method: 'get',
                headers: {
                    'Content-Type': 'application/json;charset=UTF-8'
                }
            }).then(function (response) {
                if (response.ok) { return response.text(); } else { throw Error("Hata"); }
            }).then(function (text) {
                try {
                    return JSON.parse(text);
                } catch (e) {
                    document.getElementById("addcll").removeAttribute("disabled");
                    document.getElementById("rmvcll").removeAttribute("disabled");
                    document.getElementById("addRw").removeAttribute("disabled");
                    document.getElementById("removeRw").removeAttribute("disabled");
                }
            }).then(function (responseJSON) {

                takiplist2 = JSON.parse(localStorage.list2);
                drawPivot2();
            }).then(function () {
                document.body.style.cursor = 'default';
                var rr = document.getElementsByClassName("pvtTable")[0].getElementsByTagName("tr");
                var sum = 0;
                var sum2 = 0;
                for (let i = 1; i < rr.length - 1; i++) {
                    sum = sum + parseInt(rr[i].getElementsByTagName("th")[rr[i].getElementsByTagName("th").length - 2].innerHTML);
                    sum2 = sum2 + parseInt(rr[i].getElementsByTagName("th")[rr[i].getElementsByTagName("th").length - 1].innerHTML);
                }
                document.getElementById("fireagirligi1").value = sum;

                document.getElementById("fireyuzde1").value = parseFloat((parseInt(document.getElementById("fireagirligi1").value) / sum2) * 100).toFixed(2) + " %";

            });
    }
    getPivot();
    getPivot2();

})

        function removeRow() {

            var table = document.getElementById("test");
            var rows = table.getElementsByTagName("tr");
                rows[1].getElementsByTagName("select")[0].removeAttribute("disabled");
            
            if (table.getElementsByTagName("tr").length > 2) {
               
                
                 table.deleteRow(table.getElementsByTagName("tr").length - 1);
                rownum--;
                selectindex--;
            }
        }
    </script>
    <script>
        var jsonObj = @Html.Raw(Json.Encode(ViewBag.UretimTakip));
        const seri = document.getElementById('seri');
        const genislik = document.getElementById('genislik');
        const genislikarti = document.getElementById('genislikalti');
        const kalinlik = document.getElementById('kalinlik');
        const agirlik = document.getElementById('agirlik');
        const marka = document.getElementById('marka');
        const adet = document.getElementById('adet');
        const kaplama = document.getElementById('kaplama');
        const stokAdi = document.getElementById('stokadi');
        const kalite = document.getElementById('kalite');
        const hamoran = document.getElementById('hamoran');

        const inputHandler = function (e) {

            //result.innerHTML = e.target.value;
            var b = jsonObj.find(x => x.SERI_NO === e.target.value);

            var top = 0;

            if (localStorage.list != "null" && localStorage.list!=null ) {
                var j = JSON.parse(localStorage.list);
                var son = j.filter(x => x.GIRDI1 == seri.value);
                if (son.length > 0) {
                    var s = [];
                    for (let i = 0; i < son.length; i++) {
                        if (!s.includes(son[i].HAMORAN)) {
                            s.push(son[i].HAMORAN)
                        }
                    }
                    if (s.length > 1) {
                        top = eval(s.join('+'));
                    } else {
                        top = s[0];
                    }


                }

            }

            hamoran.value = (1 - top).toFixed(4);
            ham.oninput = function () {
                if (this.value >= 1 - top) {
                    this.value = ((1 - top).toFixed(4)).toString();
                } else if (this.value < 0) {
                    this.value = 0;
                }
            };

            if (b != null) {
                kalinlik.value = b.KALINLIK;
                genislik.value = b.GENISLIK;
                agirlik.value = (b.MIKTAR * hamoran.value).toLocaleString('tr-TR') + " / " + (b.MIKTAR).toLocaleString('tr-TR');
                marka.innerHTML = b.MENSEI;
                adet.value = b.MIKTAR2;
                kaplama.value = b.KAPLAMA_KALINLIK;
                kalite.value = b.KALITE;
                stokAdi.value = b.STOK_ADI;
                metraj.value = parseFloat((parseInt(b.MIKTAR * hamoran.value)) / ((parseInt(b.GENISLIK) + parseInt(document.getElementById('genislikalti').value)) * parseFloat((b.KALINLIK).replace(",", ".")) * (0.00786))).toFixed(2) + " / " + parseFloat(parseInt((b.MIKTAR)) / ((parseInt(b.GENISLIK) + parseInt(document.getElementById('genislikalti').value)) * parseFloat((b.KALINLIK).replace(",", ".")) * (0.00786))).toFixed(2);

            } else {
                genislik.value = "";
                kalinlik.value = "";
                agirlik.value = "";
                marka.innerHTML = "";
                adet.value = "";
                kaplama.value = "";
                stokAdi.value = "";
                kalite.value = "";
            }



            if (top != 0) {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                if ((1 - top) == 0) {
                    Toast.fire({
                        icon: 'error',
                        title: 'Ürün kullanılabilir değil!'
                    });
                    document.getElementById("kaydet").disabled = true;
                } else {
                    Toast.fire({
                        icon: 'info',
                        title: 'Ürün maksimum %' + (((1 - top).toFixed(4)) * 100) + ' oranında kullanılabilir!'
                    });
                    if (document.getElementById("kaydet").disabled == true) {
                        document.getElementById("kaydet").disabled = false;
                    }

                }

            } else {
                if (document.getElementById("kaydet").disabled == true) {
                    document.getElementById("kaydet").disabled = false;
                }
            }


        }
        const inputHandler2 = function (e) {
            //result.innerHTML = e.target.value;

            if (seri.value != "") {
                var b = jsonObj.find(x => x.SERI_NO === seri.value);
                agirlik.value = (b.MIKTAR * hamoran.value).toLocaleString('tr-TR') + " / " + (b.MIKTAR).toLocaleString('tr-TR');
            }

            metraj.value = parseFloat(parseInt(((agirlik.value).split('/')[0].split('.')[0] + (agirlik.value).split('/')[0].split('.')[1])) / parseFloat((parseInt(genislik.value) + parseInt(e.target.value)) * parseFloat((kalinlik.value).replace(",", ".")) * (0.00786))).toFixed(2) + " / " + parseFloat(parseInt(((agirlik.value).split('/')[1].split('.')[0] + (agirlik.value).split('/')[1].split('.')[1])) / parseFloat((parseInt(genislik.value) + parseInt(e.target.value)) * parseFloat((kalinlik.value).replace(",", ".")) * (0.00786))).toFixed(2)


            var ta = document.getElementById("test");
            var ro = ta.getElementsByTagName("tr");

            for (let i = 1; i < ro.length; i++) {

                ro[i].getElementsByTagName("input")[3].onkeyup();
            }
            changeadet();

        }
        const inputHandler1 = function (e) {
            //result.innerHTML = e.target.value;
            if (seri.value != "") {
                var b = jsonObj.find(x => x.SERI_NO === seri.value);
                agirlik.value = (b.MIKTAR * hamoran.value).toLocaleString('tr-TR') + " / " + (b.MIKTAR).toLocaleString('tr-TR');
                metraj.value = parseFloat((parseInt(b.MIKTAR * hamoran.value)) / ((parseInt(b.GENISLIK) + parseInt(document.getElementById('genislikalti').value)) * parseFloat((b.KALINLIK).replace(",", ".")) * (0.00786))).toFixed(2) + " / " + parseFloat(parseInt((b.MIKTAR)) / ((parseInt(b.GENISLIK) + parseInt(document.getElementById('genislikalti').value)) * parseFloat((b.KALINLIK).replace(",", ".")) * (0.00786))).toFixed(2);

                changeadet();


            }



        }
        var oran1 = document.getElementById("oran1");
        hamoran.addEventListener('input', inputHandler1);
        hamoran.addEventListener('propertychange', inputHandler1);
        oran1.addEventListener('input', inputHandler1);
        oran1.addEventListener('propertychange', inputHandler1);

        seri.addEventListener('input', inputHandler);
        seri.addEventListener('propertychange', inputHandler);

        genislikarti.addEventListener('input', inputHandler2);
        genislikarti.addEventListener('propertychange', inputHandler2);


    </script>
    <script>
        function change(name) {

            var today = new Date();
            var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
            var b = jsonObj.find(x => x.MAK_KODU === name.substring(0, value));
            var x = "";
            if (b.MAX_ISEMRINO.toString().length == 1) {
                x = "0000" + b.MAX_ISEMRINO;
            } else if (b.MAX_ISEMRINO.toString().length == 2) {
                x = "000" + b.MAX_ISEMRINO;
            }
            else if (b.MAX_ISEMRINO.toString().length == 3) {
                x = "00" + b.MAX_ISEMRINO;
            }
            else if (b.MAX_ISEMRINO.toString().length == 4) {
                x = "0" + b.MAX_ISEMRINO;
            } else {
                x = "00000";
            }
            document.getElementById("ieno").value = name + today.getFullYear().toString().substring(2) + "."  + x;
        }


        function kaydet1() {
            if (x == 1) {
                var tab = document.getElementById("test");
                var c = document.getElementById("cid");

                var rows = tab.getElementsByTagName("tr");
                if (c.getElementsByClassName("row").length > 0) {
                    for (let i = 1; i < c.getElementsByClassName("row").length-1; i++) {

                        c.getElementsByClassName("row")[i].remove();

                    }
                }

                for (let i = 1; i < rows.length; i++) {

                    var row = document.createElement("div");
                    var col = document.createElement("div");
                    row.className = "row";
                    col.className = "col text-center";
                    var musteri = "";
                    var kalinlik = "";
                    var adet = "";
                    var agirlik = "";


                    kalinlik = document.getElementById("kalinlik").value;
                    musteri = rows[i].getElementsByTagName("input")[9].value;
                    agirlik = rows[i].getElementsByTagName("input")[8].value;
                    var label = document.createElement("label");
                    label.innerHTML = musteri;
                    col.appendChild(label);
                    row.appendChild(col);
                    var colkal = document.createElement("div");
                    colkal.className = "col text-center";
                    var labelkal = document.createElement("label");
                    labelkal.innerHTML = kalinlik;
                    colkal.appendChild(labelkal);

                    row.appendChild(colkal);
                    var col2 = document.createElement("div");
                    col2.className = "col text-center";

                    adet = rows[i].getElementsByTagName("input")[7].value;
                    var labelad = document.createElement("label");
                    labelad.innerHTML = adet;
                    col2.appendChild(labelad);
                    row.appendChild(col2);
                    var col3 = document.createElement("div");
                    col3.className = "col text-center";
                    var labelag = document.createElement("label");
                    labelag.innerHTML = agirlik;
                    col3.appendChild(labelag);
                    row.appendChild(col3);
                    c.appendChild(row);
                }
            }




        }

         function addCell() {

            var th = document.getElementById("th");
            var table = document.getElementById("test");

                var t = table.getElementsByTagName("tr");


            table.style = "border-spacing:10px";
            var cells = document.getElementById("th").getElementsByTagName("th").length;


             var bb = true;
             var bb1 = true;
             if (t.length > 0) {
                 for (let i = 1; i < t.length; i++) {
                     if (t[i].getElementsByTagName("input")[1].value == "") {
                         bb = false;
                         break;
                     }
                     if (t[i].getElementsByTagName("select")[1].value == "STOK SEÇİN") {
                         bb1 = false;
                         break;
                     }
                 }
             }

             if (x == 0) {
                 if (bb) {
                     if (bb1) {
                         for (let i = 0; i < t.length; i++) {
                             if (i == 0) {
                                 var cell = th.insertCell(cells - 2);
                                 cell.outerHTML = "<th style='background-color:white;border-bottom:hidden;border-top:hidden;width:1px'></th>";

                                 var cell3 = th.insertCell(cells - 2);
                                 cell3.outerHTML = "<th class='text-center p-1'>ADET</th>";

                                 var cell2 = th.insertCell(cells - 2);
                                 cell2.outerHTML = "<th class='text-center p-1'>STOK ÖLÇÜLERİ</th>";

                                 var cell = th.insertCell(cells - 2);
                                 cell.outerHTML = "<th class='text-center p-1'>MAKİNE" + (x + 1) + "</th>";

                                 var cell = th.insertCell(cells - 2);
                                 cell.outerHTML = "<th style='background-color:white;border-bottom:hidden;border-top:hidden;width:1px'></th>";
                             }
                             else {




                                 //t[i].getElementsByTagName("input")[3].removeAttribute("onkeyup");
                                 t[i].getElementsByTagName("input")[3].onkeyup = function (e) {
                                     var rows = table.getElementsByTagName("tr");
                                     var top = 0;

                                     for (let i = 1; i < rows.length; i++) {
                                         top = top + (parseInt(rows[i].getElementsByTagName("input")[2].value) * parseInt(rows[i].getElementsByTagName("input")[3].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value));
                                     }
                                      if ((rows[i].getElementsByTagName("input")[4].value != "") && (rows[i].getElementsByTagName("select")[3].value == "STOK SEÇİN")) {
                                            const Toast = Swal.mixin({
                                                toast: true,
                                                position: 'top-end',
                                                showConfirmButton: false,
                                                timer: 3000,
                                                timerProgressBar: true,
                                                didOpen: (toast) => {
                                                    toast.addEventListener('mouseenter', Swal.stopTimer)
                                                    toast.addEventListener('mouseleave', Swal.resumeTimer)
                                                }
                                            })

                                            Toast.fire({
                                                icon: 'info',
                                                title: 'Hesaplamaların doğru çalışabilmesi için Makine seçtiğiniz satırdaki Stok Ölçüsü alanını seçmeniz gerekmektedir!'
                                            });
                                        }
                                     var d = parseInt(((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) - top);
                                     document.getElementById("fireagir").value = d;
                                     if (d < 0) {

                                         const Toast = Swal.mixin({
                                             toast: true,
                                             position: 'top-end',
                                             showConfirmButton: false,
                                             timer: 3000,
                                             timerProgressBar: true,
                                             didOpen: (toast) => {
                                                 toast.addEventListener('mouseenter', Swal.stopTimer)
                                                 toast.addEventListener('mouseleave', Swal.resumeTimer)
                                             }
                                         })

                                         Toast.fire({
                                             icon: 'error',
                                             title: 'Fire eksi olamaz!'
                                         });

                                     }
                                     if (fireyuzde == 0) {
                                         document.getElementById("fireyuzde").value = parseFloat((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";
                                     } else {
                                         document.getElementById("fireyuzde").value = ((fireagirlik / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";

                                     }


                                     document.getElementById("fireagirligi").value = thousands_separators(((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2));

                                     t[i].getElementsByTagName("input")[6].value = thousands_separators(parseFloat((parseInt(t[i].getElementsByTagName("input")[3].value) * parseInt(t[i].getElementsByTagName("input")[2].value)) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(t[i].getElementsByTagName("input")[0].value)).toFixed(0));

                                     t[i].getElementsByTagName("select")[3].onchange();
                                 };
                                 var g1 = t[i].insertCell(cells - 2);
                                 g1.style = "border-bottom:hidden;border-top:hidden;width:1px";
                                 var g3 = t[i].insertCell(cells - 2);
                                 var inp = document.createElement("input");
                                 inp.className = "text-center border-0";
                                 inp.readOnly = true;
                                 g3.appendChild(inp);
                                 g3.display = "flex";
                                 g3.className = "text-center border-0 p-1";
                                 var g4 = t[i].insertCell(cells - 2);
                                 g4.className = "text-center p-1";
                                 var g2 = t[i].insertCell(cells - 2);

                                 var g = t[i].insertCell(cells - 2);
                                 g.style = "border-bottom:hidden;border-top:hidden;width:1px ";

                                 var input1 = document.createElement("input");
                                 var select = document.createElement("select");
                                 select.className = "selectmakina2 w-px-150";
                                 var option;
                                 var grup = document.getElementById("machinenames");
                                 option = document.createElement('option');
                                 option.innerHTML = "MAKİNE SEÇİN";
                                 option.selected = true;
                                 option.disabled = true;
                                 select.appendChild(option);
                                 for (let a = 0; a < grup.length; a++) {
                                     option = document.createElement('option');
                                     option.innerHTML = grup.options[a].text;
                                     option.value = grup.options[a].text;
                                     select.appendChild(option);

                                 }

                                 input1.className = "border-0 ms-1 text-center d-none";

                                 g2.appendChild(select);


                                 g2.appendChild(input1);
                                 g2.className = "text-center border-0 p-1";

                                 select.style = "width: 120px";
                                 select.onchange = function () {

                                     t[i].getElementsByTagName("input")[4].name = this.value + 2;
                                     t[i].getElementsByTagName("select")[3].disabled = false;
                                     var today = new Date();
                                     var jsonObj = @Html.Raw(Json.Encode(ViewBag.SIRANO));
                                     var b = jsonObj.find(x => x.MAK_KODU === this.value);
                                     var m = null;
                                     if (localStorage.list != null) {
                                         m = JSON.parse(localStorage.list);
                                     }


                                     var x = "";
                                     var deg = 0;
                                     var orta = 0;
                                     if (i == 1) {
                                         for (let a = t.length - 1; a > 0; a--) {
                                             if (t[a].getElementsByTagName("input")[1].name == this.value) {
                                                 orta = parseInt(t[a].getElementsByTagName("input")[1].value.split('.')[1]) + 1;
                                                 break;
                                             }
                                         }
                                         if (m != null) {
                                             var f = m.filter(x => x.REF_ISEMRINO.substring(0, 4) == this.value);
                                             if (f.length > 0) {
                                                 
                                                 orta = (parseInt(f[f.length - 1].REF_ISEMRINO.substring(6, 11))) + 1;
                                             }
                                         }
                                         if (orta != 0) {
                                             if (orta.toString().length == 1) {
                                                 x = ".0000" + orta + ".01";
                                             } else if (orta.toString().length == 2) {
                                                 x = ".000" + orta + ".01";
                                             }
                                             else if (orta.toString().length == 3) {
                                                 x = ".00" + orta + ".01";
                                             }
                                             else if (orta.toString().length == 4) {
                                                 x = ".0" + orta + ".01";
                                             } else {
                                                 x = ".00000";
                                             }
                                         }
                                         else {
                                             if (b.MAX_ISEMRINO.toString().length == 1) {
                                                 x = ".0000" + b.MAX_ISEMRINO + ".01";
                                             } else if (b.MAX_ISEMRINO.toString().length == 2) {
                                                 x = ".000" + b.MAX_ISEMRINO + ".01";
                                             }
                                             else if (b.MAX_ISEMRINO.toString().length == 3) {
                                                 x = ".00" + b.MAX_ISEMRINO + ".01";
                                             }
                                             else if (b.MAX_ISEMRINO.toString().length == 4) {
                                                 x = ".0" + b.MAX_ISEMRINO + ".01";
                                             } else {
                                                 x = ".00000";
                                             }
                                         }
                                         t[i].getElementsByTagName("input")[4].value = this.value + today.getFullYear().toString().substring(2) + x;
                                         t[i].getElementsByTagName("input")[4].name = this.value + 2;


                                         for (let a = i + 1; a < t.length; a++) {

                                             if (t[a].getElementsByTagName("select")[2].value != "MAKİNE SEÇİN") {
                                                 t[a].getElementsByTagName("select")[2].onchange();
                                             }


                                         }

                                     } else {
                                         for (let f = i - 1; f > 0; f--) {
                                             if (this.value + 2 == t[f].getElementsByTagName("input")[4].name) {
                                                 deg = parseInt(t[f].getElementsByTagName("input")[4].value.split('.')[2]) + 1;
                                                 break;
                                             }
                                         }
                                         for (let l = t.length - 1; l > 0; l--) {
                                             if (this.value == t[l].getElementsByTagName("input")[1].name) {
                                                 orta = parseInt(t[l].getElementsByTagName("input")[1].value.split('.')[1]) + 1;
                                                 break;
                                             }
                                         }
                                         if (t[i].getElementsByTagName("input")[4].name != "MAKİNE SEÇİN") {
                                             if (orta == 0) {
                                                 orta = parseInt(b.MAX_ISEMRINO);
                                             }


                                             if (deg != 0) {

                                                 if (orta.toString().length == 1) {
                                                     x = ".0000" + orta + ".0" + deg;
                                                 } else if (orta.toString().length == 2) {
                                                     x = ".000" + orta + ".0" + deg;
                                                 }
                                                 else if (orta.toString().length == 3) {
                                                     x = ".00" + orta + ".0" + deg;
                                                 }
                                                 else if (orta.toString().length == 4) {
                                                     x = ".0" + orta + ".0" + deg;
                                                 } else {
                                                     x = ".00000";
                                                 }
                                             } else {
                                                 if (orta.toString().length == 1) {
                                                     x = ".0000" + orta + ".01";
                                                 } else if (orta.toString().length == 2) {
                                                     x = ".000" + orta + ".01";
                                                 }
                                                 else if (orta.toString().length == 3) {
                                                     x = ".00" + orta + ".01";
                                                 }
                                                 else if (orta.toString().length == 4) {
                                                     x = ".0" + orta + ".01";
                                                 } else {
                                                     x = ".00000";
                                                 }
                                             }


                                             t[i].getElementsByTagName("input")[4].value = this.value + today.getFullYear().toString().substring(2) + x;
                                             t[i].getElementsByTagName("input")[4].name = this.value + 2;


                                             for (let a = i + 1; a < t.length; a++) {

                                                 if (t[a].getElementsByTagName("select")[2].value != "MAKİNE SEÇİN") {
                                                     t[a].getElementsByTagName("select")[2].onchange();
                                                 }


                                             }




                                         }
                                     }



                                 }
                                 var jsonObj = @Html.Raw(Json.Encode(ViewBag.Stok_Adlari));
                                 var sl = document.createElement("select");
                                 sl.className = "js-example-basic-single";
                                 sl.style = "width: 120px";
                                 sl.onchange = function () {
                                     var ss = t[i].getElementsByTagName("select")[4];
                                     ss.replaceChildren();
                                     var obj = @Html.Raw(Json.Encode(ViewBag.Cariler));
                                     var filt = obj.filter(x => x.STOK_ADI === this.value);
                                     var filt1 = filt1 = filt.filter(x => x.FISNO === (ss.name).split(" ")[1]);


                                     if (filt1.length > 0) {

                                         var op = document.createElement("option");
                                         op.innerHTML = "EFECE GALVANİZ";
                                         op.selected = true;
                                         op.disabled = true;
                                         ss.appendChild(op);
                                         if (filt.length > 0) {
                                             for (let i = 0; i < filt.length; i++) {
                                                 var op = document.createElement("option");
                                                 op.innerHTML = filt[i].CARI_ISIM + " *" + filt[i].FISNO + "* SIPKONT:" + filt[i].SIPKONT;

                                                 op.value = filt[i].CARI_ISIM;

                                                 ss.appendChild(op);
                                                 if (filt[i].FISNO == filt1[0].FISNO) {
                                                     op.selected = true;
                                                 }

                                                 ss.onchange = function () {
                                                     ss.name = ss.options[ss.selectedIndex].text.split("SIPKONT:")[1] + " " + ss.options[ss.selectedIndex].text.split("*")[1];
                                                 }
                                             }

                                         }
                                     } else {

                                         var op = document.createElement("option");
                                         op.innerHTML = "EFECE GALVANİZ";
                                         op.selected = true;
                                         op.disabled = true;
                                         ss.appendChild(op);
                                         if (filt.length > 0) {
                                             for (let i = 0; i < filt.length; i++) {
                                                 op = document.createElement("option");
                                                 op.innerHTML = filt[i].CARI_ISIM + " *" + filt[i].FISNO + "* SIPKONT:" + filt[i].SIPKONT;
                                                 if (ss.value == filt[i].CARI_ISIM) {
                                                     op.selected = true;
                                                 }
                                                 op.value = filt[i].CARI_ISIM;

                                                 ss.appendChild(op);
                                                 ss.onchange = function () {
                                                     ss.name = ss.options[ss.selectedIndex].text.split("SIPKONT:")[1] + " " + ss.options[ss.selectedIndex].text.split("*")[1];
                                                 }
                                             }

                                         }
                                     }



                                     $(document).ready(function () {
                                         $('.selectcari' + g4.parentNode.rowIndex).select2({
                                             tags: true
                                         }
                                         );
                                     });
                                     var oo = jsonObj.find(x => x.STOK_ADI == this.value);
                                     var m = document.getElementById("metraj").value;
                                     var adt = t[i].getElementsByTagName("input")[3].value;
                                     var upt = m.split('/')[0];
                                     var o = parseFloat(t[i].getElementsByTagName("input")[0].value);
                                     t[i].getElementsByTagName("input")[5].value = Math.round(((parseFloat(upt) * parseFloat(adt)) / (oo.BOY / 1000))*o);

                                 }
                                 sl.name = "state";
                                 var op = document.createElement("option");
                                 op.innerHTML = "STOK SEÇİN";
                                 op.selected = true;
                                 op.disabled = true;
                                 sl.appendChild(op);
                                 for (let i = 0; i < jsonObj.length; i++) {
                                     op = document.createElement("option");
                                     op.innerHTML = jsonObj[i].STOK_ADI;
                                     op.value = jsonObj[i].STOK_ADI;
                                     sl.appendChild(op);

                                 }
                                 sl.disabled = true;



                                 g4.appendChild(sl);








                                 t[i].getElementsByTagName("select")[4].replaceChildren();
                                 var opt1 = document.createElement("option");
                                 opt1.innerHTML = "EFECE GALVANİZ";
                                 opt1.disabled = true;
                                 opt1.selected = true;
                                 t[i].getElementsByTagName("select")[4].appendChild(opt1);


                             }


                         }
                         $(document).ready(function () {
                             $('.selectmakina2').select2();
                             $('.js-example-basic-single').select2();

                         });
                         x++;
                         sag++;
                     }
                     else {
                         const Toast = Swal.mixin({
                             toast: true,
                             position: 'top-end',
                             showConfirmButton: false,
                             timer: 3000,
                             timerProgressBar: true,
                             didOpen: (toast) => {
                                 toast.addEventListener('mouseenter', Swal.stopTimer)
                                 toast.addEventListener('mouseleave', Swal.resumeTimer)
                             }
                         })

                         Toast.fire({
                             icon: 'error',
                             title: 'Stok ölçüsü seçmediniz!'
                         })
                     }


                 }
                 else {
                     const Toast = Swal.mixin({
                         toast: true,
                         position: 'top-end',
                         showConfirmButton: false,
                         timer: 3000,
                         timerProgressBar: true,
                         didOpen: (toast) => {
                             toast.addEventListener('mouseenter', Swal.stopTimer)
                             toast.addEventListener('mouseleave', Swal.resumeTimer)
                         }
                     })

                     Toast.fire({
                         icon: 'error',
                         title: 'Makine seçmediniz!'
                     })
                 }
             }
             else {
                 const Toast = Swal.mixin({
                     toast: true,
                     position: 'top-end',
                     showConfirmButton: false,
                     timer: 3000,
                     timerProgressBar: true,
                     didOpen: (toast) => {
                         toast.addEventListener('mouseenter', Swal.stopTimer)
                         toast.addEventListener('mouseleave', Swal.resumeTimer)
                     }
                 })

                 Toast.fire({
                     icon: 'info',
                     title: 'En çok 1 defa açılabilir!'
                 })
            }










        }


        function removeCell() {
            var th = document.getElementById("th");
            var table = document.getElementById("test");
            var inr = table.getElementsByTagName("tr").length;
            var thcells = th.getElementsByTagName("th").length;
            var t = table.getElementsByTagName("tr");
            document.getElementById("3input").onkeyup=null;
            document.getElementById("3input").onkeyup = function () {
                var top1 = 0;
                var rows = document.getElementById("test").getElementsByTagName("tr");
                for (let i = 1; i < rows.length; i++) {
                    if (rows[i].getElementsByTagName("input")[3].value != "") {
                        top1 = top1 + (parseInt(rows[i].getElementsByTagName("input")[2].value) * parseInt(rows[i].getElementsByTagName("input")[3].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value));
                    }
                    if (x > 0) {
                        rows[i].getElementsByTagName("select")[3].onchange();
                    }

                }
                var d = parseInt(((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) - top1);
                document.getElementById("fireagir").value = d;
                if (d < 0) {
                    const Toast = Swal.mixin({
                        toast: true,
                        position: 'top-end',
                        showConfirmButton: false,
                        timer: 3000,
                        timerProgressBar: true,
                        didOpen: (toast) => {
                            toast.addEventListener('mouseenter', Swal.stopTimer)
                            toast.addEventListener('mouseleave', Swal.resumeTimer)
                        }
                    })

                    Toast.fire({
                        icon: 'error',
                        title: 'Fire eksi olamaz!'
                    });
                }

                document.getElementById("agirlikhesap").value = thousands_separators(Math.round(parseFloat((parseInt(document.getElementById("2input").value) * parseInt(document.getElementById("3input").value)) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(document.getElementById("oran1").value)).toFixed(2)));


                document.getElementById("fireyuzde").value = parseFloat((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";

                document.getElementById("fireagirligi").value = thousands_separators(((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2));
            }
            for (let a = 1; a < inr; a++) {

                if (x == 2) {

                    table.getElementsByTagName("tr")[a].deleteCell(10);
                    table.getElementsByTagName("tr")[a].deleteCell(10);
                    table.getElementsByTagName("tr")[a].deleteCell(10);
                    table.getElementsByTagName("tr")[a].deleteCell(10);

                } else if (x == 1) {

                    table.getElementsByTagName("tr")[a].deleteCell(6);
                    table.getElementsByTagName("tr")[a].deleteCell(6);
                    table.getElementsByTagName("tr")[a].deleteCell(6);
                    table.getElementsByTagName("tr")[a].deleteCell(6);
                    table.getElementsByTagName("tr")[a].deleteCell(6);

                }

            }
            if (x == 1) {
                th.deleteCell(6);
                th.deleteCell(6);
                th.deleteCell(6);
                th.deleteCell(6);
                th.deleteCell(6);
                x--;
                sag--;
            } else if (x == 2) {
                th.deleteCell(10);
                th.deleteCell(10);
                th.deleteCell(10);
                th.deleteCell(10);
                x--;
                sag--;
            }
            for (let i = 1; i <= inr; i++) {
                t[i].getElementsByTagName("input")[4].removeAttribute("onkeyup");
                t[i].getElementsByTagName("input")[4].onkeyup = function k(e) {
                    var rows = table.getElementsByTagName("tr");
                    var top = 0;

                    for (let i = 1; i < rows.length; i++) {
                        top = top + (parseInt(rows[i].getElementsByTagName("input")[3].value) * parseInt(rows[i].getElementsByTagName("input")[4].value) * parseFloat(rows[i].getElementsByTagName("input")[0].value));
                    }
                    var d = parseInt(((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) - top);
                    document.getElementById("fireagir").value = d;
                    if (d < 0) {
                        const Toast = Swal.mixin({
                            toast: true,
                            position: 'top-end',
                            showConfirmButton: false,
                            timer: 3000,
                            timerProgressBar: true,
                            didOpen: (toast) => {
                                toast.addEventListener('mouseenter', Swal.stopTimer)
                                toast.addEventListener('mouseleave', Swal.resumeTimer)
                            }
                        })

                        Toast.fire({
                            icon: 'error',
                            title: 'Fire eksi olamaz!'
                        });
                    }
                    if (fireyuzde == 0) {
                        document.getElementById("fireyuzde").value = parseFloat((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";
                    } else {
                        document.getElementById("fireyuzde").value = ((fireagirlik / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * 100).toFixed(2) + " %";

                    }


                    document.getElementById("fireagirligi").value = thousands_separators(((parseFloat(document.getElementById("fireagir").value) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value)))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1]))).toFixed(2));

                    t[i].getElementsByTagName("input")[5].value = thousands_separators(parseFloat((parseInt(t[i].getElementsByTagName("input")[4].value) * parseInt(t[i].getElementsByTagName("input")[3].value)) / ((parseInt(document.getElementById("genislik").value)) + (parseInt(document.getElementById("genislikalti").value))) * (parseInt(document.getElementById("agirlik").value.split('/')[0].split('.')[0] + document.getElementById("agirlik").value.split('/')[0].split('.')[1])) * parseFloat(t[i].getElementsByTagName("input")[0].value)).toFixed(0));


                };
                function thousands_separators(num) {
                    var num_parts = num.toString().split(".");
                    num_parts[0] = num_parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                    return num_parts.join(",");
                }
            }




        }
        $(document).ready(function () {
            if ($(window).width() < 600) {
                $("#divPartial2").show();
            }
            else {
                $("#divPartial").show();
            }
            $('.js-example-basic-single').select2({
                tags: true
            }
            );
            $("#progress").hide();
        });
        $(document).ready(function () {
            $('.select2-single1').select2({
                tags: true
            }
            );
        });

    </script>

    <div class="layout-overlay layout-menu-toggle"></div>

</body>

</html>






