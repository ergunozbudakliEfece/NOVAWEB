
@{
    ViewBag.Title = "MusteriRaporu";
    Layout = "~/Views/Shared/_Layout_musteri_raporu.cshtml";
}

<link href="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<style>
    .menu1 {
        display: none;
    }
    @@media screen and (max-width: 600px) {

        .menu1 {
            display: inline-flex;
        }
        .menu2 {
            display: none;
        }
    }
</style>

<div class="container-fluid">

    <div class="card">
        <div class="card-header">
            <div class="btn-group menu1">
                <button type="button" class="btn btn-primary btn-icon rounded-pill dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bx bx-dots-vertical-rounded"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" style="">
                    <li><a class="dropdown-item" onclick="change(1)">Tüm Müşteriler</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" onclick="change(2)">Planlanan</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" onclick="change(3)">Gerçekleşen</a></li>

                </ul>
            </div>

            <div class="btn-group menu2" role="group" aria-label="Basic radio toggle button group">
                <input type="radio" class="btn-check" onclick="change(1)" name="btnradio" id="btnradio1" checked="" autocomplete="off">
                <label class="btn btn-outline-primary" for="btnradio1">Tüm Müşteriler</label>
                <input type="radio" class="btn-check" onclick="change(2)" name="btnradio" id="btnradio2" autocomplete="off">
                <label class="btn btn-outline-primary" for="btnradio2">Planlanan</label>
                <input type="radio" class="btn-check" onclick="change(3)" name="btnradio" id="btnradio3" autocomplete="off">
                <label class="btn btn-outline-primary" for="btnradio3">Gerçekleşen</label>

            </div>
        </div>
        <div class="card-body" id="bdy1">


            <div id="employeeTableWrapper" class="tableWrapper table-responsive">
                <table id="table"
                       class="table table-striped"
                       data-pagination="true"
                       data-show-toggle="true"
                       data-search="true"
                       data-toolbar="#toolbar"
                       data-show-columns="true"
                       data-show-columns-toggle-all="true"
                       data-locale="tr-TR">
                    <thead>
                        <tr>
                            <th data-field="MUSTERI_ADI" data-sortable="true">Müşteri Adı</th>
                            <th data-field="MUSTERI_ADRES" data-sortable="true" data-formatter="adresFormatter">Müşteri Adres</th>
                            <th data-field="MUSTERI_TEL1" data-sortable="true" data-formatter="telFormatter">Müşteri Telefon</th>
                            <th data-field="MUSTERI_MAIL" data-sortable="true">Müşteri Mail</th>
                            <th data-field="MUSTERI_SEKTOR" data-sortable="true">Müşteri Sektör</th>
                            <th data-field="MUSTERI_NITELIK" data-sortable="true">Müşteri Nitelik</th>
                            <th data-field="MUSTERI_NOTU" data-sortable="true">Müşteri Notu</th>
                            <th data-field="PLASIYER" data-sortable="true">Plasiyer</th>
                            <th data-field="KAYIT_TARIHI" data-sortable="true" data-formatter="teslimFormatter">Kayıt Tarihi</th>
                        </tr>
                    </thead>
                </table>
              

            </div>



        </div>
        <div class="card-body" id="bdy2">


            <div id="employeeTableWrapper1" class="tableWrapper table-responsive">
                
                <table id="table2"
                       class="table table-striped"
                       data-pagination="true"
                       data-show-toggle="true"
                       data-search="true"
                       data-toolbar="#toolbar"
                       data-show-columns="true"
                       data-show-columns-toggle-all="true"
                       data-locale="tr-TR">
                    <thead>
                        <tr>
                            <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                            <th data-field="PLANLANAN_TARIH" data-sortable="true" data-formatter="planlananFormatter">Planlanan Tarih</th>

                        </tr>
                    </thead>
                </table>

            </div>



        </div>
        <div class="card-body" id="bdy3">


            <div id="employeeTableWrapper2" class="tableWrapper table-responsive">
                <table id="table3"
                       class="table table-striped"
                       data-pagination="true"
                       data-show-toggle="true"
                       data-search="true"
                       data-toolbar="#toolbar"
                       data-show-columns="true"
                       data-show-columns-toggle-all="true"
                       data-locale="tr-TR">
                    <thead>
                        <tr>
                            <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                            <th data-field="PLANLANAN_TARIH" data-sortable="true" data-formatter="planlananFormatter">Planlanan Tarih</th>
                            <th data-field="GERCEKLESEN_TARIH" data-sortable="true" data-formatter="gerceklesenFormatter">Gerçekleşen Tarih</th>
                        </tr>
                    </thead>
                </table>
                

            </div>



        </div>
        <script>
            $(document).ready(function () {
                $('#bdy2').hide();
                $('#bdy3').hide();
                })
            var r = null;
            var r2 = null;
            var username = null;
            var userid = null;
                function change(value) {
                    if (value == 1) {
                        $('#bdy2').hide();
                        $('#bdy3').hide();
                        $('#bdy1').show();
                    } else if (value == 2) {
                        $('#bdy1').hide();
                        $('#bdy2').show();
                        $('#bdy3').hide();
                    } else {
                        $('#bdy1').hide();
                        $('#bdy2').hide();
                        $('#bdy3').show();
                    }
                }
                $.getJSON('@Url.Action("GetMusteriler","Satis")', function (data) {


                }).done(function (result) {

                    var $table = $('#table');
                    username =@Html.Raw(Json.Encode(Request.Cookies["UserName"].Value));
                    userid=@Html.Raw(Json.Encode(Request.Cookies["Id"].Value));
                    $(function () {
                        r = result;
                        $table.bootstrapTable({ data: JSON.parse(r).filter(x => x.PLASIYER == username)  })
                    })
                })
            $.getJSON('@Url.Action("GetRandevu", "Satis")', function (data) {


                }).done(function (result) {

                    var $table2 = $('#table2');
                    var $table3 = $('#table3');
                    $(function () {
                        r2 = result;
                        var sor1 = JSON.parse(r2).filter(x => x.KAYIT_YAPAN_KULLANICI_ID == parseInt(userid) && x.GERCEKLESEN_TARIH == null);
                       
                        if (sor1 != null) {
                            $table2.bootstrapTable({ data: sor1 })
                        }
                        var sor2 = JSON.parse(r2).filter(x => x.KAYIT_YAPAN_KULLANICI_ID == parseInt(userid) && x.GERCEKLESEN_TARIH != null);
                        if (sor2 != null) {
                            $table3.bootstrapTable({ data: sor2 })
                        }
                        
                    })
                })

            function teslimFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var newdate = day + "/" + month + "/" + year;
                return newdate;
            }
            function adresFormatter(value, row, index) {
               
                return row.MUSTERI_IL + ", " + row.MUSTERI_ILCE + ", " + row.MUSTERI_MAHALLE + ", " + value;
            }
            function telFormatter(value, row, index) {

                return value+", "+row.MUSTERI_TEL2;
            }
            function planlananFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var newdate = day + "/" + month + "/" + year;
                return newdate;
            }
            function gerceklesenFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var newdate = day + "/" + month + "/" + year;
                return newdate;
            }
            function musteriadiFormatter(value, row, index) {
                
                return JSON.parse(r).filter(x => x.MUSTERI_ID == value)[0].MUSTERI_ADI;
            }
        </script>
    </div>
</div>




