

<script src="~/Scripts/jquery-3.6.1.min.js"></script>
<script src="~/Scripts/bootstrap.bundle.min.js"></script>
<link href="\assets\boxicons-2.1.2\css\boxicons.css" rel="stylesheet" type="text/css" />
<link href="\assets\boxicons-2.1.2\css\animations.css" rel="stylesheet" type="text/css" />
<link href="\assets\boxicons-2.1.2\css\transformations.css" rel="stylesheet" type="text/css" />

<!-- Core CSS -->
<link rel="stylesheet" type="text/css" href="\assets\vendor\css\core.css" class="template-customizer-core-css" />
<link rel="stylesheet" type="text/css" href="\assets\vendor\css\theme-default.css" class="template-customizer-theme-css" />
<link rel="stylesheet" type="text/css" href="\assets\css\demo.css" />

<!-- Vendors CSS -->
<link rel="stylesheet" type="text/css" href="\assets\vendor\libs\perfect-scrollbar\perfect-scrollbar.css" />

<link rel="stylesheet" type="text/css" href="\assets\vendor\libs/apex-charts/apex-charts.css" />

<!-- Page CSS -->
<!-- Helpers -->
<script type="text/javascript" src="\assets\vendor\js\helpers.js"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script type="text/javascript" src="\assets\js\config.js"></script>
<script src="/Scripts/jquery.validate.js" type='text/javascript'></script>
<script src="/Scripts/jquery.validate.unobtrusive.js" type='text/javascript'></script>
<link href="~/Content/bootstrap-table-master/dist/bootstrap-table.min.css" rel="stylesheet" />
<link href="~/bootstrap-icons-1.11.2/font/bootstrap-icons.css" rel="stylesheet" />
<link href="~/Scripts/select2.css" rel="stylesheet" />
<script src="~/Scripts/select2.min.js"></script>
<script src="~/Content/bootstrap-table-master/dist/extensions/export/bootstrap-table-export.min.js"></script>
<script src="~/Content/bootstrap-table-master/dist/bootstrap-table.min.js"></script>
<script src="~/Content/bootstrap-table-master/dist/bootstrap-table-locale-all.min.js"></script>
<script src="~/Content/bootstrap-table-master/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>
<script src="~/Content/bootstrap-table-master/dist/extensions/mobile/bootstrap-table-mobile.min.js"></script>
<style>
    .centercontent {
        position: absolute;
        max-width: 100%;
        height: auto;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 5;
    }

    .menu1 {
        display: none;
    }

    .card-view {
        border-bottom: 1px dashed gray;
        margin-top: 2px;
    }


    .card-view-value {
        margin-left: 5px;
        white-space: normal;
    }

    .card-view-title {
        border-right: 1px dashed gray;
    }

    #employeeTableWrapper2 .card-view-title, #employeeTableWrapper1 .card-view-title {
        border-right: 1px dashed gray;
        white-space: nowrap;
        min-width: 50% !important;
    }

    @@media screen and (max-width: 600px) {
        .menu1 {
            display: inline-flex;
        }

        .menu2 {
            display: none;
        }
    }
</style>

<body style="background-color:white;">

    <div class="container-fluid">

        <div class="btn-group menu1">
            <button type="button" class="btn btn-primary btn-icon rounded-pill dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="bx bx-dots-vertical-rounded"></i>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" style="">
                <li><a class="dropdown-item" onclick="change(1)">Tüm Müşteriler</a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" onclick="change(2)">Planlanan</a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" onclick="change(3)">Gerçekleşen</a></li>
                <li>
                    <hr class="dropdown-divider">
                </li>
                <li><a class="dropdown-item" onclick="change(4)">Ürünler</a></li>
            </ul>
        </div>

        <div class="btn-group menu2" role="group" aria-label="Basic radio toggle button group">
            <input type="radio" class="btn-check" onclick="change(1)" name="btnradio" id="btnradio1" checked="" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnradio1">Tüm Müşteriler</label>
            <input type="radio" class="btn-check" onclick="change(2)" name="btnradio" id="btnradio2" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnradio2">Planlanan</label>
            <input type="radio" class="btn-check" onclick="change(3)" name="btnradio" id="btnradio3" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnradio3">Gerçekleşen</label>
            <input type="radio" class="btn-check" onclick="change(4)" name="btnradio" id="btnradio4" autocomplete="off">
            <label class="btn btn-outline-primary" for="btnradio4">Ürünler</label>
        </div>




        <div id="employeeTableWrapper" class="tableWrapper table-responsive">
            <table id="table"
                   class="table table-striped"
                   data-pagination="true"
                   data-search="true"
                   data-show-columns="true"
                   data-show-columns-toggle-all="true"
                   data-locale="tr-TR"
                   data-mobile-responsive="true"
                   data-page-size="5">
                <thead>
                    <tr>
                        <th data-field="MUSTERI_ADI" data-sortable="true">Müşteri Adı</th>
                        <th data-field="MUSTERI_ADRES" data-sortable="true" data-formatter="adresFormatter">Müşteri Adres</th>
                        <th data-field="MUSTERI_TEL1" data-sortable="true" data-formatter="telFormatter">Müşteri Telefon</th>
                        <th data-field="MUSTERI_MAIL" data-sortable="true">Müşteri Mail</th>
                        <th data-field="MUSTERI_SEKTOR" data-sortable="true">Müşteri Sektör</th>
                        <th data-field="MUSTERI_NITELIK" data-sortable="true">Müşteri Nitelik</th>
                        <th data-field="MUSTERI_NOTU" data-sortable="true">Müşteri Notu</th>
                        <th data-field="PLASIYER" data-sortable="true">Plasiyer</th>
                        <th data-field="KAYIT_TARIHI" data-sortable="true" data-formatter="teslimFormatter">Kayıt Tarihi</th>
                    </tr>
                </thead>
            </table>


        </div>






        <div id="employeeTableWrapper1" class="tableWrapper table-responsive">

            <table id="table2"
                   class="table table-striped"
                   data-pagination="true"
                   data-search="true"
                   data-show-columns="true"
                   data-show-columns-toggle-all="true"
                   data-locale="tr-TR"
                   data-mobile-responsive="true"
                   data-page-size="5">
                <thead>
                    <tr>
                        <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                        <th data-field="PLANLANAN_TARIH" data-sortable="true" data-formatter="planlananFormatter">Planlanan Tarih</th>
                        <th data-field="RANDEVU_NOTU" data-sortable="true" data-formatter="notFormatter">Ziyaret Notu</th>

                    </tr>
                </thead>
            </table>

        </div>






        <div id="employeeTableWrapper2" class="tableWrapper table-responsive">
            <table id="table3"
                   class="table table-striped"
                   data-pagination="true"
                   data-search="true"
                   data-show-columns="true"
                   data-show-columns-toggle-all="true"
                   data-locale="tr-TR"
                   data-mobile-responsive="true"
                   data-page-size="5">
                <thead>
                    <tr>
                        <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                        <th data-field="PLANLANAN_TARIH" data-sortable="true" data-formatter="planlananFormatter">Planlanan Tarih</th>
                        <th data-field="GERCEKLESEN_TARIH" data-sortable="true" data-formatter="gerceklesenFormatter">Gerçekleşen Tarih</th>
                        <th data-field="RANDEVU_NOTU" data-sortable="true" data-formatter="notFormatter">Ziyaret Notu</th>
                    </tr>
                </thead>
            </table>


        </div>

        <div id="employeeTableWrapper3" class="tableWrapper table-responsive">
            <table id="table4"
                   class="table table-striped"
                   data-pagination="true"
                   data-buttons-order="['paginationSwitch', 'columns', 'filterTable']"
                   data-search="true"
                   data-show-columns="true"
                   data-export-data-type="all"
                   data-export-types="['excel']"
                   data-show-export="true"
                   data-locale="tr-TR"
                   data-mobile-responsive="true">
                <thead>
                    <tr>
                        <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                        <th data-field="URUN_GRUBU" data-sortable="true">Ürün Grubu</th>
                        <th data-field="YILLIK_KULLANIM" data-sortable="true">Yıllık Kullanım</th>
                        <th data-field="OLCU_BIRIMI" data-sortable="true">Ölçü Birimi</th>
                        <th data-field="KAYIT_YAPAN_KULLANICI" data-formatter="plasiyerFormatter1">PLASIYER</th>
                    </tr>
                </thead>
            </table>


        </div>


        <script>
        var r = null;
        var r2 = null;
        var username = null;
        var userid = null;
        var user=null
         async function getUrunlerAsync() {
                let response = await fetch(`@Url.Action("GetMusteriUrun", "Satis")`);
                let data = await response.json()
                return data;
        }
         async function getUserAsync() {
                let response = await fetch(`@Url.Action("GetUser", "Satis")`);
                let data = await response.json()
                return data;
            }
            $(document).ready(function () {
                $('#employeeTableWrapper1').hide();
                $('#employeeTableWrapper2').hide();
                $('#employeeTableWrapper3').hide();
                })
        getUserAsync().then(function (data) {
            user = JSON.parse(data);
        })
                 function change(value) {
                    if (value == 1) {
                        $('#employeeTableWrapper3').hide();
                        $('#employeeTableWrapper1').hide();
                        $('#employeeTableWrapper2').hide();
                        $('#employeeTableWrapper').show();
                        getMusterilerAsync().then(function (data) {
                            var musteriler = JSON.parse(data);

                            $('#table').bootstrapTable({ data: musteriler });
                        })
                    } else if (value == 2) {
                        $('#employeeTableWrapper').hide();
                        $('#employeeTableWrapper1').show();

                        $('#employeeTableWrapper2').hide();
                        $('#employeeTableWrapper3').hide();
                        getRandevuAsync().then(function (data) {
                            var randevular = JSON.parse(data).filter(x => x.GERCEKLESEN_TARIH == null);

                            $('#table2').bootstrapTable({ data: randevular });
                        })
                    } else if (value == 3) {
                        $('#employeeTableWrapper').hide();
                        $('#employeeTableWrapper1').hide();
                        $('#employeeTableWrapper2').show();
                        $('#employeeTableWrapper3').hide();
                        var sor2 = null;
                        $.getJSON('@Url.Action("GetRandevu", "Satis")', function (data) {


                        }).done(function (result) {


                            $(function () {


                                sor2 = JSON.parse(result).filter(x => x.GERCEKLESEN_TARIH != null&&x.KAYIT_YAPAN_KULLANICI_ID==@Html.Raw(Json.Encode(Request.Cookies["Id"].Value)));
                                $('#table3').bootstrapTable({ data: sor2 })

                            })
                        })
                    } else {
                        $('#employeeTableWrapper').hide();
                        $('#employeeTableWrapper1').hide();
                        getUrunlerAsync().then(function (data) {
                            var urunler = JSON.parse(data).filter(x => x.KAYIT_YAPAN_KULLANICI==@Html.Raw(Json.Encode(Request.Cookies["UserName"].Value)));

                            $('#table4').bootstrapTable({ data: urunler });
                        })
                        $('#employeeTableWrapper2').hide();
                        $('#employeeTableWrapper3').show();
                    }
                }
                $.getJSON('@Url.Action("GetMusteriler","Satis")', function (data) {


                }).done(function (result) {

                    var $table = $('#table');
                    username =@Html.Raw(Json.Encode(Request.Cookies["UserName"].Value));
                    userid=@Html.Raw(Json.Encode(Request.Cookies["Id"].Value));
                    $(function () {
                        r = result;
                        $table.bootstrapTable({ data: JSON.parse(r).filter(x => x.PLASIYER == username)  })
                    })
                     $.getJSON('@Url.Action("GetRandevu", "Satis")', function (data) {


                }).done(function (result) {

                    var $table2 = $('#table2');
                    var $table3 = $('#table3');
                    $(function () {
                        r2 = result;
                        var sor1 = JSON.parse(r2).filter(x => x.KAYIT_YAPAN_KULLANICI_ID == parseInt(userid) && x.GERCEKLESEN_TARIH == null);

                        if (sor1 != null) {
                            $table2.bootstrapTable({ data: sor1 })
                        }
                        var sor2 = JSON.parse(r2).filter(x => x.KAYIT_YAPAN_KULLANICI_ID == parseInt(userid) && x.GERCEKLESEN_TARIH != null);
                        if (sor2 != null) {
                            $table3.bootstrapTable({ data: sor2 })
                        }

                    })
                })
                })
        function notFormatter(value, row, index) {

            if (value == null) {
                value = "";
            }
            return "<textarea cols='17' disabled>" + value + "</textarea>";
        }
        function plasiyerFormatter1(value, row, index) {
            if (value == null) {
                return "";
            }

            var a = user.filter(x => x.USER_NAME == value);
            var y = a[0].USER_FIRSTNAME + " " + a[0].USER_LASTNAME;

            return y;


        }
            function teslimFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var newdate = day + "/" + month + "/" + year;
                return newdate;
            }
            function adresFormatter(value, row, index) {

                return row.MUSTERI_IL + ", " + row.MUSTERI_ILCE + ", " + row.MUSTERI_MAHALLE + ", " + value;
            }
            function telFormatter(value, row, index) {
                var tel1 = value;
                var tel2 = row.MUSTERI_TEL2;
                var sum = "";
                if (tel1 != null && tel2 != null) {
                    sum = tel1 + ", " + tel2;
                } else if (tel1 == null && tel2 != null) {
                    sum = tel2;
                } else if (tel1 != null && tel2 == null) {
                    sum = tel1;
                }
                if (sum == "") {
                    sum = "-";
                }
                return sum;
            }
            function planlananFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var saat = value.split('T')[1].substring(0, 5);
                var newdate = day + "/" + month + "/" + year + " " + saat;
                return newdate;
            }
            function gerceklesenFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var saat = value.split('T')[1].substring(0, 5);
                var newdate = day + "/" + month + "/" + year + " " + saat;
                return newdate;
            }
            function musteriadiFormatter(value, row, index) {

                return JSON.parse(r).filter(x => x.MUSTERI_ID == value)[0].MUSTERI_ADI;
            }
        </script>
    </div>
</body>





