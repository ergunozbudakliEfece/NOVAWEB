
@{
    ViewBag.Title = "MusteriRaporuOzel";
    Layout = "~/Views/Shared/_Layout_musteri_raporu_ozel.cshtml";
}

<link href="https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">

<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<link href="https://unpkg.com/bootstrap-table@1.21.2/dist/extensions/sticky-header/bootstrap-table-sticky-header.css" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
<script src="https://unpkg.com/bootstrap-table@1.21.2/dist/extensions/sticky-header/bootstrap-table-sticky-header.min.js"></script>
<style>
   
    
    .menu1 {
        display: none;
    }
    .card-view {
        border-bottom: 1px dashed gray;
        margin-top: 2px;
    }


    .card-view-value {
        margin-left: 5px;
        white-space: normal;
    }
    .card-view-title {
        border-right: 1px dashed gray;
    }
    #bdy3 .card-view-title, #bdy2 .card-view-title {
        border-right: 1px dashed gray;
        white-space: nowrap;
        min-width: 50% !important;
    }
    @@media screen and (max-width: 600px) {
        .menu1 {
            display: inline-flex;
        }

        .menu2 {
            display: none;
        }
    }
</style>

<div class="container-fluid">

    <div class="card">
        <div class="card-header">
            <div class="btn-group menu1">
                <button type="button" class="btn btn-primary btn-icon rounded-pill dropdown-toggle hide-arrow" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bx bx-dots-vertical-rounded"></i>
                </button>
                <ul class="dropdown-menu dropdown-menu-end" style="">
                    <li><a class="dropdown-item" onclick="change(1)">Tüm Müşteriler</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" onclick="change(2)">Planlanan</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" onclick="change(3)">Gerçekleşen</a></li>
                    <li>
                        <hr class="dropdown-divider">
                    </li>
                    <li><a class="dropdown-item" onclick="change(4)">Ürünler</a></li>
                </ul>
            </div>

            <div class="btn-group menu2" role="group" aria-label="Basic radio toggle button group">
                <input type="radio" class="btn-check" onclick="change(1)" name="btnradio" id="btnradio1" checked="" autocomplete="off">
                <label class="btn btn-outline-primary" for="btnradio1">Tüm Müşteriler</label>
                <input type="radio" class="btn-check" onclick="change(2)" name="btnradio" id="btnradio2" autocomplete="off">
                <label class="btn btn-outline-primary" for="btnradio2">Planlanan</label>
                <input type="radio" class="btn-check" onclick="change(3)" name="btnradio" id="btnradio3" autocomplete="off">
                <label class="btn btn-outline-primary" for="btnradio3">Gerçekleşen</label>
                <input type="radio" class="btn-check" onclick="change(4)" name="btnradio" id="btnradio4" autocomplete="off">
                <label class="btn btn-outline-primary" for="btnradio4">Ürünler</label>

            </div>


            <div class="avatar avatar-online float-end" data-bs-toggle="dropdown">
                @{
                    string s = Request.Cookies["Id"].Value + ".png?" + DateTime.Now.Ticks.ToString();
                }
                <object data="/assets/img/avatars/@s" type="image/png" class="w-px-40 h-auto rounded-circle">
                    <img src="/assets/img/avatars/7.png" class="w-px-40 h-auto rounded-circle">
                </object>
            </div>

            <ul class="dropdown-menu dropdown-menu-end">
                <li>
                    <a class="dropdown-item" href='@Url.Action("Index","Profil")'>
                        <div class="d-flex">
                            <div class="flex-shrink-0 me-3">
                                <div class="avatar avatar-online">
                                    <object data="/assets/img/avatars/@s" type="image/png" class="w-px-40 h-auto rounded-circle">
                                        <img src="/assets/img/avatars/7.png" class="w-px-40 h-auto rounded-circle">
                                    </object>
                                </div>
                            </div>
                            <div class="flex-grow-1">
                                @if (@Request.Cookies["Name"] != null)
                                {
                                    <span class="fw-semibold d-block">@Request.Cookies["Name"].Value</span>
                                    <small class="text-muted">Yetki: @Request.Cookies["RoleName"].Value</small>
                                }
                                else
                                {
                                    <span class="fw-semibold d-block">Test</span>
                                    <small class="text-muted">Yetki: Test</small>
                                }

                            </div>
                        </div>
                    </a>
                </li>

                <li>
                    <a href="javascript:void(0);" class="dropdown-item" data-bs-toggle="modal"
                       data-bs-target="#cikis">
                        <i class="bx bx-power-off me-2"></i>
                        <span class="align-middle">Oturumu Kapat</span>
                    </a>
                </li>
            </ul>

        </div>
        <div class="card-body" id="bdy1">


            <div id="employeeTableWrapper" class="tableWrapper table-responsive">
                <table id="table"
                       class="table table-striped"
                       data-pagination="true"
                       data-buttons-order="['paginationSwitch', 'columns', 'filterTable']"
                       data-search="true"
                       data-show-toggle="true"
                       data-show-columns="true"
                       data-sticky-header="true"
                       data-export-data-type="all"
                       data-export-types="['excel']"
                       data-show-export="true"
                       data-filter-control="true"
                       data-filter-control-multiple-search="true"
                       data-mobile-responsive="true"
                       data-locale="tr-TR">
                    <thead>
                        <tr>
                            <th data-field="MUSTERI_ADI" data-sortable="true">Müşteri Adı</th>
                            <th data-field="MUSTERI_ADRES" data-sortable="true" data-formatter="adresFormatter">Adres</th>
                            <th data-field="MUSTERI_TEL1" data-sortable="true" data-formatter="telFormatter">Telefon</th>
                            <th data-field="MUSTERI_MAIL" data-sortable="true" data-formatter="mailFormatter">Mail</th>
                            <th data-field="MUSTERI_SEKTOR" data-sortable="true">Sektör</th>
                            <th data-field="MUSTERI_NITELIK" data-sortable="true">Nitelik</th>
                            <th data-field="MUSTERI_NOTU" data-sortable="true" data-formatter="notFormatter">Notu</th>
                            <th data-field="PLASIYER" data-sortable="true" data-formatter="plasiyerFormatter1">Plasiyer</th>
                            <th data-field="KAYIT_TARIHI" data-sortable="true" data-formatter="teslimFormatter">Kayıt Tarihi</th>

                        </tr>
                    </thead>
                </table>


            </div>



        </div>
        <div class="card-body" id="bdy2">


            <div id="employeeTableWrapper1" class="tableWrapper table-responsive">

                <table id="table2"
                       class="table table-striped"
                       data-pagination="true"
                       data-buttons-order="['paginationSwitch', 'columns', 'filterTable']"
                       data-search="true"
                       data-show-toggle="true"
                       data-show-columns="true"
                       data-export-data-type="all"
                       data-export-types="['excel']"
                       data-show-export="true"
                       data-filter-control="true"
                       data-filter-control-multiple-search="true"
                       data-mobile-responsive="true"
                       data-locale="tr-TR">
                    <thead>
                        <tr>
                            <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                            <th data-field="PLANLANAN_TARIH" data-sortable="true" data-formatter="planlananFormatter">Planlanan Tarih</th>
                            <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="plasiyerFormatter">Plasiyer</th>

                        </tr>
                    </thead>
                </table>

            </div>



        </div>
        <div class="card-body" id="bdy3">


            <div id="employeeTableWrapper2" class="tableWrapper table-responsive">
                <table id="table3"
                       class="table table-striped"
                       data-pagination="true"
                       data-buttons-order="['paginationSwitch', 'columns', 'filterTable']"
                       data-search="true"
                       data-show-columns="true"
                       data-export-data-type="all"
                       data-export-types="['excel']"
                       data-show-toggle="true"
                       data-show-export="true"
                       data-locale="tr-TR"
                       data-mobile-responsive="true">
                    <thead>
                        <tr>
                            <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                            <th data-field="PLANLANAN_TARIH" data-sortable="true" data-formatter="planlananFormatter">Planlanan Tarih</th>
                            <th data-field="GERCEKLESEN_TARIH" data-sortable="true" data-formatter="gerceklesenFormatter">Gerçekleşen Tarih</th>
                            <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="plasiyerFormatter">Plasiyer</th>
                        </tr>
                    </thead>
                </table>


            </div>



        </div>
        <div class="card-body" id="bdy4">


            <div id="employeeTableWrapper3" class="tableWrapper table-responsive">
                <table id="table4"
                       class="table table-striped"
                       data-pagination="true"
                       data-buttons-order="['paginationSwitch', 'columns', 'filterTable']"
                       data-search="true"
                       data-show-columns="true"
                       data-export-data-type="all"
                       data-export-types="['excel']"
                       data-show-toggle="true"
                       data-show-export="true"
                       data-locale="tr-TR"
                       data-mobile-responsive="true">
                    <thead>
                        <tr>
                            <th data-field="MUSTERI_ID" data-sortable="true" data-formatter="musteriadiFormatter">Müşteri Adı</th>
                            <th data-field="URUN_GRUBU" data-sortable="true">Ürün Grubu</th>
                            <th data-field="YILLIK_KULLANIM" data-sortable="true">Yıllık Kullanım</th>
                            <th data-field="OLCU_BIRIMI" data-sortable="true">Ölçü Birimi</th>
                            <th data-field="KAYIT_YAPAN_KULLANICI" data-formatter="plasiyerFormatter1">PLASIYER</th>
                        </tr>
                    </thead>
                </table>


            </div>



        </div>
        <script>
            var type = 'fa'

            function loadingTemplate(message) {
                if (type === 'fa') {
                    return '<i class="fa fa-spinner fa-spin fa-fw fa-2x"></i>'
                }
                if (type === 'pl') {
                    return '<div class="ph-item"><div class="ph-picture"></div></div>'
                }
            }

            var r = null;
            var r2 = null;
            var username = null;
            var userid = null;
            var sor1 = null;
             async function getUrunlerAsync() {
                let response = await fetch(`@Url.Action("GetMusteriUrun", "Satis")`);
                let data = await response.json()
                return data;
            }
            async function getMusterilerAsync() {
                let response = await fetch(`@Url.Action("GetMusteriler","Satis")`);
                let data = await response.json()
                return data;
            }
             async function getUserAsync() {
                let response = await fetch(`@Url.Action("GetUser", "Satis")`);
                let data = await response.json()
                return data;
            }
             async function getRandevuAsync() {
                let response = await fetch(`@Url.Action("GetRandevu", "Satis")`);
                let data = await response.json()
                return data;
            }

            $(document).ready(function () {
                $('#bdy2').hide();
                $('#bdy3').hide();
                $('#bdy4').hide();

                getUserAsync().then(function (data) {
                    user = JSON.parse(data);
                }).then(function () {
                    getMusterilerAsync().then(function (res) {
                        degismez = JSON.parse(res);

                        $('#table').bootstrapTable({ data: degismez });
                    })
                })

                     

               
               

            })

                function change(value) {
                    if (value == 1) {
                        $('#bdy4').hide();
                        $('#bdy2').hide();
                        $('#bdy3').hide();
                        $('#bdy1').show();
                        getMusterilerAsync().then(function (data) {
                            var musteriler = JSON.parse(data);

                            $('#table').bootstrapTable({ data: musteriler });
                        })
                    } else if (value == 2) {
                        $('#bdy1').hide();
                        $('#bdy2').show();
                        getRandevuAsync().then(function (data) {
                            var randevular = JSON.parse(data).filter(x => x.GERCEKLESEN_TARIH == null);

                            $('#table2').bootstrapTable({ data: randevular });
                        })
                        $('#bdy3').hide();
                        $('#bdy4').hide();
                    } else if (value == 3) {
                        $('#bdy1').hide();
                        $('#bdy2').hide();
                        $('#bdy3').show();
                        $('#bdy4').hide();
                        $.getJSON('@Url.Action("GetRandevu", "Satis")', function (data) {


                        }).done(function (result) {


                            $(function () {


                                sor2 = JSON.parse(result).filter(x => x.GERCEKLESEN_TARIH != null);
                                $('#table3').bootstrapTable({ data: sor2 })

                            })
                        })
                    } else {
                        $('#bdy1').hide();
                        $('#bdy2').hide();
                        getUrunlerAsync().then(function (data) {
                            var urunler = JSON.parse(data);

                            $('#table4').bootstrapTable({ data: urunler });
                        })
                        $('#bdy3').hide();
                        $('#bdy4').show();
                    }
                }

            function plasiyerFormatter(value, row, index) {

                var isim = degismez.filter(x => x.MUSTERI_ID == row.MUSTERI_ID);
                var u = user.filter(x => x.USER_NAME == isim[0].PLASIYER);
                return u[0].USER_FIRSTNAME + " " + u[0].USER_LASTNAME;


            }
            function plasiyerFormatter1(value, row, index) {
                if (value == null) {
                    return "";
                }

                var a = user.filter(x => x.USER_NAME == value);
                var y = a[0].USER_FIRSTNAME + " " + a[0].USER_LASTNAME;
                
                return y;


            }
            function mailFormatter(value, row, index) {


                return value;
            }

            function notFormatter(value, row, index) {

                if (value == null) {
                    value = "";
                }
                return "<textarea disabled>"+value+"</textarea>";
            }
            function adresFormatter(value, row, index) {
                var mahalle = row.MUSTERI_MAHALLE == null ? "-" :row.MUSTERI_MAHALLE ;
                var ilce = row.MUSTERI_ILCE == null ? "-" :row.MUSTERI_ILCE ;
                var il = row.MUSTERI_IL == null ? "-" :row.MUSTERI_IL;
                var adres = value == null ? "-":value;

                return il + ", " + ilce + ", " + mahalle + ", " + adres;
            }
            function teslimFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var newdate = day + "/" + month + "/" + year;
                return newdate;
            }
            function telFormatter(value, row, index) {
                var tel1 = value == null ? "-" : value;
                var tel2 = row.MUSTERI_TEL2 == null ? "-" : row.MUSTERI_TEL2;


                return tel1 + ", " + tel2;
            }
            function planlananFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var newdate = day + "/" + month + "/" + year;
                return newdate;
            }
            function customSearchFormatter(value, row, index) {
                return value;
            }
            function gerceklesenFormatter(value, row, index) {
                var old = value.split('T')[0];
                var year = old.split('-')[0];
                var month = old.split('-')[1];
                var day = old.split('-')[2];
                var newdate = day + "/" + month + "/" + year;
                return newdate;
            }
            function musteriadiFormatter(value, row, index) {

                var isim = degismez.filter(x => x.MUSTERI_ID == row.MUSTERI_ID);

                    return isim[0].MUSTERI_ADI;
            }



        </script>
    </div>
</div>






