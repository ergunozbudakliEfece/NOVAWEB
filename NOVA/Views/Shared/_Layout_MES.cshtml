<!--              ___                 ___               -->
<!--        _____/___\_____        __|___|__            -->
<!--        """"("-_-")""""         ( o_o )      ~      -->
<!--          /\_)=o~/              _\~-~/_   _ _~      -->
<!--         / /\\\///\      ~     / \/|\/ \/\(|_|      -->
<!--         \__|\\//\ \   ~      / |.   .|\_/          -->
<!--  __________|//\\/_/___~______\_\_____|_____        -->
<!--           _______   |_|)      _______              -->
<!--           \_____/             \_____/              -->


<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nova | Efece Galvaniz</title>

    <link rel="icon" type="image/x-icon" href="/assets/img/icons/brands/Nova_White.png" />

    <link href="~/wwwroot/libs/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="~/wwwroot/libs/bootstrap-icons/font/bootstrap-icons.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">

    <script src="~/wwwroot/libs/jquery/jquery.min.js"></script>

    <style>
        :root {
            --empty-bg-color: #070B1C;
            --empty-text-color: #ffffff;
            --empty-header-color: #0e1535;
            --empty-border-color: #263881;
            --empty-infobox-color: #070B1C;
            --empty-border-radius: 0.5rem;
            --sb-track-color: #0e1535;
            --sb-thumb-color: #263881;
            --sb-size: 10px;
        }

        * {
            scrollbar-color: var(--sb-thumb-color) var(--sb-track-color);
        }

            *::-webkit-scrollbar {
                height: var(--sb-size);
                width: 7px;
            }

            *::-webkit-scrollbar-track {
                background: var(--sb-track-color);
                border-radius: 10px;
            }

            *::-webkit-scrollbar-thumb {
                background: var(--sb-thumb-color);
                border-radius: 10px;
            }

        html {
            height: 100%;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            position: relative;
            min-height: 100vh;
            padding-bottom: 2.5rem;
            background-color: var(--empty-bg-color);
            color: var(--empty-text-color);
            padding: 0 !important;
        }

        .header {
            height: 45px;
            background-color: var(--empty-header-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 1rem;
        }

            .header .options {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 5px;
            }

        .content {
            min-height: calc(100svh - 3.25rem - 45px);
            padding: 0.5rem;
        }

        .page {
            display: none;
        }

        #subtitle-wrapper {
            height: 25px;
            overflow: hidden;
            white-space: nowrap;
            position: absolute;
            bottom: 2.4rem;
            left: 0;
            right: 0;
        }

        .subtitle-content {
            display: flex;
            align-items: center;
            gap: 1.25rem;
        }

            .subtitle-content .machine-subtitle-data {
                display: flex;
                align-items: center;
                height: 25px;
                gap: 0.75rem;
            }

        .footer {
            height: 35px;
            padding: 0;
            text-align: center;
            position: absolute;
            bottom: 0px;
            right: 0;
            left: 0;
        }

            .footer span {
                display: flex;
                justify-content: center;
                align-items: center;
                gap: 5px;
            }

        .form-select {
            color: var(--empty-text-color);
            background-color: var(--empty-bg-color);
            border: var(--bs-border-width) solid var(--empty-border-color);
        }

        .btn-outline-custom {
            border-color: var(--empty-border-color);
        }

        .home-button {
            border-color: var(--empty-border-color);
            color: var(--empty-text-color);
            background-color: var(--empty-bg-color);
            height: 2rem;
            display: flex;
            justify-content: center;
            align-items: center;
        }

            .home-button:hover {
                border-color: var(--empty-border-color);
                background-color: var(--empty-header-color) !important;
            }

        .loader-area {
            pointer-events: none;
            display: flex;
            justify-content: center;
            align-items: center;
            position: absolute;
            bottom: 0;
            right: 0;
            left: 0;
            top: 0;
        }

        .horizontal-line {
            width: 100%;
            border: var(--bs-border-width) solid var(--empty-border-color);
            margin: 0.25rem;
        }

        #nova-loader {
            display: none;
            animation: beat 0.5s infinite alternate;
        }

        @@keyframes beat {
            to {
                transform: scale(1.4);
            }
        }
    </style>

</head>
<body>


    <div class="main">

        @RenderBody()

        <div id="subtitle-wrapper"></div>

        <div class="footer">
            <span><img src="/assets/img/icons/brands/Nova.png" height="25" width="25" /> NOVA</span>
        </div>
    </div>

    <script src="~/wwwroot/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/wwwroot/libs/axios/axios.min.js"></script>
    <script src="https://unpkg.com/&#64popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <script src="~/wwwroot/libs/moment.js/moment-with-locales.min.js"></script>
    <script src="~/wwwroot/libs/sweetalert2/sweetalert2.all.min.js"></script>
    <script type="module">
        import marquee from '/wwwroot/libs/vanilla-marquee/dist/vanilla-marquee.js';

        function CreateSubtitle() {
            axios.get('http://192.168.2.13:83/api/makine/mes/sub')
                .then((response) => {
                    var Template = `<div class="subtitle-content">`;

                    for (const Machine of response.data) {
                        if (!Machine.HATKODU.toUpperCase().includes("SM")) {
                            Template += `<div class="machine-subtitle-data">
                                                            <img src="/assets/img/icons/brands/NOVA_LOGO_CIRCLE.png" height="16" width="16">
                                                            <span><b>${Machine.HATKODU}</b> ❯</span>
                                                            <span style="color:#c7c7c7;">★ AYLIK→</span>
                                                            <span style="color:#7aa5db;">• ÜRETİM: <span id="${Machine.HATKODU}-aylik-uretim">${MiktarFormat(Machine.AYLIK_TOPLAM_MIKTAR, 'KG')}</span></span>
                                                            <span style="color:#ff2300;">• HURDA: <span id="${Machine.HATKODU}-aylik-hurda">${MiktarFormat(Machine.AY_TOPLAM_HURDA, 'KG')} (${OranFormat(Machine.AY_TOPLAM_HURDA, Machine.AYLIK_TOPLAM_MIKTAR)})</span></span>
                                                            <span style="color:#ff8e2e;">• 2. KALİTE: <span id="${Machine.HATKODU}-aylik-ikinci-kalite">${MiktarFormat(Machine.AY_TOPLAM_KALITE2, 'KG')} (${OranFormat(Machine.AY_TOPLAM_KALITE2, Machine.AYLIK_TOPLAM_MIKTAR)})</span></span>

                                                            <span style="color:#c7c7c7;">★ YILLIK→</span>
                                                            <span style="color:#7aa5db;">• ÜRETİM: <span id="${Machine.HATKODU}-yillik-uretim">${MiktarFormat(Machine.YILLIK_TOPLAM_MIKTAR, 'KG')}</span></span>
                                                            <span style="color:#ff2300;">• HURDA: <span id="${Machine.HATKODU}-yillik-hurda">${MiktarFormat(Machine.YIL_TOPLAM_HURDA, 'KG')} (${OranFormat(Machine.YIL_TOPLAM_HURDA, Machine.YILLIK_TOPLAM_MIKTAR)})</span></span>
                                                            <span style="color:#ff8e2e;">• 2. KALİTE: <span id="${Machine.HATKODU}-yillik-ikinci-kalite">${MiktarFormat(Machine.YIL_TOPLAM_KALITE2, 'KG')} (${OranFormat(Machine.YIL_TOPLAM_KALITE2, Machine.YILLIK_TOPLAM_MIKTAR)})</span></span>
                                                          </div>`;
                        }
                    }

                    $('#subtitle-wrapper').html(Template + `</div>`);

                    new marquee(document.getElementById('subtitle-wrapper'), {
                        duplicated: true,
                        gap: 16,
                        speed: 50,
                        pauseOnHover: true
                    });

                    setInterval(BilgiGuncelle, 1000);
                })
                .catch((ex) => {

                });
        }

        function MiktarFormat(Value, Unit = '') {
            return (Value !== null && Value !== 0) ? `${parseFloat(Value).toLocaleString(undefined, { minimumFractionDigits: 0, maximumFractionDigits: 0 })} ${Unit}` : '-';
        }

        function OranFormat(Pay, Payda) {
            return RoundUp(Pay / Payda) == '0.00' || isNaN(parseFloat(Pay / Payda)) ? '-%' : `${RoundUp((Pay / Payda) * 100)}%`;
        }

        function RoundUp(v, n = 2) {
            return (Math.ceil(v * Math.pow(10, n)) / Math.pow(10, n)).toFixed(2);
        }

        function BilgiGuncelle() {
            axios.get('http://192.168.2.13:83/api/makine/mes/sub')
                .then((response) => {

                    for (const Machine of response.data) {
                        $(`#${Machine.HATKODU}-aylik-uretim`).html(MiktarFormat(Machine.AYLIK_TOPLAM_MIKTAR, 'KG'));
                        $(`#${Machine.HATKODU}-aylik-hurda`).html(`${MiktarFormat(Machine.AY_TOPLAM_HURDA, 'KG')} (${OranFormat(Machine.AY_TOPLAM_HURDA, Machine.AYLIK_TOPLAM_MIKTAR)})`);
                        $(`#${Machine.HATKODU}-aylik-ikinci-kalite`).html(`${MiktarFormat(Machine.AY_TOPLAM_KALITE2, 'KG')} (${OranFormat(Machine.AY_TOPLAM_KALITE2, Machine.AYLIK_TOPLAM_MIKTAR)})`);

                        $(`#${Machine.HATKODU}-yillik-uretim`).html(MiktarFormat(Machine.YILLIK_TOPLAM_MIKTAR, 'KG'));
                        $(`#${Machine.HATKODU}-yillik-hurda`).html(`${MiktarFormat(Machine.YIL_TOPLAM_HURDA, 'KG')} (${OranFormat(Machine.YIL_TOPLAM_HURDA, Machine.YILLIK_TOPLAM_MIKTAR)})`);
                        $(`#${Machine.HATKODU}-yillik-ikinci-kalite`).html(`${MiktarFormat(Machine.YIL_TOPLAM_KALITE2, 'KG')} (${OranFormat(Machine.YIL_TOPLAM_KALITE2, Machine.YILLIK_TOPLAM_MIKTAR)})`);
                    }
                })
                .catch((ex) => {

                });
        }

        $(document).ready(() => {
            CreateSubtitle();
        });
    </script>

    @RenderSection("Scripts", false)
</body>
</html>
