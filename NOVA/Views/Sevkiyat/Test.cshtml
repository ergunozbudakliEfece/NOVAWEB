
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Test</title>
    <link href="https://unpkg.com/bootstrap-table@1.21.1/dist/bootstrap-table.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <link href="https://unpkg.com/placeholder-loading/dist/css/placeholder-loading.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

</head>
<body>
    <div class="container-fluid">
        <div id="employeeTableWrapper" class="tableWrapper table-responsive">

            <table id="table"
                   class="table table-striped"
                   data-buttons-order="['paginationSwitch', 'columns', 'filterTable']"
                   data-toggle="table"
                   data-show-export="true"
                   data-export-data-type="all"
                   data-export-types="['excel']"
                   data-pagination="true"
                   data-search="true"
                   data-show-columns="true"
                   data-show-columns-toggle-all="true"
                   data-locale="tr-TR"
                   data-filter-control="true"
                   data-filter-control-multiple-search="true"
                   data-loading-template="loadingTemplate"
                   data-mobile-responsive="true"
                   data-detail-formatter="detailFormatter"
                   data-detail-view="true"
                   >
                <thead>
                    <tr>
                        <th data-field="SIPARIS_NO" data-sortable="true">SİPARİŞ NO</th>
                        <th data-field="TARIH" data-sortable="true">TARİH</th>
                        <th data-field="CARI_DOVIZ_TIPI" data-sortable="true">HESAP TÜRÜ</th>
                        <th data-field="TESLIM_YERI" data-sortable="true">TESLİM YERİ</th>
                        <th data-field="PLASIYER_ADI" data-sortable="true">PLASİYER ADI</th>

                    </tr>
                </thead>
            </table>


        </div>
    </div>
    <script>
        var tumsipler = null;
        $(document).ready(function () {
            
            $.getJSON("http://192.168.2.13:83/api/stok/exec", function (data) {

                tumsipler = data;
                
            })

            $('#table').bootstrapTable({ url: "http://192.168.2.13:83/api/detaysizsip" })
            
        })
        var type = 'fa'

        function loadingTemplate(message) {
            if (type === 'fa') {
                return '<i class="fa fa-spinner fa-spin fa-fw fa-2x"></i>'
            }
            if (type === 'pl') {
                return '<div class="ph-item"><div class="ph-picture"></div></div>'
            }
        }

        function detailFormatter(index, row) {
           
            var st = "";
            var d = tumsipler.filter(x => x.SIPARIS_NO == row.SIPARIS_NO);

            for (let i = 0; i < d.length; i++) {
                st = st + "<tr><td>" + d[i].STOK_ADI + "</td>" + "<td>" + d[i].MIKTAR + "</td>" + "<td>" + d[i].MIKTAR2 + "</td>" + "<td>" + d[i].TESLIM_MIKTARI + "</td>" + "<td>" + d[i].BAKIYE_MIKTARI + "</td>" + "<td>" + "<div class='progress'><div class='progress-bar progress-bar-danger progress-bar-striped active' role='progressbar' aria-valuenow='" + parseInt(d[i].TESLIMAT_ORANI * 100) + "' aria-valuemin='0' aria-valuemax='100' style='width: " + parseInt(d[i].TESLIMAT_ORANI * 100) + "%'>" + Math.round(d[i].TESLIMAT_ORANI * 100) + "</div></div>" + "</td>" + "<td>" + (d[i].TESLIM_MIKTARI_SSIP ? d[i].TESLIM_MIKTARI_SSIP : 0) + "</td>" + "<td>" + (d[i].BAKIYE_MIKTARI_SSIP ? d[i].BAKIYE_MIKTARI_SSIP : 0) + "</td>" + "<td>" + d[i].TESLIMAT_ORANI_SSIP * 100 + "</td>" + "<td>" + (d[i].URETILEN_MIKTAR1 ? d[i].URETILEN_MIKTAR1 : 0) + "</td>" + "<td>" + (d[i].URETILECEK_MIKTAR1 ? d[i].URETILECEK_MIKTAR1 : 0) + "</td>" + "<td>" + d[i].URETIM_ORANI * 100 + "</td></tr>"
                }

            

            return "<table class='table table-borderless'><thead><tr class'text-nowrap'><th class='text-nowrap'>STOK ADI</th><th class='text-nowrap' style='padding-left: 10px'>MİKTAR 1</th><th class='text-nowrap' style='padding-left: 10px'>MİKTAR 2</th><th class='text-nowrap' style='padding-left: 10px'>MSIP TESLİM</th><th class='text-nowrap' style='padding-left: 10px'>MSIP BEKLEYEN</th><th class='text-nowrap' style='padding-left: 10px'>MSIP SÜREÇ</th><th class='text-nowrap' style='padding-left: 10px'>SSIP TESLİM</th><th class='text-nowrap' style='padding-left: 10px'>SSIP BEKLEYEN</th><th class='text-nowrap' style='padding-left: 10px'>SSIP SÜREÇ</th><th class='text-nowrap' style='padding-left: 10px'>ÜRETİLEN</th><th class='text-nowrap' style='padding-left: 10px'>ÜRETİM BEKLEYEN</th><th class='text-nowrap' style='padding-left: 10px'>ÜRETİM SÜREÇ</th></tr></thead><tbody>"+st+"</tbody></table>";
            

        }

    </script>
</body>
</html>
